
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="reference.html">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.13">
    
    
      
        <title>Recipes - odfdo</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#recipes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="odfdo" class="md-header__button md-logo" aria-label="odfdo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            odfdo
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Recipes
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/jdum/odfdo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="odfdo" class="md-nav__button md-logo" aria-label="odfdo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    odfdo
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jdum/odfdo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Readme
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="CHANGES.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="reference.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Recipes
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="recipes.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Recipes
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-write-hello-world-in-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to write hello world in a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-write-hello-world-in-a-spreadsheet-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to write hello world in a spreadsheet document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-presentation-hello-world" class="md-nav__link">
    <span class="md-ellipsis">
      Basic presentation hello world
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-basic-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      Create a basic text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-paragraph-to-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a paragraph to a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-basic-text-document-with-a-list" class="md-nav__link">
    <span class="md-ellipsis">
      Create a basic text document with a list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-basic-text-document-with-list-and-sublists" class="md-nav__link">
    <span class="md-ellipsis">
      Create a basic text document with list and sublists
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-sublist-to-a-list" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a sublist to a list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-insert-a-new-item-within-a-list" class="md-nav__link">
    <span class="md-ellipsis">
      How to insert a new item within a list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-an-item-to-a-list" class="md-nav__link">
    <span class="md-ellipsis">
      How to add an item to a list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-text-content-from-odt-file" class="md-nav__link">
    <span class="md-ellipsis">
      Get text content from odt file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-basic-text-document-with-a-table-of-content" class="md-nav__link">
    <span class="md-ellipsis">
      Create a basic text document with a table of content
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-table-of-content-to-a-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a table of content to a document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-a-text-document-with-a-table-of-content" class="md-nav__link">
    <span class="md-ellipsis">
      Update a text document with a table of content
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-basic-text-document-with-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      Create a basic text document with annotations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-basic-text-document-with-footnotes" class="md-nav__link">
    <span class="md-ellipsis">
      Create a basic text document with footnotes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-footnote-to-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to add footnote to a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-text-document-with-tables-in-it" class="md-nav__link">
    <span class="md-ellipsis">
      Create a text document with tables in it
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-table-to-a-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a table to a document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-text-document-from-plain-text-with-layout" class="md-nav__link">
    <span class="md-ellipsis">
      Create a text document from plain text with layout
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-picture-to-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a picture to a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-title-to-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a title to a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-a-single-element" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing a single element
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-a-list-of-elements" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing a list of elements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-other-element-from-element-like-list" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing other element from element like list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-list-to-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a list to a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-manual-page-break" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a manual page break
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-basic-drawing" class="md-nav__link">
    <span class="md-ellipsis">
      Create a basic drawing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-private-annotations-to-a-document" class="md-nav__link">
    <span class="md-ellipsis">
      Add private annotations to a document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessibility-check-on-a-document" class="md-nav__link">
    <span class="md-ellipsis">
      Accessibility check on a document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-logo-on-presentation" class="md-nav__link">
    <span class="md-ellipsis">
      Add logo on presentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-pictures-from-document-odt" class="md-nav__link">
    <span class="md-ellipsis">
      Get pictures from document odt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#change-image-in-many-documents" class="md-nav__link">
    <span class="md-ellipsis">
      Change image in many documents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concatenate-presentations" class="md-nav__link">
    <span class="md-ellipsis">
      Concatenate presentations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-a-presentation-from-pictures-of-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      Make a presentation from pictures of a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-presentation-from-images" class="md-nav__link">
    <span class="md-ellipsis">
      Make presentation from images
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-a-presentation-from-text-with-different-styles" class="md-nav__link">
    <span class="md-ellipsis">
      Make a presentation from text with different styles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extract-and-reorder-slides" class="md-nav__link">
    <span class="md-ellipsis">
      Extract and reorder slides
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#change-values-of-a-chart-inside-a-document" class="md-nav__link">
    <span class="md-ellipsis">
      Change values of a chart inside a document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-text-span-styles" class="md-nav__link">
    <span class="md-ellipsis">
      Add text span styles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-copy-some-style-from-another-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to copy some style from another document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#copy-style-from-another-document" class="md-nav__link">
    <span class="md-ellipsis">
      Copy style from another document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-basic-text-styles" class="md-nav__link">
    <span class="md-ellipsis">
      Create basic text styles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-apply-a-style-to-a-paragraph" class="md-nav__link">
    <span class="md-ellipsis">
      How to apply a style to a paragraph
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#change-paragraph-styles-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Change paragraph styles methods
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete-parts-of-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      Delete parts of a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-color-chart-in-spreadsheet" class="md-nav__link">
    <span class="md-ellipsis">
      Create color chart in spreadsheet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-cell-background-color" class="md-nav__link">
    <span class="md-ellipsis">
      Get cell background color
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extract-a-sub-table-from-some-big-table" class="md-nav__link">
    <span class="md-ellipsis">
      Extract a sub table from some big table
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-a-basic-spreadsheet" class="md-nav__link">
    <span class="md-ellipsis">
      Make a basic spreadsheet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-spreadsheet-with-named-ranges" class="md-nav__link">
    <span class="md-ellipsis">
      Make spreadsheet with named ranges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introspecting-elements" class="md-nav__link">
    <span class="md-ellipsis">
      Introspecting elements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#show-meta-data" class="md-nav__link">
    <span class="md-ellipsis">
      Show meta data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#move-link-to-footnote" class="md-nav__link">
    <span class="md-ellipsis">
      Move link to footnote
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remove-http-links" class="md-nav__link">
    <span class="md-ellipsis">
      Remove http links
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remove-span-styles" class="md-nav__link">
    <span class="md-ellipsis">
      Remove span styles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieve-all-pictures-from-odf-files" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieve all pictures from odf files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#read-document-from-bytesio" class="md-nav__link">
    <span class="md-ellipsis">
      Read document from bytesio
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#save-document-as-bytesio" class="md-nav__link">
    <span class="md-ellipsis">
      Save document as bytesio
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#search-and-replace-words" class="md-nav__link">
    <span class="md-ellipsis">
      Search and replace words
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spreadsheet-with-words-frequency-from-a-text" class="md-nav__link">
    <span class="md-ellipsis">
      Spreadsheet with words frequency from a text
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transpose-table" class="md-nav__link">
    <span class="md-ellipsis">
      Transpose table
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-write-hello-world-in-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to write hello world in a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-write-hello-world-in-a-spreadsheet-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to write hello world in a spreadsheet document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-presentation-hello-world" class="md-nav__link">
    <span class="md-ellipsis">
      Basic presentation hello world
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-basic-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      Create a basic text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-paragraph-to-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a paragraph to a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-basic-text-document-with-a-list" class="md-nav__link">
    <span class="md-ellipsis">
      Create a basic text document with a list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-basic-text-document-with-list-and-sublists" class="md-nav__link">
    <span class="md-ellipsis">
      Create a basic text document with list and sublists
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-sublist-to-a-list" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a sublist to a list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-insert-a-new-item-within-a-list" class="md-nav__link">
    <span class="md-ellipsis">
      How to insert a new item within a list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-an-item-to-a-list" class="md-nav__link">
    <span class="md-ellipsis">
      How to add an item to a list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-text-content-from-odt-file" class="md-nav__link">
    <span class="md-ellipsis">
      Get text content from odt file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-basic-text-document-with-a-table-of-content" class="md-nav__link">
    <span class="md-ellipsis">
      Create a basic text document with a table of content
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-table-of-content-to-a-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a table of content to a document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-a-text-document-with-a-table-of-content" class="md-nav__link">
    <span class="md-ellipsis">
      Update a text document with a table of content
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-basic-text-document-with-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      Create a basic text document with annotations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-basic-text-document-with-footnotes" class="md-nav__link">
    <span class="md-ellipsis">
      Create a basic text document with footnotes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-footnote-to-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to add footnote to a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-text-document-with-tables-in-it" class="md-nav__link">
    <span class="md-ellipsis">
      Create a text document with tables in it
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-table-to-a-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a table to a document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-text-document-from-plain-text-with-layout" class="md-nav__link">
    <span class="md-ellipsis">
      Create a text document from plain text with layout
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-picture-to-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a picture to a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-title-to-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a title to a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-a-single-element" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing a single element
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-a-list-of-elements" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing a list of elements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-other-element-from-element-like-list" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing other element from element like list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-list-to-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a list to a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-add-a-manual-page-break" class="md-nav__link">
    <span class="md-ellipsis">
      How to add a manual page break
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-basic-drawing" class="md-nav__link">
    <span class="md-ellipsis">
      Create a basic drawing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-private-annotations-to-a-document" class="md-nav__link">
    <span class="md-ellipsis">
      Add private annotations to a document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessibility-check-on-a-document" class="md-nav__link">
    <span class="md-ellipsis">
      Accessibility check on a document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-logo-on-presentation" class="md-nav__link">
    <span class="md-ellipsis">
      Add logo on presentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-pictures-from-document-odt" class="md-nav__link">
    <span class="md-ellipsis">
      Get pictures from document odt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#change-image-in-many-documents" class="md-nav__link">
    <span class="md-ellipsis">
      Change image in many documents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concatenate-presentations" class="md-nav__link">
    <span class="md-ellipsis">
      Concatenate presentations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-a-presentation-from-pictures-of-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      Make a presentation from pictures of a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-presentation-from-images" class="md-nav__link">
    <span class="md-ellipsis">
      Make presentation from images
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-a-presentation-from-text-with-different-styles" class="md-nav__link">
    <span class="md-ellipsis">
      Make a presentation from text with different styles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extract-and-reorder-slides" class="md-nav__link">
    <span class="md-ellipsis">
      Extract and reorder slides
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#change-values-of-a-chart-inside-a-document" class="md-nav__link">
    <span class="md-ellipsis">
      Change values of a chart inside a document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-text-span-styles" class="md-nav__link">
    <span class="md-ellipsis">
      Add text span styles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-copy-some-style-from-another-document" class="md-nav__link">
    <span class="md-ellipsis">
      How to copy some style from another document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#copy-style-from-another-document" class="md-nav__link">
    <span class="md-ellipsis">
      Copy style from another document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-basic-text-styles" class="md-nav__link">
    <span class="md-ellipsis">
      Create basic text styles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-apply-a-style-to-a-paragraph" class="md-nav__link">
    <span class="md-ellipsis">
      How to apply a style to a paragraph
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#change-paragraph-styles-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Change paragraph styles methods
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete-parts-of-a-text-document" class="md-nav__link">
    <span class="md-ellipsis">
      Delete parts of a text document
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-color-chart-in-spreadsheet" class="md-nav__link">
    <span class="md-ellipsis">
      Create color chart in spreadsheet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-cell-background-color" class="md-nav__link">
    <span class="md-ellipsis">
      Get cell background color
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extract-a-sub-table-from-some-big-table" class="md-nav__link">
    <span class="md-ellipsis">
      Extract a sub table from some big table
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-a-basic-spreadsheet" class="md-nav__link">
    <span class="md-ellipsis">
      Make a basic spreadsheet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-spreadsheet-with-named-ranges" class="md-nav__link">
    <span class="md-ellipsis">
      Make spreadsheet with named ranges
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introspecting-elements" class="md-nav__link">
    <span class="md-ellipsis">
      Introspecting elements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#show-meta-data" class="md-nav__link">
    <span class="md-ellipsis">
      Show meta data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#move-link-to-footnote" class="md-nav__link">
    <span class="md-ellipsis">
      Move link to footnote
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remove-http-links" class="md-nav__link">
    <span class="md-ellipsis">
      Remove http links
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remove-span-styles" class="md-nav__link">
    <span class="md-ellipsis">
      Remove span styles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieve-all-pictures-from-odf-files" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieve all pictures from odf files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#read-document-from-bytesio" class="md-nav__link">
    <span class="md-ellipsis">
      Read document from bytesio
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#save-document-as-bytesio" class="md-nav__link">
    <span class="md-ellipsis">
      Save document as bytesio
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#search-and-replace-words" class="md-nav__link">
    <span class="md-ellipsis">
      Search and replace words
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spreadsheet-with-words-frequency-from-a-text" class="md-nav__link">
    <span class="md-ellipsis">
      Spreadsheet with words frequency from a text
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transpose-table" class="md-nav__link">
    <span class="md-ellipsis">
      Transpose table
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="recipes">Recipes</h1>
<p>Recipes source code is in the <code>/recipes</code> directory of <code>odfdo</code> sources.
Most recipes are autonomous scripts doing actual modifications of ODF sample files, you can check the results in the <code>recipes/recipes_output</code> directory.</p>
<h3 id="how-to-write-hello-world-in-a-text-document">How to write hello world in a text document</h3>
<p>Create a basic spreadsheet with &ldquo;Hello World&rdquo; in the first cell.</p>
<details class="code">
<summary>recipes/how_to_write_hello_world_in_a_text_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-0-2"><span class="sd">&quot;&quot;&quot;Create a basic spreadsheet with &quot;Hello World&quot; in the first cell.</span>
</span><span id="__span-0-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-0-4"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-0-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-0-6">
</span><span id="__span-0-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Paragraph</span>
</span><span id="__span-0-8">
</span><span id="__span-0-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="__span-0-10"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;basic_hello&quot;</span>
</span><span id="__span-0-11"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-0-12">
</span><span id="__span-0-13">
</span><span id="__span-0-14"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-15">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-16">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-0-17">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-0-18">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-19">
</span><span id="__span-0-20">
</span><span id="__span-0-21"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-0-22">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-0-23">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-0-24">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-0-25">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
</span><span id="__span-0-26">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-0-27">
</span><span id="__span-0-28">    <span class="n">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-0-29">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-0-30">
</span><span id="__span-0-31">
</span><span id="__span-0-32"><span class="k">def</span><span class="w"> </span><span class="nf">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-33">    <span class="c1"># only for test suite:</span>
</span><span id="__span-0-34">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-0-35">        <span class="k">return</span>
</span><span id="__span-0-36">    <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="__span-0-37">    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="__span-0-38">    <span class="k">assert</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Hello World</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-0-39">
</span><span id="__span-0-40">
</span><span id="__span-0-41"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-0-42">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="how-to-write-hello-world-in-a-spreadsheet-document">How to write hello world in a spreadsheet document</h3>
<p>Create a basic spreadsheet with &ldquo;Hello World&rdquo; in the first cell.</p>
<details class="code">
<summary>recipes/how_to_write_hello_world_in_a_spreadsheet_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-1-2"><span class="sd">&quot;&quot;&quot;Create a basic spreadsheet with &quot;Hello World&quot; in the first cell.</span>
</span><span id="__span-1-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-1-4"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-1-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-1-6">
</span><span id="__span-1-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Table</span>
</span><span id="__span-1-8">
</span><span id="__span-1-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="__span-1-10"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;basic_ods&quot;</span>
</span><span id="__span-1-11"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.ods&quot;</span>
</span><span id="__span-1-12">
</span><span id="__span-1-13">
</span><span id="__span-1-14"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-1-15">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-1-16">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-1-17">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-1-18">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-1-19">
</span><span id="__span-1-20">
</span><span id="__span-1-21"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-1-22">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;spreadsheet&quot;</span><span class="p">)</span>
</span><span id="__span-1-23">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-1-24">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-1-25">
</span><span id="__span-1-26">    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;Empty Table&quot;</span><span class="p">)</span>
</span><span id="__span-1-27">    <span class="n">table</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
</span><span id="__span-1-28">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="__span-1-29">    <span class="n">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-1-30">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-1-31">
</span><span id="__span-1-32">
</span><span id="__span-1-33"><span class="k">def</span><span class="w"> </span><span class="nf">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-1-34">    <span class="c1"># only for test suite:</span>
</span><span id="__span-1-35">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-1-36">        <span class="k">return</span>
</span><span id="__span-1-37">    <span class="n">text</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">get_cell</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="__span-1-38">    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="__span-1-39">    <span class="k">assert</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Hello World&quot;</span>
</span><span id="__span-1-40">
</span><span id="__span-1-41">
</span><span id="__span-1-42"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-1-43">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="basic-presentation-hello-world">Basic presentation hello world</h3>
<p>Write a basic &ldquo;Hello World&rdquo; in the middle of the first page of a presentaion.</p>
<details class="code">
<summary>recipes/basic_presentation_hello_world.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-2-2"><span class="sd">&quot;&quot;&quot;Write a basic &quot;Hello World&quot; in the middle of the first page of a presentaion.</span>
</span><span id="__span-2-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-2-4"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-2-5">
</span><span id="__span-2-6"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">DrawPage</span><span class="p">,</span> <span class="n">Frame</span>
</span><span id="__span-2-7">
</span><span id="__span-2-8"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="__span-2-9"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;basic_odp&quot;</span>
</span><span id="__span-2-10"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;hello.odp&quot;</span>
</span><span id="__span-2-11">
</span><span id="__span-2-12">
</span><span id="__span-2-13"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-2-14">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-2-15">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-2-16">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-2-17">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-2-18">
</span><span id="__span-2-19">
</span><span id="__span-2-20"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-2-21">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;presentation&quot;</span><span class="p">)</span>
</span><span id="__span-2-22">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-2-23">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-2-24">
</span><span id="__span-2-25">    <span class="n">page</span> <span class="o">=</span> <span class="n">DrawPage</span><span class="p">(</span><span class="s2">&quot;page1&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Page 1&quot;</span><span class="p">)</span>
</span><span id="__span-2-26">    <span class="n">text_frame</span> <span class="o">=</span> <span class="n">Frame</span><span class="o">.</span><span class="n">text_frame</span><span class="p">(</span>
</span><span id="__span-2-27">        <span class="s2">&quot;Hello World&quot;</span><span class="p">,</span>
</span><span id="__span-2-28">        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;7cm&quot;</span><span class="p">,</span> <span class="s2">&quot;5cm&quot;</span><span class="p">),</span>
</span><span id="__span-2-29">        <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;11cm&quot;</span><span class="p">,</span> <span class="s2">&quot;8cm&quot;</span><span class="p">),</span>
</span><span id="__span-2-30">        <span class="n">style</span><span class="o">=</span><span class="s2">&quot;Standard&quot;</span><span class="p">,</span>
</span><span id="__span-2-31">        <span class="n">text_style</span><span class="o">=</span><span class="s2">&quot;Standard&quot;</span><span class="p">,</span>
</span><span id="__span-2-32">    <span class="p">)</span>
</span><span id="__span-2-33">    <span class="n">page</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text_frame</span><span class="p">)</span>
</span><span id="__span-2-34">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</span><span id="__span-2-35">
</span><span id="__span-2-36">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-2-37">
</span><span id="__span-2-38">
</span><span id="__span-2-39"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-2-40">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="create-a-basic-text-document">Create a basic text document</h3>
<p>Create a basic text document with headers and praragraphs.</p>
<details class="code">
<summary>recipes/create_a_basic_text_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-3-2"><span class="sd">&quot;&quot;&quot;Create a basic text document with headers and praragraphs.</span>
</span><span id="__span-3-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-3-4"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-3-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-3-6">
</span><span id="__span-3-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Paragraph</span>
</span><span id="__span-3-8">
</span><span id="__span-3-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="__span-3-10"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;basic_text&quot;</span>
</span><span id="__span-3-11"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-3-12">
</span><span id="__span-3-13">
</span><span id="__span-3-14"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-3-15">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-3-16">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-3-17">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-3-18">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-3-19">
</span><span id="__span-3-20">
</span><span id="__span-3-21"><span class="k">def</span><span class="w"> </span><span class="nf">create_basic_document</span><span class="p">():</span>
</span><span id="__span-3-22">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-3-23">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-3-24">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-3-25">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;De la Guerre des Gaules - Livre V&quot;</span><span class="p">))</span>
</span><span id="__span-3-26">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Prparatifs d&#39;expdition en Bretagne&quot;</span><span class="p">))</span>
</span><span id="__span-3-27">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-3-28">        <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-3-29">            <span class="s2">&quot;Sous le consulat de Lucius Domitius et d&#39;Appius Claudius, &quot;</span>
</span><span id="__span-3-30">            <span class="s2">&quot;Csar, quittant les quartiers d&#39;hiver pour aller en Italie, &quot;</span>
</span><span id="__span-3-31">            <span class="s2">&quot;comme il avait coutume de le faire chaque anne, ordonne aux &quot;</span>
</span><span id="__span-3-32">            <span class="s2">&quot;lieutenants qu&#39;il laissait  la tte des lgions de construire, &quot;</span>
</span><span id="__span-3-33">            <span class="s2">&quot;pendant l&#39;hiver, le plus de vaisseaux qu&#39;il serait possible, &quot;</span>
</span><span id="__span-3-34">            <span class="s2">&quot;et de rparer les anciens.&quot;</span>
</span><span id="__span-3-35">        <span class="p">)</span>
</span><span id="__span-3-36">    <span class="p">)</span>
</span><span id="__span-3-37">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;La Bretagne&quot;</span><span class="p">))</span>
</span><span id="__span-3-38">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-3-39">        <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-3-40">            <span class="s2">&quot;Cette le est de forme triangulaire ; l&#39;un des cts regarde &quot;</span>
</span><span id="__span-3-41">            <span class="s2">&quot;la Gaule. Des deux angles de ce ct, l&#39;un est au levant, &quot;</span>
</span><span id="__span-3-42">            <span class="s2">&quot;vers le pays de Cantium, o abordent presque tous les vaisseaux &quot;</span>
</span><span id="__span-3-43">            <span class="s2">&quot;gaulois ; l&#39;autre, plus bas, est au midi. La longueur de ce ct &quot;</span>
</span><span id="__span-3-44">            <span class="s2">&quot;est d&#39;environ cinq cent mille pas. &quot;</span>
</span><span id="__span-3-45">        <span class="p">)</span>
</span><span id="__span-3-46">    <span class="p">)</span>
</span><span id="__span-3-47">    <span class="k">return</span> <span class="n">document</span>
</span><span id="__span-3-48">
</span><span id="__span-3-49">
</span><span id="__span-3-50"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-3-51">    <span class="n">document</span> <span class="o">=</span> <span class="n">create_basic_document</span><span class="p">()</span>
</span><span id="__span-3-52">    <span class="n">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-3-53">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-3-54">
</span><span id="__span-3-55">
</span><span id="__span-3-56"><span class="k">def</span><span class="w"> </span><span class="nf">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-3-57">    <span class="c1"># only for test suite:</span>
</span><span id="__span-3-58">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-3-59">        <span class="k">return</span>
</span><span id="__span-3-60">    <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraph</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-3-61">    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="__span-3-62">    <span class="k">assert</span> <span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Cette le est de forme triangulaire&quot;</span><span class="p">)</span>
</span><span id="__span-3-63">
</span><span id="__span-3-64">
</span><span id="__span-3-65"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-3-66">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="how-to-add-a-paragraph-to-a-text-document">How to add a paragraph to a text document</h3>
<p>Minimal example of how to add a paragraph.</p>
<details class="code">
<summary>recipes/how_to_add_a_paragraph_to_a_text_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><span class="sd">&quot;&quot;&quot;Minimal example of how to add a paragraph.</span>
</span><span id="__span-4-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-4-3">
</span><span id="__span-4-4"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Paragraph</span>
</span><span id="__span-4-5">
</span><span id="__span-4-6"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">12</span>
</span><span id="__span-4-7">
</span><span id="__span-4-8">
</span><span id="__span-4-9"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-4-10">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-4-11">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-4-12">
</span><span id="__span-4-13">    <span class="c1"># create a new paragraph with some content :</span>
</span><span id="__span-4-14">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
</span><span id="__span-4-15">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-4-16">
</span><span id="__span-4-17">
</span><span id="__span-4-18"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-4-19">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="create-a-basic-text-document-with-a-list">Create a basic text document with a list</h3>
<p>Create a basic text document with a list.</p>
<details class="code">
<summary>recipes/create_a_basic_text_document_with_a_list.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-5-2"><span class="sd">&quot;&quot;&quot;Create a basic text document with a list.</span>
</span><span id="__span-5-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-5-4"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-5-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-5-6">
</span><span id="__span-5-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">ListItem</span>
</span><span id="__span-5-8">
</span><span id="__span-5-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="__span-5-10"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;basic_list&quot;</span>
</span><span id="__span-5-11"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-5-12">
</span><span id="__span-5-13">
</span><span id="__span-5-14"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-5-15">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-5-16">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-5-17">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-5-18">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-5-19">
</span><span id="__span-5-20">
</span><span id="__span-5-21"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-5-22">    <span class="n">document</span> <span class="o">=</span> <span class="n">generate_document</span><span class="p">()</span>
</span><span id="__span-5-23">    <span class="n">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-5-24">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-5-25">
</span><span id="__span-5-26">
</span><span id="__span-5-27"><span class="k">def</span><span class="w"> </span><span class="nf">generate_document</span><span class="p">():</span>
</span><span id="__span-5-28">    <span class="c1"># Create the document</span>
</span><span id="__span-5-29">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-5-30">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-5-31">
</span><span id="__span-5-32">    <span class="c1"># Adding List</span>
</span><span id="__span-5-33">    <span class="n">my_list</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="s2">&quot;Arthur&quot;</span><span class="p">,</span> <span class="s2">&quot;Ford&quot;</span><span class="p">,</span> <span class="s2">&quot;Trillian&quot;</span><span class="p">])</span>
</span><span id="__span-5-34">    <span class="c1"># The list accepts a Python list of strings and list items.</span>
</span><span id="__span-5-35">
</span><span id="__span-5-36">    <span class="c1"># The list can be written even though we will modify it afterwards:</span>
</span><span id="__span-5-37">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>
</span><span id="__span-5-38">
</span><span id="__span-5-39">    <span class="c1"># Adding more List Item to the list</span>
</span><span id="__span-5-40">    <span class="n">item</span> <span class="o">=</span> <span class="n">ListItem</span><span class="p">(</span><span class="s2">&quot;Marvin&quot;</span><span class="p">)</span>
</span><span id="__span-5-41">    <span class="n">my_list</span><span class="o">.</span><span class="n">append_item</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-5-42">
</span><span id="__span-5-43">    <span class="c1"># it should contain:</span>
</span><span id="__span-5-44">    <span class="nb">print</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">get_formatted_text</span><span class="p">())</span>
</span><span id="__span-5-45">    <span class="c1"># - Arthur</span>
</span><span id="__span-5-46">    <span class="c1"># - Ford</span>
</span><span id="__span-5-47">    <span class="c1"># - Trillian</span>
</span><span id="__span-5-48">    <span class="c1"># - Marvin</span>
</span><span id="__span-5-49">
</span><span id="__span-5-50">    <span class="k">return</span> <span class="n">document</span>
</span><span id="__span-5-51">
</span><span id="__span-5-52">
</span><span id="__span-5-53"><span class="k">def</span><span class="w"> </span><span class="nf">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-5-54">    <span class="c1"># only for test suite:</span>
</span><span id="__span-5-55">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-5-56">        <span class="k">return</span>
</span><span id="__span-5-57">    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;- Arthur</span><span class="se">\n</span><span class="s2">- Ford</span><span class="se">\n</span><span class="s2">- Trillian</span><span class="se">\n</span><span class="s2">- Marvin&quot;</span>
</span><span id="__span-5-58">
</span><span id="__span-5-59">
</span><span id="__span-5-60"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-5-61">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="create-a-basic-text-document-with-list-and-sublists">Create a basic text document with list and sublists</h3>
<p>Create a basic text document with list and sublists.</p>
<details class="code">
<summary>recipes/create_a_basic_text_document_with_list_and_sublists.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-6-2"><span class="sd">&quot;&quot;&quot;Create a basic text document with list and sublists.</span>
</span><span id="__span-6-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-6-4"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-6-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-6-6">
</span><span id="__span-6-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">ListItem</span>
</span><span id="__span-6-8">
</span><span id="__span-6-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">25</span>
</span><span id="__span-6-10"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;basic_sublist&quot;</span>
</span><span id="__span-6-11"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-6-12">
</span><span id="__span-6-13">
</span><span id="__span-6-14"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-6-15">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-6-16">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-6-17">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-6-18">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-6-19">
</span><span id="__span-6-20">
</span><span id="__span-6-21"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-6-22">    <span class="n">document</span> <span class="o">=</span> <span class="n">generate_document</span><span class="p">()</span>
</span><span id="__span-6-23">    <span class="n">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-6-24">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-6-25">
</span><span id="__span-6-26">
</span><span id="__span-6-27"><span class="k">def</span><span class="w"> </span><span class="nf">generate_document</span><span class="p">():</span>
</span><span id="__span-6-28">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-6-29">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-6-30">
</span><span id="__span-6-31">    <span class="c1"># Adding List</span>
</span><span id="__span-6-32">    <span class="n">name_list</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="s2">&quot;Arthur&quot;</span><span class="p">,</span> <span class="s2">&quot;Ford&quot;</span><span class="p">,</span> <span class="s2">&quot;Trillian&quot;</span><span class="p">])</span>
</span><span id="__span-6-33">    <span class="n">item</span> <span class="o">=</span> <span class="n">ListItem</span><span class="p">(</span><span class="s2">&quot;Marvin&quot;</span><span class="p">)</span>
</span><span id="__span-6-34">    <span class="n">name_list</span><span class="o">.</span><span class="n">append_item</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-6-35">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name_list</span><span class="p">)</span>
</span><span id="__span-6-36">
</span><span id="__span-6-37">    <span class="c1"># Adding Sublist</span>
</span><span id="__span-6-38">    <span class="c1"># A sublist is simply a list as an item of another list:</span>
</span><span id="__span-6-39">    <span class="n">item</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">List</span><span class="p">([</span><span class="s2">&quot;Paranoid Android&quot;</span><span class="p">,</span> <span class="s2">&quot;older than the universe&quot;</span><span class="p">]))</span>
</span><span id="__span-6-40">
</span><span id="__span-6-41">    <span class="c1"># See the result:</span>
</span><span id="__span-6-42">    <span class="nb">print</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">get_formatted_text</span><span class="p">())</span>
</span><span id="__span-6-43">    <span class="c1"># - Arthur</span>
</span><span id="__span-6-44">    <span class="c1"># - Ford</span>
</span><span id="__span-6-45">    <span class="c1"># - Trillian</span>
</span><span id="__span-6-46">    <span class="c1"># - Marvin</span>
</span><span id="__span-6-47">    <span class="c1">#   - Paranoid Android</span>
</span><span id="__span-6-48">    <span class="c1">#   - older than the universe</span>
</span><span id="__span-6-49">
</span><span id="__span-6-50">    <span class="c1"># Inserting List Item</span>
</span><span id="__span-6-51">    <span class="c1"># In case your forgot to insert an item:</span>
</span><span id="__span-6-52">    <span class="n">name_list</span><span class="o">.</span><span class="n">insert_item</span><span class="p">(</span><span class="s2">&quot;some dolphins&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-6-53">
</span><span id="__span-6-54">    <span class="c1"># Or you can insert it before another item:</span>
</span><span id="__span-6-55">    <span class="n">marvin</span> <span class="o">=</span> <span class="n">name_list</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;Marvin&quot;</span><span class="p">)</span>
</span><span id="__span-6-56">    <span class="n">name_list</span><span class="o">.</span><span class="n">insert_item</span><span class="p">(</span><span class="s2">&quot;Zaphod&quot;</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="n">marvin</span><span class="p">)</span>
</span><span id="__span-6-57">    <span class="c1"># Or after:</span>
</span><span id="__span-6-58">    <span class="n">name_list</span><span class="o">.</span><span class="n">insert_item</span><span class="p">(</span><span class="s2">&quot;and many others&quot;</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="n">marvin</span><span class="p">)</span>
</span><span id="__span-6-59">
</span><span id="__span-6-60">    <span class="c1"># See the result:</span>
</span><span id="__span-6-61">    <span class="nb">print</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">get_formatted_text</span><span class="p">())</span>
</span><span id="__span-6-62">    <span class="c1"># - Arthur</span>
</span><span id="__span-6-63">    <span class="c1"># - some dolphins</span>
</span><span id="__span-6-64">    <span class="c1"># - Ford</span>
</span><span id="__span-6-65">    <span class="c1"># - Trillian</span>
</span><span id="__span-6-66">    <span class="c1"># - Zaphod</span>
</span><span id="__span-6-67">    <span class="c1"># - Marvin</span>
</span><span id="__span-6-68">    <span class="c1">#   - Paranoid Android</span>
</span><span id="__span-6-69">    <span class="c1">#   - older than the universe</span>
</span><span id="__span-6-70">    <span class="c1"># - and many others</span>
</span><span id="__span-6-71">    <span class="c1">#</span>
</span><span id="__span-6-72">
</span><span id="__span-6-73">    <span class="k">return</span> <span class="n">document</span>
</span><span id="__span-6-74">
</span><span id="__span-6-75">
</span><span id="__span-6-76"><span class="k">def</span><span class="w"> </span><span class="nf">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-6-77">    <span class="c1"># only for test suite:</span>
</span><span id="__span-6-78">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-6-79">        <span class="k">return</span>
</span><span id="__span-6-80">    <span class="k">assert</span> <span class="n">document</span><span class="o">.</span><span class="n">get_formatted_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="p">(</span>
</span><span id="__span-6-81">        <span class="s2">&quot;- Arthur</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-6-82">        <span class="s2">&quot;- some dolphins</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-6-83">        <span class="s2">&quot;- Ford</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-6-84">        <span class="s2">&quot;- Trillian</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-6-85">        <span class="s2">&quot;- Zaphod</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-6-86">        <span class="s2">&quot;- Marvin</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-6-87">        <span class="s2">&quot;  </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-6-88">        <span class="s2">&quot;  - Paranoid Android</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-6-89">        <span class="s2">&quot;  - older than the universe</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-6-90">        <span class="s2">&quot;- and many others&quot;</span>
</span><span id="__span-6-91">    <span class="p">)</span>
</span><span id="__span-6-92">
</span><span id="__span-6-93">
</span><span id="__span-6-94"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-6-95">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="how-to-add-a-sublist-to-a-list">How to add a sublist to a list</h3>
<p>Minimal example of how to add a paragraph.</p>
<details class="code">
<summary>recipes/how_to_add_a_sublist_to_a_list.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><span class="sd">&quot;&quot;&quot;Minimal example of how to add a paragraph.</span>
</span><span id="__span-7-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-7-3">
</span><span id="__span-7-4"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">ListItem</span>
</span><span id="__span-7-5">
</span><span id="__span-7-6"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">27</span>
</span><span id="__span-7-7">
</span><span id="__span-7-8">
</span><span id="__span-7-9"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-7-10">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-7-11">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-7-12">
</span><span id="__span-7-13">    <span class="n">my_list</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="s2">&quot;chocolat&quot;</span><span class="p">,</span> <span class="s2">&quot;caf&quot;</span><span class="p">])</span>
</span><span id="__span-7-14">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>
</span><span id="__span-7-15">
</span><span id="__span-7-16">    <span class="n">item</span> <span class="o">=</span> <span class="n">ListItem</span><span class="p">(</span><span class="s2">&quot;th&quot;</span><span class="p">)</span>
</span><span id="__span-7-17">    <span class="n">my_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-7-18">
</span><span id="__span-7-19">    <span class="c1"># A sublist is simply a list as an item of another list</span>
</span><span id="__span-7-20">    <span class="n">item</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">List</span><span class="p">([</span><span class="s2">&quot;th vert&quot;</span><span class="p">,</span> <span class="s2">&quot;th rouge&quot;</span><span class="p">]))</span>
</span><span id="__span-7-21">
</span><span id="__span-7-22">    <span class="nb">print</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
</span><span id="__span-7-23">
</span><span id="__span-7-24">
</span><span id="__span-7-25"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-7-26">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="how-to-insert-a-new-item-within-a-list">How to insert a new item within a list</h3>
<p>Minimal example of how to insert a new item within a list.</p>
<details class="code">
<summary>recipes/how_to_insert_a_new_item_within_a_list.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><span class="sd">&quot;&quot;&quot;Minimal example of how to insert a new item within a list.</span>
</span><span id="__span-8-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-8-3">
</span><span id="__span-8-4"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
</span><span id="__span-8-5">
</span><span id="__span-8-6"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">28</span>
</span><span id="__span-8-7">
</span><span id="__span-8-8">
</span><span id="__span-8-9"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-8-10">
</span><span id="__span-8-11">    <span class="n">a_list</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="s2">&quot;chocolat&quot;</span><span class="p">,</span> <span class="s2">&quot;caf&quot;</span><span class="p">])</span>
</span><span id="__span-8-12">
</span><span id="__span-8-13">    <span class="c1"># In case your forgot to insert an important item:</span>
</span><span id="__span-8-14">    <span class="n">a_list</span><span class="o">.</span><span class="n">insert_item</span><span class="p">(</span><span class="s2">&quot;Chicore&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-8-15">
</span><span id="__span-8-16">    <span class="c1"># Or you can insert it before another item:</span>
</span><span id="__span-8-17">    <span class="n">cafe</span> <span class="o">=</span> <span class="n">a_list</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;caf&quot;</span><span class="p">)</span>
</span><span id="__span-8-18">    <span class="n">a_list</span><span class="o">.</span><span class="n">insert_item</span><span class="p">(</span><span class="s2">&quot;Chicore&quot;</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="n">cafe</span><span class="p">)</span>
</span><span id="__span-8-19">
</span><span id="__span-8-20">    <span class="c1"># Or after:</span>
</span><span id="__span-8-21">    <span class="n">a_list</span><span class="o">.</span><span class="n">insert_item</span><span class="p">(</span><span class="s2">&quot;Chicore&quot;</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="n">cafe</span><span class="p">)</span>
</span><span id="__span-8-22">
</span><span id="__span-8-23">
</span><span id="__span-8-24"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-8-25">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="how-to-add-an-item-to-a-list">How to add an item to a list</h3>
<p>Minimal example of how to add an item to a list.</p>
<details class="code">
<summary>recipes/how_to_add_an_item_to_a_list.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><span class="sd">&quot;&quot;&quot;Minimal example of how to add an item to a list.</span>
</span><span id="__span-9-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-9-3">
</span><span id="__span-9-4"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">ListItem</span>
</span><span id="__span-9-5">
</span><span id="__span-9-6"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">28</span>
</span><span id="__span-9-7">
</span><span id="__span-9-8">
</span><span id="__span-9-9"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-9-10">    <span class="n">a_list</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="s2">&quot;chocolat&quot;</span><span class="p">,</span> <span class="s2">&quot;caf&quot;</span><span class="p">])</span>
</span><span id="__span-9-11">    <span class="n">item</span> <span class="o">=</span> <span class="n">ListItem</span><span class="p">(</span><span class="s2">&quot;th&quot;</span><span class="p">)</span>
</span><span id="__span-9-12">    <span class="n">a_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-9-13">
</span><span id="__span-9-14">
</span><span id="__span-9-15"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-9-16">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="get-text-content-from-odt-file">Get text content from odt file</h3>
<p>Read the text content from an .odt file.</p>
<details class="code">
<summary>recipes/get_text_content_from_odt_file.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-10-2"><span class="sd">&quot;&quot;&quot;Read the text content from an .odt file.&quot;&quot;&quot;</span>
</span><span id="__span-10-3">
</span><span id="__span-10-4"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-10-5"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-10-6"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-10-7">
</span><span id="__span-10-8"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-10-9">
</span><span id="__span-10-10"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">30</span>
</span><span id="__span-10-11"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-10-12"><span class="c1"># ODF export of Wikipedia article Hitchhiker&#39;s Guide to the Galaxy (CC-By-SA) :</span>
</span><span id="__span-10-13"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;collection2.odt&quot;</span>
</span><span id="__span-10-14">
</span><span id="__span-10-15">
</span><span id="__span-10-16"><span class="k">def</span><span class="w"> </span><span class="nf">read_source_document</span><span class="p">():</span>
</span><span id="__span-10-17">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-10-18">        <span class="n">source</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-10-19">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="__span-10-20">        <span class="n">source</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span>
</span><span id="__span-10-21">    <span class="k">return</span> <span class="n">Document</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span id="__span-10-22">
</span><span id="__span-10-23">
</span><span id="__span-10-24"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-10-25">    <span class="n">doc</span> <span class="o">=</span> <span class="n">read_source_document</span><span class="p">()</span>
</span><span id="__span-10-26">
</span><span id="__span-10-27">    <span class="c1"># just verify what type of document it is:</span>
</span><span id="__span-10-28">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type of document:&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">get_type</span><span class="p">())</span>
</span><span id="__span-10-29">
</span><span id="__span-10-30">    <span class="c1"># A quick way to get the text content:</span>
</span><span id="__span-10-31">    <span class="n">text</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get_formatted_text</span><span class="p">()</span>
</span><span id="__span-10-32">
</span><span id="__span-10-33">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size :&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
</span><span id="__span-10-34">
</span><span id="__span-10-35">    <span class="c1"># Let&#39;s show the beginning :</span>
</span><span id="__span-10-36">    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">[:</span><span class="mi">320</span><span class="p">])</span>
</span><span id="__span-10-37">
</span><span id="__span-10-38">    <span class="c1"># only for test suite:</span>
</span><span id="__span-10-39">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-10-40">        <span class="k">return</span>
</span><span id="__span-10-41">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">==</span> <span class="mi">56828</span>
</span><span id="__span-10-42">
</span><span id="__span-10-43">
</span><span id="__span-10-44"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-10-45">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="create-a-basic-text-document-with-a-table-of-content">Create a basic text document with a table of content</h3>
<p>Create a basic text document with a table of content.</p>
<details class="code">
<summary>recipes/create_a_basic_text_document_with_a_table_of_content.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-11-2"><span class="sd">&quot;&quot;&quot;Create a basic text document with a table of content.</span>
</span><span id="__span-11-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-11-4"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-11-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-11-6">
</span><span id="__span-11-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">TOC</span><span class="p">,</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Paragraph</span>
</span><span id="__span-11-8">
</span><span id="__span-11-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">35</span>
</span><span id="__span-11-10"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;basic_toc&quot;</span>
</span><span id="__span-11-11"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-11-12"><span class="n">LOREM</span> <span class="o">=</span> <span class="p">(</span><span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;lorem.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
</span><span id="__span-11-13"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-11-14">
</span><span id="__span-11-15">
</span><span id="__span-11-16"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-11-17">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-11-18">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-11-19">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-11-20">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-11-21">
</span><span id="__span-11-22">
</span><span id="__span-11-23"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-11-24">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-11-25">    <span class="n">make_toc</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-11-26">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-11-27">
</span><span id="__span-11-28">
</span><span id="__span-11-29"><span class="k">def</span><span class="w"> </span><span class="nf">make_toc</span><span class="p">(</span><span class="n">document</span><span class="p">):</span>
</span><span id="__span-11-30">    <span class="c1"># Create the document</span>
</span><span id="__span-11-31">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-11-32">
</span><span id="__span-11-33">    <span class="c1"># Create the Table Of Content</span>
</span><span id="__span-11-34">    <span class="n">toc</span> <span class="o">=</span> <span class="n">TOC</span><span class="p">()</span>
</span><span id="__span-11-35">    <span class="c1"># Changing the default &quot;Table Of Content&quot; Title :</span>
</span><span id="__span-11-36">    <span class="n">toc</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;My Table of Content&quot;</span>
</span><span id="__span-11-37">
</span><span id="__span-11-38">    <span class="c1"># Do not forget to add the component to the document:</span>
</span><span id="__span-11-39">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toc</span><span class="p">)</span>
</span><span id="__span-11-40">
</span><span id="__span-11-41">    <span class="c1"># Add some content with headers</span>
</span><span id="__span-11-42">    <span class="n">title1</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">LOREM</span><span class="p">[:</span><span class="mi">70</span><span class="p">])</span>
</span><span id="__span-11-43">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title1</span><span class="p">)</span>
</span><span id="__span-11-44">    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="__span-11-45">        <span class="n">title</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">LOREM</span><span class="p">[</span><span class="n">idx</span> <span class="o">*</span> <span class="mi">5</span> <span class="p">:</span> <span class="mi">70</span> <span class="o">+</span> <span class="n">idx</span> <span class="o">*</span> <span class="mi">5</span><span class="p">])</span>
</span><span id="__span-11-46">        <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="__span-11-47">        <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="n">LOREM</span><span class="p">)</span>
</span><span id="__span-11-48">        <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-11-49">
</span><span id="__span-11-50">    <span class="c1"># Beware, update the TOC with the actual content. If not done there,</span>
</span><span id="__span-11-51">    <span class="c1"># the reader will need to &quot;update the table of content&quot; later.</span>
</span><span id="__span-11-52">    <span class="n">toc</span><span class="o">.</span><span class="n">fill</span><span class="p">()</span>
</span><span id="__span-11-53">
</span><span id="__span-11-54">    <span class="c1"># only for test suite:</span>
</span><span id="__span-11-55">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-11-56">        <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">toc</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span>
</span><span id="__span-11-57">            <span class="s2">&quot;1.1. Lorem ipsum dolor sit amet, consectetuer &quot;</span>
</span><span id="__span-11-58">            <span class="s2">&quot;adipiscing elit. Sed non risu&quot;</span>
</span><span id="__span-11-59">        <span class="p">)</span>
</span><span id="__span-11-60">
</span><span id="__span-11-61">
</span><span id="__span-11-62"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-11-63">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="how-to-add-a-table-of-content-to-a-document">How to add a table of content to a document</h3>
<p>Adding a table of content to an existing text document.</p>
<details class="code">
<summary>recipes/how_to_add_a_table_of_content_to_a_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-12-2"><span class="sd">&quot;&quot;&quot;Adding a table of content to an existing text document.</span>
</span><span id="__span-12-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-12-4"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-12-5">
</span><span id="__span-12-6"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">TOC</span><span class="p">,</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Paragraph</span><span class="p">,</span> <span class="n">Style</span>
</span><span id="__span-12-7">
</span><span id="__span-12-8"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">37</span>
</span><span id="__span-12-9"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;add_toc&quot;</span>
</span><span id="__span-12-10"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-12-11"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-12-12"><span class="n">SOURCE</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;collection.odt&quot;</span>
</span><span id="__span-12-13">
</span><span id="__span-12-14">
</span><span id="__span-12-15"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-12-16">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-12-17">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-12-18">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-12-19">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-12-20">
</span><span id="__span-12-21">
</span><span id="__span-12-22"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-12-23">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">SOURCE</span><span class="p">)</span>
</span><span id="__span-12-24">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-12-25">
</span><span id="__span-12-26">    <span class="c1"># here is a way to insert a page break:</span>
</span><span id="__span-12-27">    <span class="n">page_break_style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;page_break&quot;</span><span class="p">)</span>
</span><span id="__span-12-28">    <span class="n">page_break_style</span><span class="o">.</span><span class="n">set_properties</span><span class="p">({</span><span class="s2">&quot;fo:break-before&quot;</span><span class="p">:</span> <span class="s2">&quot;page&quot;</span><span class="p">})</span>
</span><span id="__span-12-29">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">page_break_style</span><span class="p">)</span>
</span><span id="__span-12-30">    <span class="n">empty_paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;page_break&quot;</span><span class="p">)</span>
</span><span id="__span-12-31">    <span class="n">body</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">empty_paragraph</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-12-32">
</span><span id="__span-12-33">    <span class="c1"># The TOC element comes from the toc module</span>
</span><span id="__span-12-34">    <span class="n">toc</span> <span class="o">=</span> <span class="n">TOC</span><span class="p">()</span>
</span><span id="__span-12-35">    <span class="c1"># to put the TOC at the end, just do:</span>
</span><span id="__span-12-36">    <span class="c1"># body.append(toc)</span>
</span><span id="__span-12-37">    <span class="n">body</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">toc</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-12-38">    <span class="c1"># fill the toc with current content of document:</span>
</span><span id="__span-12-39">    <span class="n">toc</span><span class="o">.</span><span class="n">fill</span><span class="p">()</span>
</span><span id="__span-12-40">
</span><span id="__span-12-41">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-12-42">
</span><span id="__span-12-43">
</span><span id="__span-12-44"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-12-45">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="update-a-text-document-with-a-table-of-content">Update a text document with a table of content</h3>
<p>Update the table of contents of a document.</p>
<details class="code">
<summary>recipes/update_a_text_document_with_a_table_of_content.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-13-2"><span class="sd">&quot;&quot;&quot;Update the table of contents of a document.</span>
</span><span id="__span-13-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-13-4">
</span><span id="__span-13-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-13-6">
</span><span id="__span-13-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Paragraph</span>
</span><span id="__span-13-8">
</span><span id="__span-13-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">38</span>
</span><span id="__span-13-10"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-13-11"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;doc_with_toc.odt&quot;</span>
</span><span id="__span-13-12"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;modified_toc&quot;</span>
</span><span id="__span-13-13"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-13-14">
</span><span id="__span-13-15">
</span><span id="__span-13-16"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-17">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-18">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-13-19">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-13-20">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-21">
</span><span id="__span-13-22">
</span><span id="__span-13-23"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-24">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span><span class="p">)</span>
</span><span id="__span-13-25">    <span class="n">update_toc</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-26">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-13-27">
</span><span id="__span-13-28">
</span><span id="__span-13-29"><span class="k">def</span><span class="w"> </span><span class="nf">update_toc</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-30">    <span class="n">check_toc_v1</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-31">    <span class="n">add_some_header</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-32">    <span class="n">check_toc_v2</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-33">    <span class="n">change_toc_title</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-34">    <span class="n">check_toc_v3</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-35">    <span class="n">change_toc_title_to_empty</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-36">    <span class="n">check_toc_v4</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-37">    <span class="n">remove_second_header_1b</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-38">    <span class="n">check_toc_v5</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-39">    <span class="n">add_toc_title</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-40">    <span class="n">check_toc_v6</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-41">
</span><span id="__span-13-42">
</span><span id="__span-13-43"><span class="k">def</span><span class="w"> </span><span class="nf">check_toc_v1</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-44">    <span class="n">toc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">toc</span>
</span><span id="__span-13-45">    <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">toc</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-13-46">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
</span><span id="__span-13-47">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Table of Contents&quot;</span><span class="p">)</span>
</span><span id="__span-13-48">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1. Lorem 1&quot;</span><span class="p">)</span>
</span><span id="__span-13-49">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1.1. Lorem 1A&quot;</span><span class="p">)</span>
</span><span id="__span-13-50">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1.2. Lorem 1B&quot;</span><span class="p">)</span>
</span><span id="__span-13-51">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1.3. Lorem 1C&quot;</span><span class="p">)</span>
</span><span id="__span-13-52">
</span><span id="__span-13-53">
</span><span id="__span-13-54"><span class="k">def</span><span class="w"> </span><span class="nf">add_some_header</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-55">    <span class="n">header</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;New header&quot;</span><span class="p">)</span>
</span><span id="__span-13-56">    <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
</span><span id="__span-13-57">    <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Some text after the new header.&quot;</span><span class="p">))</span>
</span><span id="__span-13-58">    <span class="c1"># update the table of contents</span>
</span><span id="__span-13-59">    <span class="n">toc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">toc</span>
</span><span id="__span-13-60">    <span class="n">toc</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-61">
</span><span id="__span-13-62">
</span><span id="__span-13-63"><span class="k">def</span><span class="w"> </span><span class="nf">check_toc_v2</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-64">    <span class="n">toc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">toc</span>
</span><span id="__span-13-65">    <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">toc</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-13-66">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
</span><span id="__span-13-67">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Table of Contents&quot;</span><span class="p">)</span>
</span><span id="__span-13-68">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1. Lorem 1&quot;</span><span class="p">)</span>
</span><span id="__span-13-69">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1.1. Lorem 1A&quot;</span><span class="p">)</span>
</span><span id="__span-13-70">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1.2. Lorem 1B&quot;</span><span class="p">)</span>
</span><span id="__span-13-71">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1.3. Lorem 1C&quot;</span><span class="p">)</span>
</span><span id="__span-13-72">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;2. New header&quot;</span><span class="p">)</span>
</span><span id="__span-13-73">
</span><span id="__span-13-74">
</span><span id="__span-13-75"><span class="k">def</span><span class="w"> </span><span class="nf">change_toc_title</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-76">    <span class="n">toc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">toc</span>
</span><span id="__span-13-77">    <span class="n">toc</span><span class="o">.</span><span class="n">set_toc_title</span><span class="p">(</span><span class="s2">&quot;Another title&quot;</span><span class="p">)</span>
</span><span id="__span-13-78">    <span class="n">toc</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-79">
</span><span id="__span-13-80">
</span><span id="__span-13-81"><span class="k">def</span><span class="w"> </span><span class="nf">check_toc_v3</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-82">    <span class="n">toc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">toc</span>
</span><span id="__span-13-83">    <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">toc</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-13-84">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>
</span><span id="__span-13-85">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Another title&quot;</span><span class="p">)</span>
</span><span id="__span-13-86">
</span><span id="__span-13-87">
</span><span id="__span-13-88"><span class="k">def</span><span class="w"> </span><span class="nf">change_toc_title_to_empty</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-89">    <span class="n">toc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">toc</span>
</span><span id="__span-13-90">    <span class="n">toc</span><span class="o">.</span><span class="n">set_toc_title</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># that will remove the title</span>
</span><span id="__span-13-91">    <span class="n">toc</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-92">
</span><span id="__span-13-93">
</span><span id="__span-13-94"><span class="k">def</span><span class="w"> </span><span class="nf">check_toc_v4</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-95">    <span class="n">toc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">toc</span>
</span><span id="__span-13-96">    <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">toc</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-13-97">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
</span><span id="__span-13-98">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1. Lorem 1&quot;</span><span class="p">)</span>
</span><span id="__span-13-99">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1.1. Lorem 1A&quot;</span><span class="p">)</span>
</span><span id="__span-13-100">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1.2. Lorem 1B&quot;</span><span class="p">)</span>
</span><span id="__span-13-101">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1.3. Lorem 1C&quot;</span><span class="p">)</span>
</span><span id="__span-13-102">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;2. New header&quot;</span><span class="p">)</span>
</span><span id="__span-13-103">
</span><span id="__span-13-104">
</span><span id="__span-13-105"><span class="k">def</span><span class="w"> </span><span class="nf">remove_second_header_1b</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-106">    <span class="c1"># find second header:</span>
</span><span id="__span-13-107">    <span class="n">header</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-13-108">    <span class="c1"># this &#39;header&#39; variable is attached to the document, so</span>
</span><span id="__span-13-109">    <span class="c1"># deleting will remove the element from the document</span>
</span><span id="__span-13-110">    <span class="n">header</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</span><span id="__span-13-111">
</span><span id="__span-13-112">    <span class="n">toc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">toc</span>
</span><span id="__span-13-113">    <span class="n">toc</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-114">
</span><span id="__span-13-115">
</span><span id="__span-13-116"><span class="k">def</span><span class="w"> </span><span class="nf">check_toc_v5</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-117">    <span class="n">toc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">toc</span>
</span><span id="__span-13-118">    <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">toc</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-13-119">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
</span><span id="__span-13-120">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1. Lorem 1&quot;</span><span class="p">)</span>
</span><span id="__span-13-121">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1.1. Lorem 1A&quot;</span><span class="p">)</span>
</span><span id="__span-13-122">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1.2. Lorem 1C&quot;</span><span class="p">)</span>
</span><span id="__span-13-123">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;2. New header&quot;</span><span class="p">)</span>
</span><span id="__span-13-124">
</span><span id="__span-13-125">
</span><span id="__span-13-126"><span class="k">def</span><span class="w"> </span><span class="nf">add_toc_title</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-127">    <span class="n">toc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">toc</span>
</span><span id="__span-13-128">    <span class="n">toc</span><span class="o">.</span><span class="n">set_toc_title</span><span class="p">(</span><span class="s2">&quot;A new title&quot;</span><span class="p">)</span>
</span><span id="__span-13-129">    <span class="n">toc</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-13-130">
</span><span id="__span-13-131">
</span><span id="__span-13-132"><span class="k">def</span><span class="w"> </span><span class="nf">check_toc_v6</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-13-133">    <span class="n">toc</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">toc</span>
</span><span id="__span-13-134">    <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">toc</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-13-135">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
</span><span id="__span-13-136">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;A new title&quot;</span><span class="p">)</span>
</span><span id="__span-13-137">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1. Lorem 1&quot;</span><span class="p">)</span>
</span><span id="__span-13-138">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1.1. Lorem 1A&quot;</span><span class="p">)</span>
</span><span id="__span-13-139">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;1.2. Lorem 1C&quot;</span><span class="p">)</span>
</span><span id="__span-13-140">    <span class="k">assert</span> <span class="n">content</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;2. New header&quot;</span><span class="p">)</span>
</span><span id="__span-13-141">
</span><span id="__span-13-142">
</span><span id="__span-13-143"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-13-144">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="create-a-basic-text-document-with-annotations">Create a basic text document with annotations</h3>
<p>Create a basic text document with annotations.</p>
<details class="code">
<summary>recipes/create_a_basic_text_document_with_annotations.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-14-2"><span class="sd">&quot;&quot;&quot;Create a basic text document with annotations.</span>
</span><span id="__span-14-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-14-4"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-14-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-14-6">
</span><span id="__span-14-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Paragraph</span>
</span><span id="__span-14-8">
</span><span id="__span-14-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">40</span>
</span><span id="__span-14-10"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;basic_annotations&quot;</span>
</span><span id="__span-14-11"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-14-12"><span class="n">LOREM</span> <span class="o">=</span> <span class="p">(</span><span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;lorem.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
</span><span id="__span-14-13"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-14-14">
</span><span id="__span-14-15">
</span><span id="__span-14-16"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-14-17">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-14-18">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-14-19">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-14-20">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-14-21">
</span><span id="__span-14-22">
</span><span id="__span-14-23"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-14-24">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-14-25">    <span class="n">make_annotations</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-14-26">    <span class="n">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-14-27">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-14-28">
</span><span id="__span-14-29">
</span><span id="__span-14-30"><span class="k">def</span><span class="w"> </span><span class="nf">make_annotations</span><span class="p">(</span><span class="n">document</span><span class="p">):</span>
</span><span id="__span-14-31">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-14-32">    <span class="n">title1</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Main title&quot;</span><span class="p">)</span>
</span><span id="__span-14-33">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title1</span><span class="p">)</span>
</span><span id="__span-14-34">    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="__span-14-35">        <span class="n">title</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;title </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-14-36">        <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="__span-14-37">        <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="n">LOREM</span><span class="p">[:</span><span class="mi">240</span><span class="p">])</span>
</span><span id="__span-14-38">
</span><span id="__span-14-39">        <span class="c1"># Adding Annotation</span>
</span><span id="__span-14-40">        <span class="c1"># Annotations are notes that don&#39;t appear in the document but</span>
</span><span id="__span-14-41">        <span class="c1"># typically on a side bar in a desktop application. So they are not printed.</span>
</span><span id="__span-14-42">
</span><span id="__span-14-43">        <span class="c1"># Now we add some annotation on each paragraph</span>
</span><span id="__span-14-44">        <span class="n">some_word</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-14-45">        <span class="c1"># choosing the 4th word of the paragraph to insert the note</span>
</span><span id="__span-14-46">
</span><span id="__span-14-47">        <span class="n">paragraph</span><span class="o">.</span><span class="n">insert_annotation</span><span class="p">(</span>
</span><span id="__span-14-48">            <span class="n">after</span><span class="o">=</span><span class="n">some_word</span><span class="p">,</span>  <span class="c1"># The word after what the annotation is inserted.</span>
</span><span id="__span-14-49">            <span class="n">body</span><span class="o">=</span><span class="s2">&quot;It&#39;s so easy!&quot;</span><span class="p">,</span>  <span class="c1"># The annotation itself, at the end of the page.</span>
</span><span id="__span-14-50">            <span class="n">creator</span><span class="o">=</span><span class="s2">&quot;Bob&quot;</span><span class="p">,</span>  <span class="c1"># The author of the annotation.</span>
</span><span id="__span-14-51">            <span class="c1"># date= xxx              A datetime value, by default datetime.now().</span>
</span><span id="__span-14-52">        <span class="p">)</span>
</span><span id="__span-14-53">
</span><span id="__span-14-54">        <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-14-55">
</span><span id="__span-14-56">
</span><span id="__span-14-57"><span class="k">def</span><span class="w"> </span><span class="nf">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-14-58">    <span class="c1"># only for test suite:</span>
</span><span id="__span-14-59">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-14-60">        <span class="k">return</span>
</span><span id="__span-14-61">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_annotations</span><span class="p">(</span><span class="n">creator</span><span class="o">=</span><span class="s2">&quot;Bob&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="__span-14-62">
</span><span id="__span-14-63">
</span><span id="__span-14-64"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-14-65">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="create-a-basic-text-document-with-footnotes">Create a basic text document with footnotes</h3>
<p>Create a basic text document with footnotes.</p>
<details class="code">
<summary>recipes/create_a_basic_text_document_with_footnotes.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-15-2"><span class="sd">&quot;&quot;&quot;Create a basic text document with footnotes.</span>
</span><span id="__span-15-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-15-4"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-15-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-15-6">
</span><span id="__span-15-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Paragraph</span>
</span><span id="__span-15-8">
</span><span id="__span-15-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">45</span>
</span><span id="__span-15-10"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;basic_footnotes&quot;</span>
</span><span id="__span-15-11"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-15-12"><span class="n">LOREM</span> <span class="o">=</span> <span class="p">(</span><span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;lorem.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
</span><span id="__span-15-13"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-15-14">
</span><span id="__span-15-15">
</span><span id="__span-15-16"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-15-17">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-15-18">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-15-19">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-15-20">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-15-21">
</span><span id="__span-15-22">
</span><span id="__span-15-23"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-15-24">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-15-25">    <span class="n">make_footnotes</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-15-26">    <span class="n">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-15-27">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-15-28">
</span><span id="__span-15-29">
</span><span id="__span-15-30"><span class="k">def</span><span class="w"> </span><span class="nf">make_footnotes</span><span class="p">(</span><span class="n">document</span><span class="p">):</span>
</span><span id="__span-15-31">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-15-32">
</span><span id="__span-15-33">    <span class="c1"># Add content (See Create_a_basic_document.py)</span>
</span><span id="__span-15-34">    <span class="n">title1</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Main title&quot;</span><span class="p">)</span>
</span><span id="__span-15-35">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title1</span><span class="p">)</span>
</span><span id="__span-15-36">    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="__span-15-37">        <span class="n">title</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;title </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-15-38">        <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="__span-15-39">        <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="n">LOREM</span><span class="p">[:</span><span class="mi">240</span><span class="p">])</span>
</span><span id="__span-15-40">
</span><span id="__span-15-41">        <span class="c1"># Adding Footnote</span>
</span><span id="__span-15-42">        <span class="c1"># Now we add a footnote on each paragraph</span>
</span><span id="__span-15-43">        <span class="c1"># Notes are quite complex so they deserve a dedicated API on paragraphs:</span>
</span><span id="__span-15-44">        <span class="n">some_word</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="__span-15-45">        <span class="c1"># choosing the 4th word of the paragraph to insert the note</span>
</span><span id="__span-15-46">        <span class="n">paragraph</span><span class="o">.</span><span class="n">insert_note</span><span class="p">(</span>
</span><span id="__span-15-47">            <span class="n">after</span><span class="o">=</span><span class="n">some_word</span><span class="p">,</span>  <span class="c1"># The word after what the  citation is inserted.</span>
</span><span id="__span-15-48">            <span class="n">note_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;note</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># The unique identifier of the note in the document.</span>
</span><span id="__span-15-49">            <span class="n">citation</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>  <span class="c1"># The symbol the user sees to follow the footnote.</span>
</span><span id="__span-15-50">            <span class="n">body</span><span class="o">=</span><span class="p">(</span>
</span><span id="__span-15-51">                <span class="sa">f</span><span class="s1">&#39;Author</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">, A. (2007). &quot;How to cite references&quot;, Sample Editions.&#39;</span>
</span><span id="__span-15-52">                <span class="c1"># The footnote itself, at the end of the page.</span>
</span><span id="__span-15-53">            <span class="p">),</span>
</span><span id="__span-15-54">        <span class="p">)</span>
</span><span id="__span-15-55">
</span><span id="__span-15-56">        <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-15-57">
</span><span id="__span-15-58">
</span><span id="__span-15-59"><span class="k">def</span><span class="w"> </span><span class="nf">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-15-60">    <span class="c1"># only for test suite:</span>
</span><span id="__span-15-61">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-15-62">        <span class="k">return</span>
</span><span id="__span-15-63">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_notes</span><span class="p">())</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="__span-15-64">
</span><span id="__span-15-65">
</span><span id="__span-15-66"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-15-67">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="how-to-add-footnote-to-a-text-document">How to add footnote to a text document</h3>
<p>Minimal example of how to add an footnote to a text document.</p>
<details class="code">
<summary>recipes/how_to_add_footnote_to_a_text_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><span class="sd">&quot;&quot;&quot;Minimal example of how to add an footnote to a text document.</span>
</span><span id="__span-16-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-16-3">
</span><span id="__span-16-4"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Paragraph</span>
</span><span id="__span-16-5">
</span><span id="__span-16-6"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">47</span>
</span><span id="__span-16-7">
</span><span id="__span-16-8">
</span><span id="__span-16-9"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-16-10">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-16-11">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-16-12">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-16-13">
</span><span id="__span-16-14">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;A paragraph with a footnote about some references.&quot;</span><span class="p">)</span>
</span><span id="__span-16-15">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-16-16">
</span><span id="__span-16-17">    <span class="c1"># Notes are quite complex so they deserve a dedicated API on paragraphs:</span>
</span><span id="__span-16-18">    <span class="n">paragraph</span><span class="o">.</span><span class="n">insert_note</span><span class="p">(</span>
</span><span id="__span-16-19">        <span class="n">after</span><span class="o">=</span><span class="s2">&quot;graph&quot;</span><span class="p">,</span>
</span><span id="__span-16-20">        <span class="n">note_id</span><span class="o">=</span><span class="s2">&quot;note1&quot;</span><span class="p">,</span>
</span><span id="__span-16-21">        <span class="n">citation</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
</span><span id="__span-16-22">        <span class="n">body</span><span class="o">=</span><span class="s1">&#39;Author, A. (2007). &quot;How to cite references&quot; New York: McGraw-Hill.&#39;</span><span class="p">,</span>
</span><span id="__span-16-23">    <span class="p">)</span>
</span><span id="__span-16-24">
</span><span id="__span-16-25">    <span class="c1"># That looks complex so we detail the arguments:</span>
</span><span id="__span-16-26">    <span class="c1">#</span>
</span><span id="__span-16-27">    <span class="c1"># after    =&gt;   The word after what the  citation is inserted.</span>
</span><span id="__span-16-28">    <span class="c1"># note_id  =&gt;   The unique identifier of the note in the document.</span>
</span><span id="__span-16-29">    <span class="c1"># citation =&gt;   The symbol the user sees to follow the footnote.</span>
</span><span id="__span-16-30">    <span class="c1"># body     =&gt;   The footnote itself, at the end of the page.</span>
</span><span id="__span-16-31">    <span class="c1">#</span>
</span><span id="__span-16-32">    <span class="c1"># odfdo creates footnotes by default. To create endnotes (notes</span>
</span><span id="__span-16-33">    <span class="c1"># that appear at the end of the document), give the</span>
</span><span id="__span-16-34">    <span class="c1"># note_class=&#39;endnote&#39; parameter.</span>
</span><span id="__span-16-35">
</span><span id="__span-16-36">
</span><span id="__span-16-37"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-16-38">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="create-a-text-document-with-tables-in-it">Create a text document with tables in it</h3>
<p>Build a basic commercial document, with numerical values displayed in
both the text and in a table.</p>
<details class="code">
<summary>recipes/create_a_text_document_with_tables_in_it.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-17-2"><span class="sd">&quot;&quot;&quot;Build a basic commercial document, with numerical values displayed in</span>
</span><span id="__span-17-3"><span class="sd">both the text and in a table.</span>
</span><span id="__span-17-4"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-17-5">
</span><span id="__span-17-6"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-17-7">
</span><span id="__span-17-8"><span class="c1"># for cell style</span>
</span><span id="__span-17-9"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-17-10">    <span class="n">Cell</span><span class="p">,</span>
</span><span id="__span-17-11">    <span class="n">Document</span><span class="p">,</span>
</span><span id="__span-17-12">    <span class="n">Header</span><span class="p">,</span>
</span><span id="__span-17-13">    <span class="n">List</span><span class="p">,</span>
</span><span id="__span-17-14">    <span class="n">ListItem</span><span class="p">,</span>
</span><span id="__span-17-15">    <span class="n">Paragraph</span><span class="p">,</span>
</span><span id="__span-17-16">    <span class="n">Row</span><span class="p">,</span>
</span><span id="__span-17-17">    <span class="n">Table</span><span class="p">,</span>
</span><span id="__span-17-18">    <span class="n">create_table_cell_style</span><span class="p">,</span>
</span><span id="__span-17-19">    <span class="n">make_table_cell_border_string</span><span class="p">,</span>
</span><span id="__span-17-20"><span class="p">)</span>
</span><span id="__span-17-21">
</span><span id="__span-17-22"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">50</span>
</span><span id="__span-17-23"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;commercial&quot;</span>
</span><span id="__span-17-24"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;commercial.odt&quot;</span>
</span><span id="__span-17-25"><span class="n">TAX_RATE</span> <span class="o">=</span> <span class="mf">0.20</span>
</span><span id="__span-17-26">
</span><span id="__span-17-27">
</span><span id="__span-17-28"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-17-29">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-17-30">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-17-31">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-17-32">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-17-33">
</span><span id="__span-17-34">
</span><span id="__span-17-35"><span class="k">class</span><span class="w"> </span><span class="nc">Product</span><span class="p">:</span>
</span><span id="__span-17-36">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span>
</span><span id="__span-17-37">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Product </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-17-38">        <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span>
</span><span id="__span-17-39">
</span><span id="__span-17-40">
</span><span id="__span-17-41"><span class="k">def</span><span class="w"> </span><span class="nf">make_product_catalog</span><span class="p">():</span>
</span><span id="__span-17-42">    <span class="n">catalog</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-17-43">    <span class="n">price</span> <span class="o">=</span> <span class="mf">10.0</span>
</span><span id="__span-17-44">    <span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span><span id="__span-17-45">        <span class="n">catalog</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Product</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">65</span> <span class="o">+</span> <span class="n">prod</span><span class="p">),</span> <span class="n">price</span><span class="p">))</span>
</span><span id="__span-17-46">        <span class="n">price</span> <span class="o">+=</span> <span class="mf">10.5</span>
</span><span id="__span-17-47">    <span class="k">return</span> <span class="n">catalog</span>
</span><span id="__span-17-48">
</span><span id="__span-17-49">
</span><span id="__span-17-50"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-17-51">    <span class="n">document</span> <span class="o">=</span> <span class="n">generate_commercial</span><span class="p">()</span>
</span><span id="__span-17-52">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-17-53">
</span><span id="__span-17-54">
</span><span id="__span-17-55"><span class="k">def</span><span class="w"> </span><span class="nf">generate_commercial</span><span class="p">():</span>
</span><span id="__span-17-56">    <span class="n">commercial</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-17-57">    <span class="n">body</span> <span class="o">=</span> <span class="n">commercial</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-17-58">    <span class="n">catalog</span> <span class="o">=</span> <span class="n">make_product_catalog</span><span class="p">()</span>
</span><span id="__span-17-59">
</span><span id="__span-17-60">    <span class="n">title1</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Basic commercial document&quot;</span><span class="p">)</span>
</span><span id="__span-17-61">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title1</span><span class="p">)</span>
</span><span id="__span-17-62">    <span class="n">title11</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Available products&quot;</span><span class="p">)</span>
</span><span id="__span-17-63">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title11</span><span class="p">)</span>
</span><span id="__span-17-64">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Here the list:&quot;</span><span class="p">)</span>
</span><span id="__span-17-65">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-17-66">
</span><span id="__span-17-67">    <span class="c1"># List of products in a list :</span>
</span><span id="__span-17-68">    <span class="n">product_list</span> <span class="o">=</span> <span class="n">List</span><span class="p">()</span>  <span class="c1"># odfdo.List</span>
</span><span id="__span-17-69">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product_list</span><span class="p">)</span>
</span><span id="__span-17-70">    <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">catalog</span><span class="p">:</span>
</span><span id="__span-17-71">        <span class="n">item</span> <span class="o">=</span> <span class="n">ListItem</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2">, price: </span><span class="si">{</span><span class="n">product</span><span class="o">.</span><span class="n">price</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
</span><span id="__span-17-72">        <span class="n">product_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-17-73">
</span><span id="__span-17-74">    <span class="n">title12</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Your command&quot;</span><span class="p">)</span>
</span><span id="__span-17-75">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title12</span><span class="p">)</span>
</span><span id="__span-17-76">
</span><span id="__span-17-77">    <span class="n">command</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
</span><span id="__span-17-78">
</span><span id="__span-17-79">    <span class="c1"># A table in the text document :</span>
</span><span id="__span-17-80">    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;Table&quot;</span><span class="p">)</span>
</span><span id="__span-17-81">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="__span-17-82">    <span class="n">row</span> <span class="o">=</span> <span class="n">Row</span><span class="p">()</span>
</span><span id="__span-17-83">    <span class="n">row</span><span class="o">.</span><span class="n">set_values</span><span class="p">([</span><span class="s2">&quot;Product&quot;</span><span class="p">,</span> <span class="s2">&quot;Price&quot;</span><span class="p">,</span> <span class="s2">&quot;Quantity&quot;</span><span class="p">,</span> <span class="s2">&quot;Amount&quot;</span><span class="p">])</span>
</span><span id="__span-17-84">    <span class="n">table</span><span class="o">.</span><span class="n">set_row</span><span class="p">(</span><span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span><span id="__span-17-85">    <span class="c1"># or: table.set_row(0, row)</span>
</span><span id="__span-17-86">    <span class="n">row_number</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-17-87">    <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-17-88">        <span class="n">prod</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
</span><span id="__span-17-89">        <span class="n">row</span> <span class="o">=</span> <span class="n">Row</span><span class="p">()</span>
</span><span id="__span-17-90">        <span class="n">row</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">prod</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-17-91">        <span class="c1"># or : row.set_value(0, prod.name)</span>
</span><span id="__span-17-92">        <span class="n">cell</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">()</span>
</span><span id="__span-17-93">        <span class="n">cell</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
</span><span id="__span-17-94">            <span class="n">prod</span><span class="o">.</span><span class="n">price</span><span class="p">,</span>
</span><span id="__span-17-95">            <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prod</span><span class="o">.</span><span class="n">price</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span>
</span><span id="__span-17-96">            <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;EUR&quot;</span><span class="p">,</span>
</span><span id="__span-17-97">            <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
</span><span id="__span-17-98">        <span class="p">)</span>
</span><span id="__span-17-99">        <span class="n">row</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
</span><span id="__span-17-100">        <span class="c1"># or : row.set_cell(1, cell)</span>
</span><span id="__span-17-101">        <span class="n">row</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="p">)</span>
</span><span id="__span-17-102">        <span class="c1"># row.set_value(2, quantity)</span>
</span><span id="__span-17-103">        <span class="n">price</span> <span class="o">=</span> <span class="n">prod</span><span class="o">.</span><span class="n">price</span> <span class="o">*</span> <span class="n">quantity</span>
</span><span id="__span-17-104">        <span class="n">cell</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">()</span>
</span><span id="__span-17-105">        <span class="n">cell</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
</span><span id="__span-17-106">            <span class="n">price</span><span class="p">,</span>
</span><span id="__span-17-107">            <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">price</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span>
</span><span id="__span-17-108">            <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;EUR&quot;</span><span class="p">,</span>
</span><span id="__span-17-109">            <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
</span><span id="__span-17-110">        <span class="p">)</span>
</span><span id="__span-17-111">        <span class="n">row</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
</span><span id="__span-17-112">        <span class="n">row_number</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-17-113">        <span class="n">table</span><span class="o">.</span><span class="n">set_row</span><span class="p">(</span><span class="n">row_number</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span><span id="__span-17-114">
</span><span id="__span-17-115">    <span class="n">cols</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">width</span>
</span><span id="__span-17-116">    <span class="n">column</span> <span class="o">=</span> <span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="__span-17-117">
</span><span id="__span-17-118">    <span class="c1"># add merged empty row</span>
</span><span id="__span-17-119">    <span class="n">row</span> <span class="o">=</span> <span class="n">Row</span><span class="p">()</span>
</span><span id="__span-17-120">    <span class="n">row_number</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-17-121">    <span class="n">table</span><span class="o">.</span><span class="n">set_row</span><span class="p">(</span><span class="n">row_number</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span><span id="__span-17-122">    <span class="n">table</span><span class="o">.</span><span class="n">set_span</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">row_number</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">row_number</span><span class="p">))</span>
</span><span id="__span-17-123">
</span><span id="__span-17-124">    <span class="c1"># make total</span>
</span><span id="__span-17-125">    <span class="n">row</span> <span class="o">=</span> <span class="n">Row</span><span class="p">()</span>
</span><span id="__span-17-126">    <span class="n">row</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">column</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Total:&quot;</span><span class="p">)</span>
</span><span id="__span-17-127">    <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">get_column_values</span><span class="p">(</span><span class="n">column</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-17-128">    <span class="n">cell</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">()</span>
</span><span id="__span-17-129">    <span class="n">cell</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
</span><span id="__span-17-130">        <span class="n">total</span><span class="p">,</span>
</span><span id="__span-17-131">        <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span>
</span><span id="__span-17-132">        <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;EUR&quot;</span><span class="p">,</span>
</span><span id="__span-17-133">        <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
</span><span id="__span-17-134">    <span class="p">)</span>
</span><span id="__span-17-135">    <span class="n">row</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
</span><span id="__span-17-136">    <span class="n">row_number</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-17-137">    <span class="n">table</span><span class="o">.</span><span class="n">set_row</span><span class="p">(</span><span class="n">row_number</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span><span id="__span-17-138">
</span><span id="__span-17-139">    <span class="c1"># let merge some cells</span>
</span><span id="__span-17-140">    <span class="n">table</span><span class="o">.</span><span class="n">set_span</span><span class="p">((</span><span class="n">column</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">row_number</span><span class="p">,</span> <span class="n">column</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row_number</span><span class="p">),</span> <span class="n">merge</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-17-141">
</span><span id="__span-17-142">    <span class="n">row</span> <span class="o">=</span> <span class="n">Row</span><span class="p">()</span>
</span><span id="__span-17-143">    <span class="n">row</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">column</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Total with tax:&quot;</span><span class="p">)</span>
</span><span id="__span-17-144">    <span class="n">total</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">TAX_RATE</span>
</span><span id="__span-17-145">    <span class="n">cell</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">()</span>
</span><span id="__span-17-146">    <span class="n">cell</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
</span><span id="__span-17-147">        <span class="n">total</span><span class="p">,</span>
</span><span id="__span-17-148">        <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span>
</span><span id="__span-17-149">        <span class="n">currency</span><span class="o">=</span><span class="s2">&quot;EUR&quot;</span><span class="p">,</span>
</span><span id="__span-17-150">        <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
</span><span id="__span-17-151">    <span class="p">)</span>
</span><span id="__span-17-152">    <span class="n">row</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>
</span><span id="__span-17-153">    <span class="n">row_number</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-17-154">    <span class="n">table</span><span class="o">.</span><span class="n">set_row</span><span class="p">(</span><span class="n">row_number</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span><span id="__span-17-155">    <span class="c1"># let merge some cells</span>
</span><span id="__span-17-156">    <span class="n">table</span><span class="o">.</span><span class="n">set_span</span><span class="p">((</span><span class="n">column</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">row_number</span><span class="p">,</span> <span class="n">column</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row_number</span><span class="p">),</span> <span class="n">merge</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-17-157">
</span><span id="__span-17-158">    <span class="c1"># Let&#39;s add some style on first row</span>
</span><span id="__span-17-159">    <span class="n">border</span> <span class="o">=</span> <span class="n">make_table_cell_border_string</span><span class="p">(</span><span class="n">thick</span><span class="o">=</span><span class="s2">&quot;0.03cm&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
</span><span id="__span-17-160">    <span class="n">cell_style</span> <span class="o">=</span> <span class="n">create_table_cell_style</span><span class="p">(</span>
</span><span id="__span-17-161">        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="__span-17-162">        <span class="n">background_color</span><span class="o">=</span><span class="p">(</span><span class="mi">210</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">210</span><span class="p">),</span>
</span><span id="__span-17-163">        <span class="n">border_right</span><span class="o">=</span><span class="n">border</span><span class="p">,</span>
</span><span id="__span-17-164">        <span class="n">border_left</span><span class="o">=</span><span class="n">border</span><span class="p">,</span>
</span><span id="__span-17-165">        <span class="n">border_bottom</span><span class="o">=</span><span class="n">border</span><span class="p">,</span>
</span><span id="__span-17-166">        <span class="n">border_top</span><span class="o">=</span><span class="n">border</span><span class="p">,</span>
</span><span id="__span-17-167">    <span class="p">)</span>
</span><span id="__span-17-168">    <span class="n">style_name</span> <span class="o">=</span> <span class="n">commercial</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">cell_style</span><span class="p">,</span> <span class="n">automatic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-17-169">
</span><span id="__span-17-170">    <span class="n">row</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_row</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-17-171">    <span class="c1"># for cell in row.get_cells(): #possible, but .traverse() is better</span>
</span><span id="__span-17-172">    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">traverse</span><span class="p">():</span>
</span><span id="__span-17-173">        <span class="n">cell</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style_name</span>
</span><span id="__span-17-174">        <span class="n">row</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cell</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>
</span><span id="__span-17-175">    <span class="n">table</span><span class="o">.</span><span class="n">set_row</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span><span id="__span-17-176">
</span><span id="__span-17-177">    <span class="k">return</span> <span class="n">commercial</span>
</span><span id="__span-17-178">
</span><span id="__span-17-179">
</span><span id="__span-17-180"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-17-181">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="how-to-add-a-table-to-a-document">How to add a table to a document</h3>
<p>Minimal example of how to add a table to a text document.</p>
<details class="code">
<summary>recipes/how_to_add_a_table_to_a_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><span class="sd">&quot;&quot;&quot;Minimal example of how to add a table to a text document.</span>
</span><span id="__span-18-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-18-3"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Paragraph</span><span class="p">,</span> <span class="n">Table</span>
</span><span id="__span-18-4">
</span><span id="__span-18-5"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">55</span>
</span><span id="__span-18-6">
</span><span id="__span-18-7">
</span><span id="__span-18-8"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-18-9">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-18-10">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-18-11">
</span><span id="__span-18-12">    <span class="c1"># Let&#39;s add another section to make our document clear:</span>
</span><span id="__span-18-13">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Tables&quot;</span><span class="p">))</span>
</span><span id="__span-18-14">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;A 3x3 table:&quot;</span><span class="p">))</span>
</span><span id="__span-18-15">
</span><span id="__span-18-16">    <span class="c1"># Creating a table :</span>
</span><span id="__span-18-17">    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;Table 1&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-18-18">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="__span-18-19">
</span><span id="__span-18-20">
</span><span id="__span-18-21"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-18-22">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="create-a-text-document-from-plain-text-with-layout">Create a text document from plain text with layout</h3>
<p>Create a document with styles.</p>
<p>We want to:</p>
<ul>
<li>
<p>remove standard styles from the document</p>
</li>
<li>
<p>set some styles grabed from a styles.xml ODF file (or generated)</p>
</li>
<li>
<p>insert plain &ldquo;python&rdquo; text, containing some          , 
, and spaces</p>
</li>
</ul>
<details class="code">
<summary>recipes/create_a_text_document_from_plain_text_with_layout.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-19-2"><span class="sd">&quot;&quot;&quot;Create a document with styles.</span>
</span><span id="__span-19-3">
</span><span id="__span-19-4"><span class="sd"> We want to:</span>
</span><span id="__span-19-5">
</span><span id="__span-19-6"><span class="sd">  - remove standard styles from the document</span>
</span><span id="__span-19-7">
</span><span id="__span-19-8"><span class="sd">  - set some styles grabed from a styles.xml ODF file (or generated)</span>
</span><span id="__span-19-9">
</span><span id="__span-19-10"><span class="sd">  - insert plain &quot;python&quot; text, containing some \t , \n, and spaces</span>
</span><span id="__span-19-11"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-19-12"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-19-13">
</span><span id="__span-19-14"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Element</span><span class="p">,</span> <span class="n">Paragraph</span><span class="p">,</span> <span class="n">Style</span>
</span><span id="__span-19-15">
</span><span id="__span-19-16"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">60</span>
</span><span id="__span-19-17"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;styled2&quot;</span>
</span><span id="__span-19-18"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-19-19">
</span><span id="__span-19-20">
</span><span id="__span-19-21"><span class="c1"># Element is the base class of all odfdo classes.</span>
</span><span id="__span-19-22"><span class="c1"># Element.from_tag permits the creation of any ODF XML tag</span>
</span><span id="__span-19-23">
</span><span id="__span-19-24"><span class="c1"># some font styles :</span>
</span><span id="__span-19-25"><span class="n">_style_font_1</span> <span class="o">=</span> <span class="n">Element</span><span class="o">.</span><span class="n">from_tag</span><span class="p">(</span>
</span><span id="__span-19-26">    <span class="s1">&#39;&lt;style:font-face style:name=&quot;OpenSymbol&quot; svg:font-family=&quot;OpenSymbol&quot;/&gt;&#39;</span>
</span><span id="__span-19-27"><span class="p">)</span>
</span><span id="__span-19-28">
</span><span id="__span-19-29"><span class="n">_style_font_2</span> <span class="o">=</span> <span class="n">Element</span><span class="o">.</span><span class="n">from_tag</span><span class="p">(</span>
</span><span id="__span-19-30">    <span class="s1">&#39;&lt;style:font-face style:name=&quot;Liberation Serif&quot; &#39;</span>
</span><span id="__span-19-31">    <span class="s1">&#39;svg:font-family=&quot;Liberation Serif&quot; &#39;</span>
</span><span id="__span-19-32">    <span class="s1">&#39;style:font-family-generic=&quot;roman&quot; &#39;</span>
</span><span id="__span-19-33">    <span class="s1">&#39;style:font-pitch=&quot;variable&quot;/&gt;&#39;</span>
</span><span id="__span-19-34"><span class="p">)</span>
</span><span id="__span-19-35">
</span><span id="__span-19-36"><span class="n">_style_font_3</span> <span class="o">=</span> <span class="n">Element</span><span class="o">.</span><span class="n">from_tag</span><span class="p">(</span>
</span><span id="__span-19-37">    <span class="s1">&#39;&lt;style:font-face style:name=&quot;Liberation Sans&quot; &#39;</span>
</span><span id="__span-19-38">    <span class="s1">&#39;svg:font-family=&quot;Liberation Sans&quot; &#39;</span>
</span><span id="__span-19-39">    <span class="s1">&#39;style:font-family-generic=&quot;swiss&quot; &#39;</span>
</span><span id="__span-19-40">    <span class="s1">&#39;style:font-pitch=&quot;variable&quot;/&gt;&#39;</span>
</span><span id="__span-19-41"><span class="p">)</span>
</span><span id="__span-19-42">
</span><span id="__span-19-43"><span class="c1"># page layout style (changing margin)</span>
</span><span id="__span-19-44"><span class="n">_style_page</span> <span class="o">=</span> <span class="n">Element</span><span class="o">.</span><span class="n">from_tag</span><span class="p">(</span>
</span><span id="__span-19-45">    <span class="s1">&#39;&lt;style:page-layout style:name=&quot;MyLayout&quot;&gt;&#39;</span>
</span><span id="__span-19-46">    <span class="s1">&#39;&lt;style:page-layout-properties fo:page-width=&quot;21.00cm&quot; &#39;</span>
</span><span id="__span-19-47">    <span class="s1">&#39;fo:page-height=&quot;29.70cm&quot; style:num-format=&quot;1&quot; &#39;</span>
</span><span id="__span-19-48">    <span class="s1">&#39;style:print-orientation=&quot;portrait&quot; fo:margin-top=&quot;1.7cm&quot; &#39;</span>
</span><span id="__span-19-49">    <span class="s1">&#39;fo:margin-bottom=&quot;1.5cm&quot; fo:margin-left=&quot;1.6cm&quot; &#39;</span>
</span><span id="__span-19-50">    <span class="s1">&#39;fo:margin-right=&quot;1.6cm&quot; style:writing-mode=&quot;lr-tb&quot; &#39;</span>
</span><span id="__span-19-51">    <span class="s1">&#39;style:footnote-max-height=&quot;0cm&quot;&gt;&lt;style:footnote-sep &#39;</span>
</span><span id="__span-19-52">    <span class="s1">&#39;style:width=&quot;0.018cm&quot; style:distance-before-sep=&quot;0.10cm&quot; &#39;</span>
</span><span id="__span-19-53">    <span class="s1">&#39;style:distance-after-sep=&quot;0.10cm&quot; style:line-style=&quot;solid&quot; &#39;</span>
</span><span id="__span-19-54">    <span class="s1">&#39;style:adjustment=&quot;left&quot; style:rel-width=&quot;25%&quot; &#39;</span>
</span><span id="__span-19-55">    <span class="s1">&#39;style:color=&quot;#000000&quot;/&gt; &lt;/style:page-layout-properties&gt;&#39;</span>
</span><span id="__span-19-56">    <span class="s2">&quot;&lt;style:footer-style&gt; &quot;</span>
</span><span id="__span-19-57">    <span class="s1">&#39;&lt;style:header-footer-properties fo:min-height=&quot;0.6cm&quot; &#39;</span>
</span><span id="__span-19-58">    <span class="s1">&#39;fo:margin-left=&quot;0cm&quot; fo:margin-right=&quot;0cm&quot; &#39;</span>
</span><span id="__span-19-59">    <span class="s1">&#39;fo:margin-top=&quot;0.3cm&quot; style:dynamic-spacing=&quot;false&quot;/&gt; &#39;</span>
</span><span id="__span-19-60">    <span class="s2">&quot;&lt;/style:footer-style&gt;&lt;/style:page-layout&gt;&quot;</span>
</span><span id="__span-19-61"><span class="p">)</span>
</span><span id="__span-19-62">
</span><span id="__span-19-63"><span class="c1"># master style, using the precedent layout for the actual document</span>
</span><span id="__span-19-64"><span class="n">_style_master</span> <span class="o">=</span> <span class="n">Element</span><span class="o">.</span><span class="n">from_tag</span><span class="p">(</span>
</span><span id="__span-19-65">    <span class="s1">&#39;&lt;style:master-page style:name=&quot;Standard&quot; &#39;</span>
</span><span id="__span-19-66">    <span class="s1">&#39;style:page-layout-name=&quot;MyLayout&quot;&gt;&lt;style:footer&gt;&#39;</span>
</span><span id="__span-19-67">    <span class="s1">&#39;&lt;text:p text:style-name=&quot;Footer&quot;&gt; &#39;</span>
</span><span id="__span-19-68">    <span class="s2">&quot;&lt;text:tab/&gt;&lt;text:tab/&gt;&lt;text:page-number &quot;</span>
</span><span id="__span-19-69">    <span class="s1">&#39;text:select-page=&quot;current&quot;/&gt; / &lt;text:page-count &#39;</span>
</span><span id="__span-19-70">    <span class="s1">&#39;style:num-format=&quot;1&quot;&gt;15&lt;/text:page-count&gt;&#39;</span>
</span><span id="__span-19-71">    <span class="s2">&quot;&lt;/text:p&gt;&lt;/style:footer&gt; &quot;</span>
</span><span id="__span-19-72">    <span class="s2">&quot;&lt;/style:master-page&gt;&quot;</span>
</span><span id="__span-19-73"><span class="p">)</span>
</span><span id="__span-19-74">
</span><span id="__span-19-75"><span class="c1"># some footer</span>
</span><span id="__span-19-76"><span class="n">_style_footer</span> <span class="o">=</span> <span class="n">Element</span><span class="o">.</span><span class="n">from_tag</span><span class="p">(</span>
</span><span id="__span-19-77">    <span class="s1">&#39;&lt;style:style style:name=&quot;Footer&quot; &#39;</span>
</span><span id="__span-19-78">    <span class="s1">&#39;style:family=&quot;paragraph&quot; style:class=&quot;extra&quot; &#39;</span>
</span><span id="__span-19-79">    <span class="s1">&#39;style:master-page-name=&quot;&quot;&gt;&#39;</span>
</span><span id="__span-19-80">    <span class="s1">&#39;&lt;style:paragraph-properties style:page-number=&quot;auto&quot; &#39;</span>
</span><span id="__span-19-81">    <span class="s1">&#39;text:number-lines=&quot;false&quot; text:line-number=&quot;0&quot;&gt;&#39;</span>
</span><span id="__span-19-82">    <span class="s2">&quot;&lt;style:tab-stops&gt;&quot;</span>
</span><span id="__span-19-83">    <span class="s1">&#39;&lt;style:tab-stop style:position=&quot;8.90cm&quot; &#39;</span>
</span><span id="__span-19-84">    <span class="s1">&#39;style:type=&quot;center&quot;/&gt;&#39;</span>
</span><span id="__span-19-85">    <span class="s1">&#39;&lt;style:tab-stop style:position=&quot;17.80cm&quot; style:type=&quot;right&quot;/&gt;&#39;</span>
</span><span id="__span-19-86">    <span class="s2">&quot;&lt;/style:tab-stops&gt;&quot;</span>
</span><span id="__span-19-87">    <span class="s2">&quot;&lt;/style:paragraph-properties&gt;&quot;</span>
</span><span id="__span-19-88">    <span class="s2">&quot;&lt;style:text-properties &quot;</span>
</span><span id="__span-19-89">    <span class="s1">&#39;style:font-name=&quot;Liberation Sans&quot; &#39;</span>
</span><span id="__span-19-90">    <span class="s1">&#39;fo:font-size=&quot;7pt&quot;/&gt;&lt;/style:style&gt;&#39;</span>
</span><span id="__span-19-91"><span class="p">)</span>
</span><span id="__span-19-92">
</span><span id="__span-19-93"><span class="c1"># some text style using Liberation Sans font</span>
</span><span id="__span-19-94"><span class="n">_style_description</span> <span class="o">=</span> <span class="n">Element</span><span class="o">.</span><span class="n">from_tag</span><span class="p">(</span>
</span><span id="__span-19-95">    <span class="s1">&#39;&lt;style:style style:name=&quot;description&quot; &#39;</span>
</span><span id="__span-19-96">    <span class="s1">&#39;style:family=&quot;paragraph&quot; &#39;</span>
</span><span id="__span-19-97">    <span class="s1">&#39;style:class=&quot;text&quot; style:master-page-name=&quot;&quot;&gt;&#39;</span>
</span><span id="__span-19-98">    <span class="s2">&quot;&lt;style:paragraph-properties &quot;</span>
</span><span id="__span-19-99">    <span class="s1">&#39;fo:margin=&quot;100%&quot; fo:margin-left=&quot;0cm&quot; fo:margin-right=&quot;0cm&quot; &#39;</span>
</span><span id="__span-19-100">    <span class="s1">&#39;fo:margin-top=&quot;0.35cm&quot; fo:margin-bottom=&quot;0.10cm&quot; &#39;</span>
</span><span id="__span-19-101">    <span class="s1">&#39;style:contextual-spacing=&quot;false&quot; &#39;</span>
</span><span id="__span-19-102">    <span class="s1">&#39;fo:text-indent=&quot;0cm&quot; &#39;</span>
</span><span id="__span-19-103">    <span class="s1">&#39;style:auto-text-indent=&quot;false&quot; &#39;</span>
</span><span id="__span-19-104">    <span class="s1">&#39;style:page-number=&quot;auto&quot;/&gt;&#39;</span>
</span><span id="__span-19-105">    <span class="s2">&quot;&lt;style:text-properties &quot;</span>
</span><span id="__span-19-106">    <span class="s1">&#39;style:font-name=&quot;Liberation Sans&quot; &#39;</span>
</span><span id="__span-19-107">    <span class="s1">&#39;fo:font-size=&quot;11pt&quot;/&gt;&#39;</span>
</span><span id="__span-19-108">    <span class="s2">&quot;&lt;/style:style&gt;&quot;</span>
</span><span id="__span-19-109"><span class="p">)</span>
</span><span id="__span-19-110">
</span><span id="__span-19-111"><span class="c1"># some text style using Liberation Serif font</span>
</span><span id="__span-19-112"><span class="n">_style_small_serif</span> <span class="o">=</span> <span class="n">Element</span><span class="o">.</span><span class="n">from_tag</span><span class="p">(</span>
</span><span id="__span-19-113">    <span class="s1">&#39;&lt;style:style style:name=&quot;smallserif&quot; &#39;</span>
</span><span id="__span-19-114">    <span class="s1">&#39;style:family=&quot;paragraph&quot; style:class=&quot;text&quot;&gt;&#39;</span>
</span><span id="__span-19-115">    <span class="s1">&#39;&lt;style:paragraph-properties fo:margin=&quot;100%&quot; &#39;</span>
</span><span id="__span-19-116">    <span class="s1">&#39;fo:margin-left=&quot;1.20cm&quot; &#39;</span>
</span><span id="__span-19-117">    <span class="s1">&#39;fo:margin-right=&quot;0cm&quot; fo:margin-top=&quot;0cm&quot; &#39;</span>
</span><span id="__span-19-118">    <span class="s1">&#39;fo:margin-bottom=&quot;0.10cm&quot; &#39;</span>
</span><span id="__span-19-119">    <span class="s1">&#39;style:contextual-spacing=&quot;false&quot; &#39;</span>
</span><span id="__span-19-120">    <span class="s1">&#39;fo:text-indent=&quot;0cm&quot; &#39;</span>
</span><span id="__span-19-121">    <span class="s1">&#39;style:auto-text-indent=&quot;false&quot;/&gt;&#39;</span>
</span><span id="__span-19-122">    <span class="s1">&#39;&lt;style:text-properties style:font-name=&quot;Liberation Serif&quot; &#39;</span>
</span><span id="__span-19-123">    <span class="s1">&#39;fo:font-size=&quot;9pt&quot; &#39;</span>
</span><span id="__span-19-124">    <span class="s1">&#39;fo:font-weight=&quot;normal&quot;/&gt;&#39;</span>
</span><span id="__span-19-125">    <span class="s2">&quot;&lt;/style:style&gt;&quot;</span>
</span><span id="__span-19-126"><span class="p">)</span>
</span><span id="__span-19-127">
</span><span id="__span-19-128"><span class="c1"># some style to have stylish line in text</span>
</span><span id="__span-19-129"><span class="n">_style_line</span> <span class="o">=</span> <span class="n">Element</span><span class="o">.</span><span class="n">from_tag</span><span class="p">(</span>
</span><span id="__span-19-130">    <span class="s1">&#39;&lt;style:style style:name=&quot;line&quot; &#39;</span>
</span><span id="__span-19-131">    <span class="s1">&#39;style:family=&quot;paragraph&quot; style:class=&quot;text&quot;&gt;&#39;</span>
</span><span id="__span-19-132">    <span class="s1">&#39;&lt;style:paragraph-properties fo:margin=&quot;100%&quot; &#39;</span>
</span><span id="__span-19-133">    <span class="s1">&#39;fo:margin-left=&quot;0cm&quot; &#39;</span>
</span><span id="__span-19-134">    <span class="s1">&#39;fo:margin-right=&quot;0cm&quot; fo:margin-top=&quot;0cm&quot; &#39;</span>
</span><span id="__span-19-135">    <span class="s1">&#39;fo:margin-bottom=&quot;0.15cm&quot; &#39;</span>
</span><span id="__span-19-136">    <span class="s1">&#39;style:contextual-spacing=&quot;false&quot; fo:text-indent=&quot;0cm&quot; &#39;</span>
</span><span id="__span-19-137">    <span class="s1">&#39;style:auto-text-indent=&quot;false&quot; fo:padding=&quot;0cm&quot; &#39;</span>
</span><span id="__span-19-138">    <span class="s1">&#39;fo:border-left=&quot;none&quot; &#39;</span>
</span><span id="__span-19-139">    <span class="s1">&#39;fo:border-right=&quot;none&quot; fo:border-top=&quot;none&quot; &#39;</span>
</span><span id="__span-19-140">    <span class="s1">&#39;fo:border-bottom=&quot;0.06pt solid #000000&quot;/&gt;&#39;</span>
</span><span id="__span-19-141">    <span class="s1">&#39;&lt;style:text-properties style:font-name=&quot;Liberation Sans&quot; &#39;</span>
</span><span id="__span-19-142">    <span class="s1">&#39;fo:font-size=&quot;9pt&quot;/&gt;&#39;</span>
</span><span id="__span-19-143">    <span class="s2">&quot;&lt;/style:style&gt;&quot;</span>
</span><span id="__span-19-144"><span class="p">)</span>
</span><span id="__span-19-145">
</span><span id="__span-19-146"><span class="c1"># some odfdo generated style (for bold Span)</span>
</span><span id="__span-19-147"><span class="n">_style_bold</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bolder&quot;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-19-148">
</span><span id="__span-19-149">
</span><span id="__span-19-150"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-19-151">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-19-152">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-19-153">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-19-154">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-19-155">
</span><span id="__span-19-156">
</span><span id="__span-19-157"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-19-158">    <span class="c1"># Some plain text :</span>
</span><span id="__span-19-159">    <span class="n">text_1</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-19-160">        <span class="s2">&quot;Lorem ipsum dolor sit amet,</span><span class="se">\n\t</span><span class="s2">&quot;</span>
</span><span id="__span-19-161">        <span class="s2">&quot;consectetuer adipiscing elit.</span><span class="se">\n\t</span><span class="s2">Sed&quot;</span>
</span><span id="__span-19-162">        <span class="s2">&quot;non risus.</span><span class="se">\n\t</span><span class="s2">Suspendisse lectus tortor,</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-19-163">        <span class="s2">&quot;ndignissim sit amet, </span><span class="se">\n</span><span class="s2">adipiscing nec,&quot;</span>
</span><span id="__span-19-164">        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ultricies sed, dolor.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</span><span id="__span-19-165">        <span class="s2">&quot; Cras elementum ultrices diam. Maecenas ligula massa,&quot;</span>
</span><span id="__span-19-166">        <span class="s2">&quot;varius a,semper congue, euismod non,&quot;</span>
</span><span id="__span-19-167">        <span class="s2">&quot; mi. Proin porttitor, orci nec nonummy&quot;</span>
</span><span id="__span-19-168">        <span class="s2">&quot;molestie, enim est eleifend mi,&quot;</span>
</span><span id="__span-19-169">        <span class="s2">&quot; non fermentum diam nisl sit amet erat.&quot;</span>
</span><span id="__span-19-170">    <span class="p">)</span>
</span><span id="__span-19-171">
</span><span id="__span-19-172">    <span class="n">text_2</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-19-173">        <span class="s2">&quot;Vestibulum                 &quot;</span>
</span><span id="__span-19-174">        <span class="s2">&quot;ante               &quot;</span>
</span><span id="__span-19-175">        <span class="s2">&quot;ipsum             primis</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-19-176">        <span class="s2">&quot;in faucibus orci luctus et ultrices &quot;</span>
</span><span id="__span-19-177">        <span class="s2">&quot;posuere cubilia Curae; Aliquam nibh.&quot;</span>
</span><span id="__span-19-178">    <span class="p">)</span>
</span><span id="__span-19-179">
</span><span id="__span-19-180">    <span class="n">text_3</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-19-181">        <span class="s2">&quot;Duis semper. </span><span class="se">\n\t</span><span class="s2">Duis arcu massa,&quot;</span>
</span><span id="__span-19-182">        <span class="s2">&quot; </span><span class="se">\n\t\t</span><span class="s2">scelerisque vitae, </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-19-183">        <span class="s2">&quot;</span><span class="se">\t\t\t</span><span class="s2">consequat in, </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-19-184">        <span class="s2">&quot;</span><span class="se">\t\t\t\t</span><span class="s2">pretium a, enim. </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-19-185">        <span class="s2">&quot;</span><span class="se">\t\t\t\t\t</span><span class="s2">Pellentesque congue. </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-19-186">        <span class="s2">&quot;Ut in risus volutpat libero pharetra &quot;</span>
</span><span id="__span-19-187">        <span class="s2">&quot;tempor. Cras vestibulum bibendum augue.&quot;</span>
</span><span id="__span-19-188">        <span class="s2">&quot;Praesent egestas leo in pede. Praesent &quot;</span>
</span><span id="__span-19-189">        <span class="s2">&quot;blandit odio eu enim. Pellentesque sed&quot;</span>
</span><span id="__span-19-190">    <span class="p">)</span>
</span><span id="__span-19-191">
</span><span id="__span-19-192">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-19-193">    <span class="c1"># remove default styles</span>
</span><span id="__span-19-194">    <span class="n">document</span><span class="o">.</span><span class="n">delete_styles</span><span class="p">()</span>
</span><span id="__span-19-195">    <span class="c1"># add our styles</span>
</span><span id="__span-19-196">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">_style_font_1</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-19-197">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">_style_font_2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-19-198">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">_style_font_3</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-19-199">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">_style_page</span><span class="p">,</span> <span class="n">automatic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-19-200">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">_style_master</span><span class="p">)</span>
</span><span id="__span-19-201">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">_style_footer</span><span class="p">)</span>
</span><span id="__span-19-202">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">_style_description</span><span class="p">)</span>
</span><span id="__span-19-203">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">_style_small_serif</span><span class="p">)</span>
</span><span id="__span-19-204">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">_style_bold</span><span class="p">)</span>
</span><span id="__span-19-205">
</span><span id="__span-19-206">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-19-207">
</span><span id="__span-19-208">    <span class="c1"># since version 3.8.14, the append_plain_text() mode is the</span>
</span><span id="__span-19-209">    <span class="c1"># default for paragraph creation, so the code is more simple:</span>
</span><span id="__span-19-210">
</span><span id="__span-19-211">    <span class="c1"># paragraph = Paragraph(&quot;&quot;, style=&quot;description&quot;)</span>
</span><span id="__span-19-212">    <span class="c1"># paragraph.append_plain_text(text_1)</span>
</span><span id="__span-19-213">    <span class="c1"># body.append(paragraph)</span>
</span><span id="__span-19-214">
</span><span id="__span-19-215">    <span class="c1"># paragraph = Paragraph(style=&quot;line&quot;)</span>
</span><span id="__span-19-216">    <span class="c1"># body.append(paragraph)</span>
</span><span id="__span-19-217">
</span><span id="__span-19-218">    <span class="c1"># paragraph = Paragraph(style=&quot;smallserif&quot;)</span>
</span><span id="__span-19-219">    <span class="c1"># paragraph.append_plain_text(text_2)</span>
</span><span id="__span-19-220">    <span class="c1"># body.append(paragraph)</span>
</span><span id="__span-19-221">
</span><span id="__span-19-222">    <span class="c1"># paragraph = Paragraph(style=&quot;line&quot;)</span>
</span><span id="__span-19-223">    <span class="c1"># body.append(paragraph)</span>
</span><span id="__span-19-224">
</span><span id="__span-19-225">    <span class="c1"># paragraph = Paragraph(style=&quot;description&quot;)</span>
</span><span id="__span-19-226">    <span class="c1"># paragraph.append_plain_text(text_3)</span>
</span><span id="__span-19-227">
</span><span id="__span-19-228">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="n">text_1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
</span><span id="__span-19-229">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-19-230">
</span><span id="__span-19-231">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">)</span>
</span><span id="__span-19-232">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-19-233">
</span><span id="__span-19-234">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="n">text_2</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;smallserif&quot;</span><span class="p">)</span>
</span><span id="__span-19-235">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-19-236">
</span><span id="__span-19-237">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">)</span>
</span><span id="__span-19-238">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-19-239">
</span><span id="__span-19-240">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;A: &quot;</span> <span class="o">+</span> <span class="n">text_3</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
</span><span id="__span-19-241">    <span class="c1"># span offset become complex after inserting &lt;CR&gt; and &lt;TAB&gt; in a text</span>
</span><span id="__span-19-242">    <span class="n">paragraph</span><span class="o">.</span><span class="n">set_span</span><span class="p">(</span><span class="s2">&quot;bolder&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>  <span class="c1"># find TEXT position 5 : 6</span>
</span><span id="__span-19-243">    <span class="n">paragraph</span><span class="o">.</span><span class="n">set_span</span><span class="p">(</span><span class="s2">&quot;bolder&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># find TEXT position 18 : 4</span>
</span><span id="__span-19-244">    <span class="n">paragraph</span><span class="o">.</span><span class="n">set_span</span><span class="p">(</span><span class="s2">&quot;bolder&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">49</span><span class="p">)</span>  <span class="c1"># find TEXT position 18 to the end</span>
</span><span id="__span-19-245">    <span class="c1"># of the text bloc</span>
</span><span id="__span-19-246">    <span class="n">paragraph</span><span class="o">.</span><span class="n">set_span</span><span class="p">(</span><span class="s2">&quot;bolder&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Praes\w+\s\w+&quot;</span><span class="p">)</span>  <span class="c1"># regex: Praes. + next word</span>
</span><span id="__span-19-247">
</span><span id="__span-19-248">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-19-249">
</span><span id="__span-19-250">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">)</span>
</span><span id="__span-19-251">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-19-252">
</span><span id="__span-19-253">    <span class="c1"># it is possible to add the content without the original layout (\n, tab, spaces)</span>
</span><span id="__span-19-254">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;B: &quot;</span> <span class="o">+</span> <span class="n">text_3</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="n">formatted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-19-255">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-19-256">
</span><span id="__span-19-257">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">)</span>
</span><span id="__span-19-258">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-19-259">
</span><span id="__span-19-260">    <span class="c1"># text can also be append after paragraph creation</span>
</span><span id="__span-19-261">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
</span><span id="__span-19-262">    <span class="n">paragraph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;C: &quot;</span> <span class="o">+</span> <span class="n">text_3</span><span class="p">)</span>
</span><span id="__span-19-263">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-19-264">
</span><span id="__span-19-265">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-19-266">
</span><span id="__span-19-267">
</span><span id="__span-19-268"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-19-269">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="how-to-add-a-picture-to-a-text-document">How to add a picture to a text document</h3>
<p>Create an empty text document and add a picture in a frame.</p>
<details class="code">
<summary>recipes/how_to_add_a_picture_to_a_text_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-20-2"><span class="sd">&quot;&quot;&quot;Create an empty text document and add a picture in a frame.</span>
</span><span id="__span-20-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-20-4"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-20-5">
</span><span id="__span-20-6"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Frame</span><span class="p">,</span> <span class="n">Paragraph</span>
</span><span id="__span-20-7">
</span><span id="__span-20-8"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">65</span>
</span><span id="__span-20-9"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;basic_picture&quot;</span>
</span><span id="__span-20-10"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-20-11"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-20-12"><span class="n">IMAGE</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;newlogo.png&quot;</span>
</span><span id="__span-20-13">
</span><span id="__span-20-14">
</span><span id="__span-20-15"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-20-16">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-20-17">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-20-18">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-20-19">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-20-20">
</span><span id="__span-20-21">
</span><span id="__span-20-22"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-20-23">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-20-24">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-20-25">    <span class="n">image_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">DATA</span> <span class="o">/</span> <span class="n">IMAGE</span><span class="p">)</span>
</span><span id="__span-20-26">    <span class="n">uri</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
</span><span id="__span-20-27">    <span class="n">image_frame</span> <span class="o">=</span> <span class="n">Frame</span><span class="o">.</span><span class="n">image_frame</span><span class="p">(</span>
</span><span id="__span-20-28">        <span class="n">uri</span><span class="p">,</span>
</span><span id="__span-20-29">        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;6cm&quot;</span><span class="p">,</span> <span class="s2">&quot;4cm&quot;</span><span class="p">),</span>
</span><span id="__span-20-30">        <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;5cm&quot;</span><span class="p">,</span> <span class="s2">&quot;10cm&quot;</span><span class="p">),</span>
</span><span id="__span-20-31">    <span class="p">)</span>
</span><span id="__span-20-32">
</span><span id="__span-20-33">    <span class="c1"># put image frame in a paragraph:</span>
</span><span id="__span-20-34">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-20-35">    <span class="n">paragraph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_frame</span><span class="p">)</span>
</span><span id="__span-20-36">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-20-37">
</span><span id="__span-20-38">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-20-39">
</span><span id="__span-20-40">
</span><span id="__span-20-41"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-20-42">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="how-to-add-a-title-to-a-text-document">How to add a title to a text document</h3>
<p>Minimal example of how to add a Header of first level to a text document.</p>
<details class="code">
<summary>recipes/how_to_add_a_title_to_a_text_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><span class="sd">&quot;&quot;&quot;Minimal example of how to add a Header of first level to a text document.</span>
</span><span id="__span-21-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-21-3">
</span><span id="__span-21-4"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Header</span>
</span><span id="__span-21-5">
</span><span id="__span-21-6"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">67</span>
</span><span id="__span-21-7">
</span><span id="__span-21-8">
</span><span id="__span-21-9"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-21-10">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-21-11">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-21-12">
</span><span id="__span-21-13">    <span class="n">title1</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;The Title&quot;</span><span class="p">)</span>
</span><span id="__span-21-14">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title1</span><span class="p">)</span>
</span><span id="__span-21-15">
</span><span id="__span-21-16">
</span><span id="__span-21-17"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-21-18">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="accessing-a-single-element">Accessing a single element</h3>
<p>Example of methods and properties to analyse a document.</p>
<p>These methods return a single element (or None):</p>
<div class="language-text highlight"><pre><span></span><code>- `body.get_note(position)`
- `body.get_paragraph(position)`
- `body.get_header(position)`
</code></pre></div>
<details class="code">
<summary>recipes/accessing_a_single_element.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-22-2"><span class="sd">&quot;&quot;&quot;Example of methods and properties to analyse a document.</span>
</span><span id="__span-22-3">
</span><span id="__span-22-4"><span class="sd">These methods return a single element (or None):</span>
</span><span id="__span-22-5">
</span><span id="__span-22-6"><span class="sd">    - `body.get_note(position)`</span>
</span><span id="__span-22-7"><span class="sd">    - `body.get_paragraph(position)`</span>
</span><span id="__span-22-8"><span class="sd">    - `body.get_header(position)`</span>
</span><span id="__span-22-9"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-22-10"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-22-11"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-22-12">
</span><span id="__span-22-13"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-22-14">
</span><span id="__span-22-15"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">70</span>
</span><span id="__span-22-16"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-22-17"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;collection2.odt&quot;</span>
</span><span id="__span-22-18">
</span><span id="__span-22-19">
</span><span id="__span-22-20"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-22-21">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span><span class="p">)</span>
</span><span id="__span-22-22">
</span><span id="__span-22-23">    <span class="c1"># The body object is an XML element from which we can access one or several</span>
</span><span id="__span-22-24">    <span class="c1"># other elements we are looking for.</span>
</span><span id="__span-22-25">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-22-26">
</span><span id="__span-22-27">    <span class="c1"># Accessing a single element</span>
</span><span id="__span-22-28">    <span class="c1"># To access a single element by name, position or a regular expression on</span>
</span><span id="__span-22-29">    <span class="c1"># the content, use get_xxx_by_&lt;criteria&gt;, where criteria can be position,</span>
</span><span id="__span-22-30">    <span class="c1"># content, or for some of them name, id title, description.</span>
</span><span id="__span-22-31">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Content of the first footnote:&quot;</span><span class="p">)</span>
</span><span id="__span-22-32">    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_note</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
</span><span id="__span-22-33">    <span class="nb">print</span><span class="p">()</span>
</span><span id="__span-22-34">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Content of the paragraph with the word &#39;Fish&#39;&quot;</span><span class="p">)</span>
</span><span id="__span-22-35">    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraph</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;Fish&quot;</span><span class="p">)))</span>
</span><span id="__span-22-36">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Content of the first Title:&quot;</span><span class="p">)</span>
</span><span id="__span-22-37">    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
</span><span id="__span-22-38">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Content of the last Title:&quot;</span><span class="p">)</span>
</span><span id="__span-22-39">    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="n">position</span><span class="o">=-</span><span class="mi">1</span><span class="p">)))</span>
</span><span id="__span-22-40">
</span><span id="__span-22-41">    <span class="n">_expected_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-22-42"><span class="s2">    - Content of the first footnote:</span>
</span><span id="__span-22-43"><span class="s2">    1. [Gaiman, Neil](http://en.wikipedia.org/w/index.php?title=Neil_Gaiman)</span>
</span><span id="__span-22-44"><span class="s2">    (2003). Don&#39;t Panic: Douglas Adams and the &quot;Hitchhiker&#39;s Guide to the</span>
</span><span id="__span-22-45"><span class="s2">    Galaxy&quot;. Titan Books. pp.144145. ISBN1-84023-742-2.</span>
</span><span id="__span-22-46">
</span><span id="__span-22-47"><span class="s2">    - Content of the paragraph with the word &#39;Fish&#39;</span>
</span><span id="__span-22-48"><span class="s2">    In So Long, and Thanks for All the Fish (published in 1984), Arthur</span>
</span><span id="__span-22-49"><span class="s2">    returns home to Earth, rather surprisingly since it was destroyed when</span>
</span><span id="__span-22-50"><span class="s2">    he left. He meets and falls in love with a girl named</span>
</span><span id="__span-22-51"><span class="s2">    [Fenchurch](http://en.wikipedia.org/w/index.php?title=Minor_characters_from_The_Hitchhiker</span><span class="si">%27s</span><span class="s2">_Guide_to_the_Galaxy</span><span class="si">%23F</span><span class="s2">enchurch), and discovers this Earth is a replacement provided by the [dolphin](http://en.wikipedia.org/w/index.php?title=Dolphin)s in their Save the Humans campaign. Eventually he rejoins Ford, who claims to have saved the Universe in the meantime, to hitch-hike one last time and see God&#39;s Final Message to His Creation. Along the way, they are joined by Marvin, the Paranoid Android, who, although 37 times older than the universe itself (what with time</span>
</span><span id="__span-22-52"><span class="s2">    travel and all), has just enough power left in his failing body to read</span>
</span><span id="__span-22-53"><span class="s2">    the message and feel better about it all before expiring.</span>
</span><span id="__span-22-54">
</span><span id="__span-22-55"><span class="s2">    - Content of the first Title:</span>
</span><span id="__span-22-56"><span class="s2">    The Hitchhiker&#39;s Guide to the Galaxy</span>
</span><span id="__span-22-57">
</span><span id="__span-22-58"><span class="s2">    - Content of the last Title:</span>
</span><span id="__span-22-59"><span class="s2">    Official sites</span>
</span><span id="__span-22-60"><span class="s2">    &quot;&quot;&quot;</span>
</span><span id="__span-22-61">
</span><span id="__span-22-62">    <span class="n">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-22-63">
</span><span id="__span-22-64">
</span><span id="__span-22-65"><span class="k">def</span><span class="w"> </span><span class="nf">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-22-66">    <span class="c1"># only for test suite:</span>
</span><span id="__span-22-67">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-22-68">        <span class="k">return</span>
</span><span id="__span-22-69">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-22-70">    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_note</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
</span><span id="__span-22-71">    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_note</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
</span><span id="__span-22-72">        <span class="s2">&quot;1. [Gaiman, Neil](http://en.wikipedia.org/w/index.php?title=Neil_Gaiman) (2003)&quot;</span>
</span><span id="__span-22-73">    <span class="p">)</span>
</span><span id="__span-22-74">    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraph</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;Fish&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;all before expiring.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-22-75">    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;The Hitchhiker&#39;s Guide&quot;</span><span class="p">)</span>
</span><span id="__span-22-76">    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="n">position</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Official sites&quot;</span><span class="p">)</span>
</span><span id="__span-22-77">
</span><span id="__span-22-78">
</span><span id="__span-22-79"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-22-80">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="accessing-a-list-of-elements">Accessing a list of elements</h3>
<p>Example of methods and properties to analyse a document.</p>
<p>These methods or properties return a list of elements:</p>
<div class="language-text highlight"><pre><span></span><code>- `body.headers`
- `body.images`
- `body.paragraphs`
- `body.get_links()`
- `body.get_notes()`
- `body.tables`
- `body.get_paragraphs(content)`
</code></pre></div>
<details class="code">
<summary>recipes/accessing_a_list_of_elements.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-23-2"><span class="sd">&quot;&quot;&quot;Example of methods and properties to analyse a document.</span>
</span><span id="__span-23-3">
</span><span id="__span-23-4"><span class="sd">These methods or properties return a list of elements:</span>
</span><span id="__span-23-5">
</span><span id="__span-23-6"><span class="sd">    - `body.headers`</span>
</span><span id="__span-23-7"><span class="sd">    - `body.images`</span>
</span><span id="__span-23-8"><span class="sd">    - `body.paragraphs`</span>
</span><span id="__span-23-9"><span class="sd">    - `body.get_links()`</span>
</span><span id="__span-23-10"><span class="sd">    - `body.get_notes()`</span>
</span><span id="__span-23-11"><span class="sd">    - `body.tables`</span>
</span><span id="__span-23-12"><span class="sd">    - `body.get_paragraphs(content)`</span>
</span><span id="__span-23-13"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-23-14"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-23-15"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-23-16"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-23-17">
</span><span id="__span-23-18"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-23-19">
</span><span id="__span-23-20"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">75</span>
</span><span id="__span-23-21"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-23-22"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;collection2.odt&quot;</span>
</span><span id="__span-23-23">
</span><span id="__span-23-24">
</span><span id="__span-23-25"><span class="k">def</span><span class="w"> </span><span class="nf">read_source_document</span><span class="p">():</span>
</span><span id="__span-23-26">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-23-27">        <span class="n">source</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-23-28">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="__span-23-29">        <span class="n">source</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span>
</span><span id="__span-23-30">    <span class="k">return</span> <span class="n">Document</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span id="__span-23-31">
</span><span id="__span-23-32">
</span><span id="__span-23-33"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-23-34">    <span class="n">document</span> <span class="o">=</span> <span class="n">read_source_document</span><span class="p">()</span>
</span><span id="__span-23-35">
</span><span id="__span-23-36">    <span class="c1"># The body object is an XML element from which we can access one or several</span>
</span><span id="__span-23-37">    <span class="c1"># other elements we are looking for.</span>
</span><span id="__span-23-38">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-23-39">
</span><span id="__span-23-40">    <span class="c1"># Accessing a list of elements</span>
</span><span id="__span-23-41">    <span class="c1"># Should you need to access all elements of a kind, there are the</span>
</span><span id="__span-23-42">    <span class="c1"># get_xxxs methods, where xxx can be paragraph, heading, list, table, ...</span>
</span><span id="__span-23-43">    <span class="n">count_methods</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">body</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;get_&quot;</span><span class="p">)</span>
</span><span id="__span-23-44">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">count_methods</span><span class="si">}</span><span class="s2"> get methods are available&quot;</span><span class="p">)</span>
</span><span id="__span-23-45">    <span class="c1"># Some examples, that you can check against actual content of the odt file:</span>
</span><span id="__span-23-46">    <span class="c1"># See how complex is our wikipedia documents:</span>
</span><span id="__span-23-47">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of headings:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">headers</span><span class="p">))</span>
</span><span id="__span-23-48">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of images stored:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">images</span><span class="p">))</span>
</span><span id="__span-23-49">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of paragraphs:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">))</span>
</span><span id="__span-23-50">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of links (URLs):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_links</span><span class="p">()))</span>
</span><span id="__span-23-51">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of footnotes:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_notes</span><span class="p">()))</span>
</span><span id="__span-23-52">    <span class="c1"># Our sample document has no table:</span>
</span><span id="__span-23-53">    <span class="c1"># print(&quot;number of tables:&quot;, len(body.get_tables()))</span>
</span><span id="__span-23-54">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of tables:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">tables</span><span class="p">))</span>
</span><span id="__span-23-55">
</span><span id="__span-23-56">    <span class="c1"># Each get_xxx_list method provides parameters for filtering the results.</span>
</span><span id="__span-23-57">    <span class="c1"># For example headings can be listed by level, annotations by creator, etc.</span>
</span><span id="__span-23-58">    <span class="c1"># Almost all of them accept filtering by style and content using a regular</span>
</span><span id="__span-23-59">    <span class="c1"># expressions.</span>
</span><span id="__span-23-60">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Paragraphs with &#39;Fish&#39;:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraphs</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Fish&quot;</span><span class="p">)))</span>
</span><span id="__span-23-61">    <span class="nb">print</span><span class="p">(</span>
</span><span id="__span-23-62">        <span class="s2">&quot;Paragraphs with &#39;answer&#39; and &#39;42&#39;:&quot;</span><span class="p">,</span>
</span><span id="__span-23-63">        <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraphs</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;answer.*42&quot;</span><span class="p">)),</span>
</span><span id="__span-23-64">    <span class="p">)</span>
</span><span id="__span-23-65">
</span><span id="__span-23-66">    <span class="n">_expected_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-23-67"><span class="s2">    96 get methods are available</span>
</span><span id="__span-23-68"><span class="s2">    number of headings: 29</span>
</span><span id="__span-23-69"><span class="s2">    number of images stored: 0</span>
</span><span id="__span-23-70"><span class="s2">    number of paragraphs: 175</span>
</span><span id="__span-23-71"><span class="s2">    number of links (URLs): 352</span>
</span><span id="__span-23-72"><span class="s2">    number of footnotes: 49</span>
</span><span id="__span-23-73"><span class="s2">    number of tables: 0</span>
</span><span id="__span-23-74"><span class="s2">    Paragraphs with &#39;Fish&#39;: 4</span>
</span><span id="__span-23-75"><span class="s2">    Paragraphs with &#39;answer&#39; and &#39;42&#39;: 1</span>
</span><span id="__span-23-76"><span class="s2">    &quot;&quot;&quot;</span>
</span><span id="__span-23-77">
</span><span id="__span-23-78">    <span class="n">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-23-79">
</span><span id="__span-23-80">
</span><span id="__span-23-81"><span class="k">def</span><span class="w"> </span><span class="nf">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-23-82">    <span class="c1"># only for test suite:</span>
</span><span id="__span-23-83">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-23-84">        <span class="k">return</span>
</span><span id="__span-23-85">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-23-86">    <span class="n">count_methods</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">body</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;get_&quot;</span><span class="p">)</span>
</span><span id="__span-23-87">    <span class="k">assert</span> <span class="n">count_methods</span> <span class="o">==</span> <span class="mi">96</span>
</span><span id="__span-23-88">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">29</span>
</span><span id="__span-23-89">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">images</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="__span-23-90">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">175</span>
</span><span id="__span-23-91">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_links</span><span class="p">())</span> <span class="o">==</span> <span class="mi">352</span>
</span><span id="__span-23-92">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_notes</span><span class="p">())</span> <span class="o">==</span> <span class="mi">49</span>
</span><span id="__span-23-93">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraphs</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Fish&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">4</span>
</span><span id="__span-23-94">    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraphs</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;answer.*42&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="__span-23-95">
</span><span id="__span-23-96">
</span><span id="__span-23-97"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-23-98">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="accessing-other-element-from-element-like-list">Accessing other element from element like list</h3>
<p>Accessing elements from element-like list.</p>
<p>Any fetched element is a XML tree context that can be queried, but only on the subtree it
contains. Here are quick examples of iteration on <code>Paragraphs</code> and <code>Lists</code> from the document.</p>
<details class="code">
<summary>recipes/accessing_other_element_from_element_like_list.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-24-2"><span class="sd">&quot;&quot;&quot;Accessing elements from element-like list.</span>
</span><span id="__span-24-3">
</span><span id="__span-24-4"><span class="sd">Any fetched element is a XML tree context that can be queried, but only on the subtree it</span>
</span><span id="__span-24-5"><span class="sd">contains. Here are quick examples of iteration on `Paragraphs` and `Lists` from the document.</span>
</span><span id="__span-24-6"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-24-7"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-24-8"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-24-9">
</span><span id="__span-24-10"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-24-11">
</span><span id="__span-24-12"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">80</span>
</span><span id="__span-24-13"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-24-14"><span class="n">SOURCE</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;collection2.odt&quot;</span>
</span><span id="__span-24-15">
</span><span id="__span-24-16">
</span><span id="__span-24-17"><span class="k">def</span><span class="w"> </span><span class="nf">analyse_list</span><span class="p">(</span><span class="n">document</span><span class="p">):</span>
</span><span id="__span-24-18">    <span class="c1"># The body object is an XML element from which we can access one or several</span>
</span><span id="__span-24-19">    <span class="c1"># other elements we are looking for.</span>
</span><span id="__span-24-20">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-24-21">
</span><span id="__span-24-22">    <span class="c1"># Any element is a context for navigating but only on the subtree it</span>
</span><span id="__span-24-23">    <span class="c1"># contains. Just like the body was, but since the body contains all content,</span>
</span><span id="__span-24-24">    <span class="c1"># we didn&#39;t see the difference.</span>
</span><span id="__span-24-25">    <span class="c1"># Let&#39;s try the lists:</span>
</span><span id="__span-24-26">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of available lists in the document:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">lists</span><span class="p">))</span>
</span><span id="__span-24-27">    <span class="nb">print</span><span class="p">()</span>
</span><span id="__span-24-28">
</span><span id="__span-24-29">    <span class="n">list4</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get_list</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-24-30">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The 4th list contains </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list4</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">)</span><span class="si">}</span><span class="s2"> paragraphs&quot;</span><span class="p">)</span>
</span><span id="__span-24-31">    <span class="nb">print</span><span class="p">()</span>
</span><span id="__span-24-32">
</span><span id="__span-24-33">    <span class="c1"># Now print the list content</span>
</span><span id="__span-24-34">    <span class="n">paragraphs</span> <span class="o">=</span> <span class="n">list4</span><span class="o">.</span><span class="n">paragraphs</span>
</span><span id="__span-24-35">    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">paragraphs</span><span class="p">):</span>
</span><span id="__span-24-36">        <span class="nb">print</span><span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-24-37">
</span><span id="__span-24-38">    <span class="n">_expected_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-24-39"><span class="s2">    Number of available lists in the document: 5</span>
</span><span id="__span-24-40">
</span><span id="__span-24-41"><span class="s2">    The 4th list contains 9 paragraphs</span>
</span><span id="__span-24-42">
</span><span id="__span-24-43"><span class="s2">    1 : [BBC Cult website](http://www.bbc.co.uk/cult/hitchhikers/),</span>
</span><span id="__span-24-44"><span class="s2">    official website for the [TV show version](http://en.wikipedia.org/w/index.php?title=The_Hitchhiker</span><span class="si">%27s</span><span class="s2">_Guide_to_the_Galaxy_%28TV_series%29)</span>
</span><span id="__span-24-45"><span class="s2">    (includes information, links and downloads)</span>
</span><span id="__span-24-46">
</span><span id="__span-24-47"><span class="s2">    2 : [BBC Radio 4 website for the 20042005</span>
</span><span id="__span-24-48"><span class="s2">    series](http://www.bbc.co.uk/radio4/hitchhikers/)</span>
</span><span id="__span-24-49">
</span><span id="__span-24-50"><span class="s2">    3 : [Official Movie Site](http://hitchhikers.movies.go.com/)</span>
</span><span id="__span-24-51">
</span><span id="__span-24-52"><span class="s2">    4 : [The Hitchhiker&#39;s Guide to the Galaxy</span>
</span><span id="__span-24-53"><span class="s2">    (2005 movie)](http://www.imdb.com/title/tt0371724/)at the</span>
</span><span id="__span-24-54"><span class="s2">    [Internet Movie Database](http://en.wikipedia.org/w/index.php?title=Internet_Movie_Database)</span>
</span><span id="__span-24-55">
</span><span id="__span-24-56"><span class="s2">    5 : [The Hitch Hikers Guide to the Galaxy</span>
</span><span id="__span-24-57"><span class="s2">    (1981 TV series)](http://www.imdb.com/title/tt0081874/)at the</span>
</span><span id="__span-24-58"><span class="s2">    [Internet Movie Database](http://en.wikipedia.org/w/index.php?title=Internet_Movie_Database)</span>
</span><span id="__span-24-59">
</span><span id="__span-24-60"><span class="s2">    6 : [h2g2](http://www.bbc.co.uk/h2g2/guide/)</span>
</span><span id="__span-24-61">
</span><span id="__span-24-62"><span class="s2">    7 : [Encyclopedia of Television](http://www.museum.tv/archives/etv/H/htmlH/hitch-hickers/hitch-hickers.htm)</span>
</span><span id="__span-24-63">
</span><span id="__span-24-64"><span class="s2">    8 : [British Film Institute Screen Online](http://www.screenonline.org.uk/tv/id/560180/index.html)</span>
</span><span id="__span-24-65"><span class="s2">    page devoted to the TV series</span>
</span><span id="__span-24-66">
</span><span id="__span-24-67"><span class="s2">    9 : [DC Comics H2G2 site](http://www.dccomics.com/graphic_novels/?gn=1816)</span>
</span><span id="__span-24-68"><span class="s2">    &quot;&quot;&quot;</span>  <span class="c1"># noqa: RUF001</span>
</span><span id="__span-24-69">
</span><span id="__span-24-70">    <span class="c1"># only for test suite:</span>
</span><span id="__span-24-71">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-24-72">        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
</span><span id="__span-24-73">        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">list4</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">9</span>
</span><span id="__span-24-74">        <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">paragraphs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[BBC Cult website](http&quot;</span><span class="p">)</span>
</span><span id="__span-24-75">        <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">paragraphs</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[DC Comics H2G2 site](http&quot;</span><span class="p">)</span>
</span><span id="__span-24-76">
</span><span id="__span-24-77">
</span><span id="__span-24-78"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-24-79">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">SOURCE</span><span class="p">)</span>
</span><span id="__span-24-80">    <span class="n">analyse_list</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-24-81">
</span><span id="__span-24-82">
</span><span id="__span-24-83"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-24-84">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="how-to-add-a-list-to-a-text-document">How to add a list to a text document</h3>
<p>Create an empty text document and add a list.</p>
<details class="code">
<summary>recipes/how_to_add_a_list_to_a_text_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-25-2"><span class="sd">&quot;&quot;&quot;Create an empty text document and add a list.</span>
</span><span id="__span-25-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-25-4"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-25-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-25-6">
</span><span id="__span-25-7"><span class="c1"># Lists are a dedicated object List</span>
</span><span id="__span-25-8"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">List</span>
</span><span id="__span-25-9">
</span><span id="__span-25-10"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">90</span>
</span><span id="__span-25-11"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;add_list&quot;</span>
</span><span id="__span-25-12"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-25-13">
</span><span id="__span-25-14">
</span><span id="__span-25-15"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-25-16">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-25-17">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-25-18">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-25-19">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-25-20">
</span><span id="__span-25-21">
</span><span id="__span-25-22"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-25-23">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-25-24">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-25-25">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-25-26">    <span class="n">some_list</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="s2">&quot;chocolate&quot;</span><span class="p">,</span> <span class="s2">&quot;tea&quot;</span><span class="p">,</span> <span class="s2">&quot;coffee&quot;</span><span class="p">])</span>
</span><span id="__span-25-27">    <span class="c1"># The list factory accepts a Python list of strings and list items.</span>
</span><span id="__span-25-28">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">some_list</span><span class="p">)</span>
</span><span id="__span-25-29">
</span><span id="__span-25-30">    <span class="n">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-25-31">
</span><span id="__span-25-32">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-25-33">
</span><span id="__span-25-34">
</span><span id="__span-25-35"><span class="k">def</span><span class="w"> </span><span class="nf">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-25-36">    <span class="c1"># only for test suite:</span>
</span><span id="__span-25-37">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-25-38">        <span class="k">return</span>
</span><span id="__span-25-39">    <span class="k">assert</span> <span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">get_formatted_text</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;- chocolate</span><span class="se">\n</span><span class="s2">- tea</span><span class="se">\n</span><span class="s2">- coffee&quot;</span>
</span><span id="__span-25-40">
</span><span id="__span-25-41">
</span><span id="__span-25-42"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-25-43">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="how-to-add-a-manual-page-break">How to add a manual page break</h3>
<p>Adding a manual page break to a text document.</p>
<details class="code">
<summary>recipes/how_to_add_a_manual_page_break.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-26-2"><span class="sd">&quot;&quot;&quot;Adding a manual page break to a text document.</span>
</span><span id="__span-26-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-26-4"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-26-5">
</span><span id="__span-26-6"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">PageBreak</span><span class="p">,</span> <span class="n">Paragraph</span><span class="p">,</span> <span class="n">Style</span>
</span><span id="__span-26-7">
</span><span id="__span-26-8"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">95</span>
</span><span id="__span-26-9"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;page_break&quot;</span>
</span><span id="__span-26-10"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-26-11">
</span><span id="__span-26-12">
</span><span id="__span-26-13"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-26-14">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-26-15">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-26-16">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-26-17">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-26-18">
</span><span id="__span-26-19">
</span><span id="__span-26-20"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-26-21">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">()</span>
</span><span id="__span-26-22">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-26-23">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-26-24">
</span><span id="__span-26-25">    <span class="c1"># here a simple way to insert a page break with odfdoshortcuts:</span>
</span><span id="__span-26-26">    <span class="n">document</span><span class="o">.</span><span class="n">add_page_break_style</span><span class="p">()</span>
</span><span id="__span-26-27">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;First paragraph&quot;</span><span class="p">))</span>
</span><span id="__span-26-28">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PageBreak</span><span class="p">())</span>
</span><span id="__span-26-29">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Second paragraph&quot;</span><span class="p">))</span>
</span><span id="__span-26-30">
</span><span id="__span-26-31">    <span class="c1"># here is a different way to insert a page break:</span>
</span><span id="__span-26-32">    <span class="n">page_break_style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;page_break_before&quot;</span><span class="p">)</span>
</span><span id="__span-26-33">    <span class="n">page_break_style</span><span class="o">.</span><span class="n">set_properties</span><span class="p">({</span><span class="s2">&quot;fo:break-before&quot;</span><span class="p">:</span> <span class="s2">&quot;page&quot;</span><span class="p">})</span>
</span><span id="__span-26-34">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">page_break_style</span><span class="p">)</span>
</span><span id="__span-26-35">    <span class="n">empty_paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;page_break_before&quot;</span><span class="p">)</span>
</span><span id="__span-26-36">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">empty_paragraph</span><span class="p">)</span>
</span><span id="__span-26-37">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Third paragraph&quot;</span><span class="p">))</span>
</span><span id="__span-26-38">
</span><span id="__span-26-39">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-26-40">
</span><span id="__span-26-41">
</span><span id="__span-26-42"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-26-43">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="create-a-basic-drawing">Create a basic drawing</h3>
<p>Insert a circle and a lot of lines (a fractal) in a text document.</p>
<details class="code">
<summary>recipes/create_a_basic_drawing.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-27-2"><span class="sd">&quot;&quot;&quot;Insert a circle and a lot of lines (a fractal) in a text document.</span>
</span><span id="__span-27-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-27-4"><span class="kn">import</span><span class="w"> </span><span class="nn">cmath</span>
</span><span id="__span-27-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-27-6"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Union</span>
</span><span id="__span-27-7">
</span><span id="__span-27-8"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">EllipseShape</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">LineShape</span><span class="p">,</span> <span class="n">Paragraph</span>
</span><span id="__span-27-9">
</span><span id="__span-27-10"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="__span-27-11"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;basic_drawing&quot;</span>
</span><span id="__span-27-12"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;koch.odt&quot;</span>
</span><span id="__span-27-13">
</span><span id="__span-27-14"><span class="n">CYCLES</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># beware, 5 is big, 6 is too big to display...</span>
</span><span id="__span-27-15">
</span><span id="__span-27-16">
</span><span id="__span-27-17"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-27-18">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-27-19">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-27-20">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-27-21">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-27-22">
</span><span id="__span-27-23">
</span><span id="__span-27-24"><span class="k">def</span><span class="w"> </span><span class="nf">cm</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-27-25">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">cm&quot;</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-27-26">
</span><span id="__span-27-27">
</span><span id="__span-27-28"><span class="c1"># some graphic computations</span>
</span><span id="__span-27-29"><span class="k">class</span><span class="w"> </span><span class="nc">Vector</span><span class="p">:</span>
</span><span id="__span-27-30">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]):</span>
</span><span id="__span-27-31">        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
</span><span id="__span-27-32">        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>
</span><span id="__span-27-33">
</span><span id="__span-27-34">    <span class="k">def</span><span class="w"> </span><span class="nf">koch_split</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="__span-27-35">        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
</span><span id="__span-27-36">        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
</span><span id="__span-27-37">        <span class="n">m</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-27-38">        <span class="n">e</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-27-39">        <span class="k">return</span> <span class="p">[</span><span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">Vector</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="n">Vector</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">Vector</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)]</span>
</span><span id="__span-27-40">
</span><span id="__span-27-41">    <span class="k">def</span><span class="w"> </span><span class="nf">centimeter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="__span-27-42">        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-27-43">            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
</span><span id="__span-27-44">        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-27-45">            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
</span><span id="__span-27-46">        <span class="k">return</span> <span class="p">(</span><span class="n">cm</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">real</span><span class="p">),</span> <span class="n">cm</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">imag</span><span class="p">))</span>
</span><span id="__span-27-47">
</span><span id="__span-27-48">
</span><span id="__span-27-49"><span class="k">def</span><span class="w"> </span><span class="nf">koch</span><span class="p">(</span><span class="n">vector_list</span><span class="p">,</span> <span class="n">cycle</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-27-50">    <span class="k">if</span> <span class="n">cycle</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-27-51">        <span class="k">return</span> <span class="n">vector_list</span>
</span><span id="__span-27-52">    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-27-53">        <span class="n">new_vector_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-27-54">        <span class="k">for</span> <span class="n">vector</span> <span class="ow">in</span> <span class="n">vector_list</span><span class="p">:</span>
</span><span id="__span-27-55">            <span class="n">new_vector_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">vector</span><span class="o">.</span><span class="n">koch_split</span><span class="p">())</span>
</span><span id="__span-27-56">        <span class="c1"># del vector_list</span>
</span><span id="__span-27-57">        <span class="k">return</span> <span class="n">koch</span><span class="p">(</span><span class="n">new_vector_list</span><span class="p">,</span> <span class="n">cycle</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-27-58">
</span><span id="__span-27-59">
</span><span id="__span-27-60"><span class="k">def</span><span class="w"> </span><span class="nf">make_fractal_coords</span><span class="p">(</span><span class="n">side</span><span class="p">,</span> <span class="n">vpos</span><span class="p">):</span>
</span><span id="__span-27-61">    <span class="n">orig</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">((</span><span class="mi">17</span> <span class="o">-</span> <span class="n">side</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">vpos</span><span class="p">)</span>
</span><span id="__span-27-62">    <span class="n">v1</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">orig</span> <span class="o">+</span> <span class="nb">complex</span><span class="p">(</span><span class="n">side</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="__span-27-63">    <span class="n">v2</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">orig</span> <span class="o">+</span> <span class="n">cmath</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="n">side</span><span class="p">,</span> <span class="n">cmath</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="__span-27-64">    <span class="n">v3</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="n">v2</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">orig</span><span class="p">)</span>
</span><span id="__span-27-65">    <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">v1</span><span class="o">.</span><span class="n">b</span> <span class="o">+</span> <span class="n">v2</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
</span><span id="__span-27-66">    <span class="n">vector_list</span> <span class="o">=</span> <span class="n">koch</span><span class="p">([</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">],</span> <span class="n">cycle</span><span class="o">=</span><span class="n">CYCLES</span><span class="p">)</span>
</span><span id="__span-27-67">    <span class="k">return</span> <span class="n">center</span><span class="p">,</span> <span class="n">vector_list</span>
</span><span id="__span-27-68">
</span><span id="__span-27-69">
</span><span id="__span-27-70"><span class="k">def</span><span class="w"> </span><span class="nf">generate_document</span><span class="p">():</span>
</span><span id="__span-27-71">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-27-72">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-27-73">
</span><span id="__span-27-74">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Making some Koch fractal&quot;</span><span class="p">)</span>
</span><span id="__span-27-75">    <span class="n">title</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Some Koch fractal&quot;</span><span class="p">)</span>
</span><span id="__span-27-76">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="__span-27-77">
</span><span id="__span-27-78">    <span class="n">style</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="s2">&quot;graphic&quot;</span><span class="p">)</span>
</span><span id="__span-27-79">    <span class="n">style</span><span class="o">.</span><span class="n">set_properties</span><span class="p">({</span><span class="s2">&quot;svg:stroke_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#0000ff&quot;</span><span class="p">})</span>
</span><span id="__span-27-80">    <span class="n">style</span><span class="o">.</span><span class="n">set_properties</span><span class="p">(</span><span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;#ffffcc&quot;</span><span class="p">)</span>
</span><span id="__span-27-81">
</span><span id="__span-27-82">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-27-83">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-27-84">
</span><span id="__span-27-85">    <span class="c1"># some computation of oordinates</span>
</span><span id="__span-27-86">    <span class="n">center</span><span class="p">,</span> <span class="n">vector_list</span> <span class="o">=</span> <span class="n">make_fractal_coords</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="mf">12.0</span><span class="p">,</span> <span class="n">vpos</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
</span><span id="__span-27-87">
</span><span id="__span-27-88">    <span class="c1"># create a circle</span>
</span><span id="__span-27-89">    <span class="n">radius</span> <span class="o">=</span> <span class="mf">8.0</span>
</span><span id="__span-27-90">    <span class="n">pos</span> <span class="o">=</span> <span class="n">center</span> <span class="o">-</span> <span class="nb">complex</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
</span><span id="__span-27-91">    <span class="n">circle</span> <span class="o">=</span> <span class="n">EllipseShape</span><span class="p">(</span>
</span><span id="__span-27-92">        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">cm</span><span class="p">(</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span> <span class="n">cm</span><span class="p">(</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)),</span>
</span><span id="__span-27-93">        <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="n">cm</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">real</span><span class="p">),</span> <span class="n">cm</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">imag</span><span class="p">)),</span>
</span><span id="__span-27-94">    <span class="p">)</span>
</span><span id="__span-27-95">    <span class="n">paragraph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
</span><span id="__span-27-96">
</span><span id="__span-27-97">    <span class="c1"># create a drawing with a lot of lines</span>
</span><span id="__span-27-98">    <span class="n">paragraph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;number of lines: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vector_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-27-99">    <span class="k">for</span> <span class="n">vector</span> <span class="ow">in</span> <span class="n">vector_list</span><span class="p">:</span>
</span><span id="__span-27-100">        <span class="n">line</span> <span class="o">=</span> <span class="n">LineShape</span><span class="p">(</span><span class="n">p1</span><span class="o">=</span><span class="n">vector</span><span class="o">.</span><span class="n">centimeter</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">p2</span><span class="o">=</span><span class="n">vector</span><span class="o">.</span><span class="n">centimeter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-27-101">        <span class="n">paragraph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="__span-27-102">
</span><span id="__span-27-103">    <span class="k">return</span> <span class="n">document</span>
</span><span id="__span-27-104">
</span><span id="__span-27-105">
</span><span id="__span-27-106"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-27-107">    <span class="n">document</span> <span class="o">=</span> <span class="n">generate_document</span><span class="p">()</span>
</span><span id="__span-27-108">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-27-109">
</span><span id="__span-27-110">
</span><span id="__span-27-111"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-27-112">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="add-private-annotations-to-a-document">Add private annotations to a document</h3>
<p>Add not printable annotations to a document.</p>
<p>Annotations are notes that do not appear in the document but typically
on a side bar in a desktop application. So they are not printed.</p>
<details class="code">
<summary>recipes/add_private_annotations_to_a_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-28-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-28-2"><span class="sd">&quot;&quot;&quot;Add not printable annotations to a document.</span>
</span><span id="__span-28-3">
</span><span id="__span-28-4"><span class="sd">Annotations are notes that do not appear in the document but typically</span>
</span><span id="__span-28-5"><span class="sd">on a side bar in a desktop application. So they are not printed.</span>
</span><span id="__span-28-6"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-28-7"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-28-8"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-28-9">
</span><span id="__span-28-10"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Paragraph</span>
</span><span id="__span-28-11">
</span><span id="__span-28-12"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">110</span>
</span><span id="__span-28-13"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;annotated&quot;</span>
</span><span id="__span-28-14"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;annotated_document.odt&quot;</span>
</span><span id="__span-28-15">
</span><span id="__span-28-16">
</span><span id="__span-28-17"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-28-18">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-28-19">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-28-20">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-28-21">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-28-22">
</span><span id="__span-28-23">
</span><span id="__span-28-24"><span class="k">def</span><span class="w"> </span><span class="nf">base_document</span><span class="p">():</span>
</span><span id="__span-28-25">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-28-26">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-28-27">
</span><span id="__span-28-28">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;De la Guerre des Gaules - Livre V&quot;</span><span class="p">))</span>
</span><span id="__span-28-29">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Prparatifs d&#39;expdition en Bretagne&quot;</span><span class="p">))</span>
</span><span id="__span-28-30">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-28-31">        <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-28-32">            <span class="s2">&quot;Sous le consulat de Lucius Domitius et d&#39;Appius Claudius, &quot;</span>
</span><span id="__span-28-33">            <span class="s2">&quot;Csar, quittant les quartiers d&#39;hiver pour aller en Italie, &quot;</span>
</span><span id="__span-28-34">            <span class="s2">&quot;comme il avait coutume de le faire chaque anne, ordonne aux &quot;</span>
</span><span id="__span-28-35">            <span class="s2">&quot;lieutenants qu&#39;il laissait  la tte des lgions de construire, &quot;</span>
</span><span id="__span-28-36">            <span class="s2">&quot;pendant l&#39;hiver, le plus de vaisseaux qu&#39;il serait possible, &quot;</span>
</span><span id="__span-28-37">            <span class="s2">&quot;et de rparer les anciens.&quot;</span>
</span><span id="__span-28-38">        <span class="p">)</span>
</span><span id="__span-28-39">    <span class="p">)</span>
</span><span id="__span-28-40">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;La Bretagne&quot;</span><span class="p">))</span>
</span><span id="__span-28-41">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-28-42">        <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-28-43">            <span class="s2">&quot;Cette le est de forme triangulaire ; l&#39;un des cts regarde &quot;</span>
</span><span id="__span-28-44">            <span class="s2">&quot;la Gaule. Des deux angles de ce ct, l&#39;un est au levant, &quot;</span>
</span><span id="__span-28-45">            <span class="s2">&quot;vers le pays de Cantium, o abordent presque tous les vaisseaux &quot;</span>
</span><span id="__span-28-46">            <span class="s2">&quot;gaulois ; l&#39;autre, plus bas, est au midi. La longueur de ce ct &quot;</span>
</span><span id="__span-28-47">            <span class="s2">&quot;est d&#39;environ cinq cent mille pas. &quot;</span>
</span><span id="__span-28-48">        <span class="p">)</span>
</span><span id="__span-28-49">    <span class="p">)</span>
</span><span id="__span-28-50">    <span class="k">return</span> <span class="n">document</span>
</span><span id="__span-28-51">
</span><span id="__span-28-52">
</span><span id="__span-28-53"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-28-54">    <span class="n">document</span> <span class="o">=</span> <span class="n">base_document</span><span class="p">()</span>
</span><span id="__span-28-55">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-28-56">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get_paragraph</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;consulat&quot;</span><span class="p">)</span>
</span><span id="__span-28-57">
</span><span id="__span-28-58">    <span class="c1"># Annotations are inserted like notes but they are simpler:</span>
</span><span id="__span-28-59">    <span class="c1"># Annotation arguments:</span>
</span><span id="__span-28-60">    <span class="c1"># after   =&gt;  The word after what the annotation is inserted.</span>
</span><span id="__span-28-61">    <span class="c1"># body    =&gt;  The annotation itself, at the end of the page.</span>
</span><span id="__span-28-62">    <span class="c1"># creator =&gt;  The author of the annotation.</span>
</span><span id="__span-28-63">    <span class="c1"># date    =&gt;  A datetime value, by default datetime.now().</span>
</span><span id="__span-28-64">    <span class="n">paragraph</span><span class="o">.</span><span class="n">insert_annotation</span><span class="p">(</span>
</span><span id="__span-28-65">        <span class="n">after</span><span class="o">=</span><span class="s2">&quot;Domitius&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s2">&quot;Talking about Lucius Domitius&quot;</span><span class="p">,</span> <span class="n">creator</span><span class="o">=</span><span class="s2">&quot;Luis&quot;</span>
</span><span id="__span-28-66">    <span class="p">)</span>
</span><span id="__span-28-67">
</span><span id="__span-28-68">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-28-69">
</span><span id="__span-28-70">    <span class="c1"># only for test suite:</span>
</span><span id="__span-28-71">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-28-72">        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_annotations</span><span class="p">(</span><span class="n">creator</span><span class="o">=</span><span class="s2">&quot;Luis&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="__span-28-73">
</span><span id="__span-28-74">
</span><span id="__span-28-75"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-28-76">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="accessibility-check-on-a-document">Accessibility check on a document</h3>
<p>Basic Accessibility test: check, for every picture in a document, if
there is:</p>
<ul>
<li>a title (svg_title),</li>
<li>a description (svg_description)</li>
</ul>
<p>or, at least, some caption text.</p>
<p>See test file <code>planes.odt</code> file and the result of the script.</p>
<details class="code">
<summary>recipes/accessibility_check_on_a_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-29-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-29-2"><span class="sd">&quot;&quot;&quot;Basic Accessibility test: check, for every picture in a document, if</span>
</span><span id="__span-29-3"><span class="sd">there is:</span>
</span><span id="__span-29-4">
</span><span id="__span-29-5"><span class="sd">  - a title (svg_title),</span>
</span><span id="__span-29-6"><span class="sd">  - a description (svg_description)</span>
</span><span id="__span-29-7">
</span><span id="__span-29-8"><span class="sd">or, at least, some caption text.</span>
</span><span id="__span-29-9">
</span><span id="__span-29-10"><span class="sd">See test file `planes.odt` file and the result of the script.</span>
</span><span id="__span-29-11"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-29-12"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-29-13"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-29-14"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-29-15">
</span><span id="__span-29-16"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-29-17">
</span><span id="__span-29-18"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">200</span>
</span><span id="__span-29-19"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-29-20"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;planes.odt&quot;</span>
</span><span id="__span-29-21">
</span><span id="__span-29-22">
</span><span id="__span-29-23"><span class="k">def</span><span class="w"> </span><span class="nf">read_source_document</span><span class="p">():</span>
</span><span id="__span-29-24">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-29-25">        <span class="n">source</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-29-26">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="__span-29-27">        <span class="n">source</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span>
</span><span id="__span-29-28">    <span class="k">return</span> <span class="n">Document</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span id="__span-29-29">
</span><span id="__span-29-30">
</span><span id="__span-29-31"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-29-32">    <span class="n">doc</span> <span class="o">=</span> <span class="n">read_source_document</span><span class="p">()</span>
</span><span id="__span-29-33">    <span class="c1"># We want the images of the document.</span>
</span><span id="__span-29-34">    <span class="n">body</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-29-35">    <span class="n">images</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">images</span>
</span><span id="__span-29-36">
</span><span id="__span-29-37">    <span class="n">nb_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
</span><span id="__span-29-38">    <span class="n">nb_title</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-29-39">    <span class="n">nb_description</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-29-40">    <span class="n">nb_caption</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-29-41">
</span><span id="__span-29-42">    <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
</span><span id="__span-29-43">        <span class="n">uri</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">url</span>
</span><span id="__span-29-44">        <span class="n">filename</span> <span class="o">=</span> <span class="n">uri</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-29-45">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image filename: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-29-46">        <span class="n">frame</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">parent</span>
</span><span id="__span-29-47">        <span class="n">name</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-29-48">        <span class="n">title</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">svg_title</span>
</span><span id="__span-29-49">        <span class="n">description</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">svg_description</span>
</span><span id="__span-29-50">        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
</span><span id="__span-29-51">            <span class="n">nb_title</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-29-52">        <span class="k">if</span> <span class="n">description</span><span class="p">:</span>
</span><span id="__span-29-53">            <span class="n">nb_description</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-29-54">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Name: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, title: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">, description: </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-29-55">        <span class="n">link</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">parent</span>
</span><span id="__span-29-56">        <span class="c1"># this part requires some ODF know how:</span>
</span><span id="__span-29-57">        <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;draw:a&quot;</span><span class="p">:</span>
</span><span id="__span-29-58">            <span class="n">caption</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;office:name&quot;</span><span class="p">)</span>
</span><span id="__span-29-59">            <span class="k">if</span> <span class="n">caption</span><span class="p">:</span>
</span><span id="__span-29-60">                <span class="n">nb_caption</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-29-61">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Caption: </span><span class="si">{</span><span class="n">caption</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-29-62">    <span class="nb">print</span><span class="p">()</span>
</span><span id="__span-29-63">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The document displays </span><span class="si">{</span><span class="n">nb_images</span><span class="si">}</span><span class="s2"> pictures:&quot;</span><span class="p">)</span>
</span><span id="__span-29-64">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; - pictures with a title: </span><span class="si">{</span><span class="n">nb_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-29-65">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; - pictures with a description: </span><span class="si">{</span><span class="n">nb_description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-29-66">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; - pictures with a caption: </span><span class="si">{</span><span class="n">nb_caption</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-29-67">
</span><span id="__span-29-68">    <span class="n">_expected_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-29-69"><span class="s2">    Image filename: 100000000000013B000000D345859F604DCE636A.jpg</span>
</span><span id="__span-29-70"><span class="s2">    Name: graphics2, title: Spitfire, general view, description: Green spitfire in a hall, view from left front.</span>
</span><span id="__span-29-71"><span class="s2">    Image filename: 100000000000013B000000D3F908DA0A939D2F4B.jpg</span>
</span><span id="__span-29-72"><span class="s2">    Name: graphics3, title: Spitfire, detail, description: None</span>
</span><span id="__span-29-73"><span class="s2">    Image filename: 100000000000013B000000D375CEBFD6D7CB7CE9.jpg</span>
</span><span id="__span-29-74"><span class="s2">    Name: graphics1, title: None, description: None</span>
</span><span id="__span-29-75">
</span><span id="__span-29-76"><span class="s2">    The document displays 3 pictures:</span>
</span><span id="__span-29-77"><span class="s2">     - pictures with a title: 2</span>
</span><span id="__span-29-78"><span class="s2">     - pictures with a description: 1</span>
</span><span id="__span-29-79"><span class="s2">     - pictures with a caption: 0</span>
</span><span id="__span-29-80"><span class="s2">    &quot;&quot;&quot;</span>
</span><span id="__span-29-81">
</span><span id="__span-29-82">    <span class="c1"># only for test suite:</span>
</span><span id="__span-29-83">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-29-84">        <span class="k">assert</span> <span class="n">nb_images</span> <span class="o">==</span> <span class="mi">3</span>
</span><span id="__span-29-85">        <span class="k">assert</span> <span class="n">nb_title</span> <span class="o">==</span> <span class="mi">2</span>
</span><span id="__span-29-86">        <span class="k">assert</span> <span class="n">nb_description</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="__span-29-87">        <span class="k">assert</span> <span class="n">nb_caption</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="__span-29-88">
</span><span id="__span-29-89">
</span><span id="__span-29-90"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-29-91">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="add-logo-on-presentation">Add logo on presentation</h3>
<p>Insert an image (e.g. the logo of an event, organization or a Creative Commons
attribution) with size <code>x,y</code> at position <code>x2,y2</code> on a number of slides in a
presentation slide deck.</p>
<details class="code">
<summary>recipes/add_logo_on_presentation.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-30-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-30-2"><span class="sd">&quot;&quot;&quot;Insert an image (e.g. the logo of an event, organization or a Creative Commons</span>
</span><span id="__span-30-3"><span class="sd">attribution) with size `x,y` at position `x2,y2` on a number of slides in a</span>
</span><span id="__span-30-4"><span class="sd">presentation slide deck.</span>
</span><span id="__span-30-5"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-30-6"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-30-7">
</span><span id="__span-30-8"><span class="c1"># reading image size requires a graphic library</span>
</span><span id="__span-30-9"><span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
</span><span id="__span-30-10">
</span><span id="__span-30-11"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Frame</span>
</span><span id="__span-30-12">
</span><span id="__span-30-13"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">250</span>
</span><span id="__span-30-14"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;add_logo&quot;</span>
</span><span id="__span-30-15"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;presentation.odp&quot;</span>
</span><span id="__span-30-16"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-30-17"><span class="n">SOURCE</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;presentation_wo_logo.odp&quot;</span>
</span><span id="__span-30-18"><span class="n">LOGO</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;newlogo.png&quot;</span>
</span><span id="__span-30-19">
</span><span id="__span-30-20">
</span><span id="__span-30-21"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-30-22">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-30-23">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-30-24">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-30-25">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-30-26">
</span><span id="__span-30-27">
</span><span id="__span-30-28"><span class="k">def</span><span class="w"> </span><span class="nf">make_image_size</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
</span><span id="__span-30-29">    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
</span><span id="__span-30-30">    <span class="n">ratio</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="n">size</span><span class="p">,</span> <span class="n">height</span> <span class="o">/</span> <span class="n">size</span><span class="p">)</span>
</span><span id="__span-30-31">    <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">width</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">cm&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">height</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">cm&quot;</span><span class="p">)</span>
</span><span id="__span-30-32">
</span><span id="__span-30-33">
</span><span id="__span-30-34"><span class="k">def</span><span class="w"> </span><span class="nf">add_logo</span><span class="p">(</span><span class="n">presentation</span><span class="p">):</span>
</span><span id="__span-30-35">    <span class="n">image_position</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;1.50cm&quot;</span><span class="p">,</span> <span class="s2">&quot;1.50cm&quot;</span><span class="p">)</span>
</span><span id="__span-30-36">    <span class="n">svg_title</span> <span class="o">=</span> <span class="s2">&quot;New Logo&quot;</span>
</span><span id="__span-30-37">    <span class="n">svg_description</span> <span class="o">=</span> <span class="s2">&quot;The new logo with blue background&quot;</span>
</span><span id="__span-30-38">
</span><span id="__span-30-39">    <span class="n">image_size</span> <span class="o">=</span> <span class="n">make_image_size</span><span class="p">(</span><span class="n">LOGO</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
</span><span id="__span-30-40">    <span class="n">presentation_body</span> <span class="o">=</span> <span class="n">presentation</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-30-41">    <span class="n">uri</span> <span class="o">=</span> <span class="n">presentation</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">LOGO</span><span class="p">))</span>
</span><span id="__span-30-42">
</span><span id="__span-30-43">    <span class="k">for</span> <span class="n">slide</span> <span class="ow">in</span> <span class="n">presentation_body</span><span class="o">.</span><span class="n">get_draw_pages</span><span class="p">():</span>
</span><span id="__span-30-44">        <span class="c1"># Create a frame for the image</span>
</span><span id="__span-30-45">        <span class="n">image_frame</span> <span class="o">=</span> <span class="n">Frame</span><span class="o">.</span><span class="n">image_frame</span><span class="p">(</span>
</span><span id="__span-30-46">            <span class="n">image</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span>
</span><span id="__span-30-47">            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Text over the image object</span>
</span><span id="__span-30-48">            <span class="n">size</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span>  <span class="c1"># Display size of image</span>
</span><span id="__span-30-49">            <span class="n">anchor_type</span><span class="o">=</span><span class="s2">&quot;page&quot;</span><span class="p">,</span>
</span><span id="__span-30-50">            <span class="n">page_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-30-51">            <span class="n">position</span><span class="o">=</span><span class="n">image_position</span><span class="p">,</span>
</span><span id="__span-30-52">            <span class="n">style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-30-53">        <span class="p">)</span>
</span><span id="__span-30-54">        <span class="n">image_frame</span><span class="o">.</span><span class="n">svg_title</span> <span class="o">=</span> <span class="n">svg_title</span>
</span><span id="__span-30-55">        <span class="n">image_frame</span><span class="o">.</span><span class="n">svg_description</span> <span class="o">=</span> <span class="n">svg_description</span>
</span><span id="__span-30-56">        <span class="n">slide</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_frame</span><span class="p">)</span>
</span><span id="__span-30-57">
</span><span id="__span-30-58">
</span><span id="__span-30-59"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-30-60">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">SOURCE</span><span class="p">)</span>
</span><span id="__span-30-61">    <span class="n">add_logo</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-30-62">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-30-63">
</span><span id="__span-30-64">
</span><span id="__span-30-65"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-30-66">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="get-pictures-from-document-odt">Get pictures from document odt</h3>
<p>Get all the pictures embeded in an .odt file.</p>
<details class="code">
<summary>recipes/get_pictures_from_document_odt.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-31-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-31-2"><span class="sd">&quot;&quot;&quot;Get all the pictures embeded in an .odt file.</span>
</span><span id="__span-31-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-31-4"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-31-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-31-6"><span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pformat</span>
</span><span id="__span-31-7">
</span><span id="__span-31-8"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-31-9">
</span><span id="__span-31-10"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">260</span>
</span><span id="__span-31-11"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-31-12"><span class="c1"># ODF export of Wikipedia article Hitchhiker&#39;s Guide to the Galaxy (CC-By-SA)</span>
</span><span id="__span-31-13"><span class="c1"># Remark: the document is badly made: the pictures are not displayed in the</span>
</span><span id="__span-31-14"><span class="c1"># text, but are sill inside the document !</span>
</span><span id="__span-31-15"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;collection.odt&quot;</span>
</span><span id="__span-31-16"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;found_pics&quot;</span>
</span><span id="__span-31-17">
</span><span id="__span-31-18">
</span><span id="__span-31-19"><span class="k">def</span><span class="w"> </span><span class="nf">read_source_document</span><span class="p">():</span>
</span><span id="__span-31-20">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-31-21">        <span class="n">source</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-31-22">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="__span-31-23">        <span class="n">source</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span>
</span><span id="__span-31-24">    <span class="k">return</span> <span class="n">Document</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span id="__span-31-25">
</span><span id="__span-31-26">
</span><span id="__span-31-27"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-31-28">    <span class="n">doc</span> <span class="o">=</span> <span class="n">read_source_document</span><span class="p">()</span>
</span><span id="__span-31-29">    <span class="c1"># show the list the content of the document parts</span>
</span><span id="__span-31-30">    <span class="n">parts</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">parts</span>
</span><span id="__span-31-31">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parts:&quot;</span><span class="p">)</span>
</span><span id="__span-31-32">    <span class="nb">print</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">parts</span><span class="p">))</span>
</span><span id="__span-31-33">    <span class="nb">print</span><span class="p">()</span>
</span><span id="__span-31-34">
</span><span id="__span-31-35">    <span class="c1"># We want the images of the document.</span>
</span><span id="__span-31-36">    <span class="n">body</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-31-37">    <span class="n">found_pics</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">images</span>
</span><span id="__span-31-38">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pics :&quot;</span><span class="p">)</span>
</span><span id="__span-31-39">    <span class="nb">print</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">found_pics</span><span class="p">))</span>
</span><span id="__span-31-40">    <span class="nb">print</span><span class="p">()</span>
</span><span id="__span-31-41">
</span><span id="__span-31-42">    <span class="c1"># we use the get_part function from odfdo to get the actual content</span>
</span><span id="__span-31-43">    <span class="c1"># of the image, to copy the images out of the .odt file:</span>
</span><span id="__span-31-44">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-31-45">    <span class="k">for</span> <span class="n">pic</span> <span class="ow">in</span> <span class="n">found_pics</span><span class="p">:</span>
</span><span id="__span-31-46">        <span class="c1"># where is the image actual content in the file:</span>
</span><span id="__span-31-47">        <span class="n">url</span> <span class="o">=</span> <span class="n">pic</span><span class="o">.</span><span class="n">url</span>
</span><span id="__span-31-48">        <span class="n">image_content</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get_part</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-31-49">        <span class="n">origin_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-31-50">        <span class="n">destination_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">origin_path</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-31-51">        <span class="n">destination_path</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">image_content</span><span class="p">)</span>
</span><span id="__span-31-52">
</span><span id="__span-31-53">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files in </span><span class="si">{</span><span class="n">OUTPUT_DIR</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="__span-31-54">    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
</span><span id="__span-31-55">        <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-31-56">
</span><span id="__span-31-57">
</span><span id="__span-31-58"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-31-59">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="change-image-in-many-documents">Change image in many documents</h3>
<p>Change an image in many ODF files.</p>
<p>This recipe is suitable for the scenario where an organization
is moving from one company logo to another and needs to replace
the logo in several hundred existing documents.</p>
<details class="code">
<summary>recipes/change_image_in_many_documents.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-32-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-32-2"><span class="sd">&quot;&quot;&quot;Change an image in many ODF files.</span>
</span><span id="__span-32-3">
</span><span id="__span-32-4"><span class="sd">This recipe is suitable for the scenario where an organization</span>
</span><span id="__span-32-5"><span class="sd">is moving from one company logo to another and needs to replace</span>
</span><span id="__span-32-6"><span class="sd">the logo in several hundred existing documents.</span>
</span><span id="__span-32-7"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-32-8"><span class="kn">from</span><span class="w"> </span><span class="nn">hashlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">sha256</span>
</span><span id="__span-32-9"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-32-10">
</span><span id="__span-32-11"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-32-12">
</span><span id="__span-32-13"><span class="n">counter_image</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-32-14"><span class="n">counter_odf</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-32-15"><span class="n">counter_hit</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-32-16">
</span><span id="__span-32-17"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">270</span>
</span><span id="__span-32-18"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;new_logo&quot;</span>
</span><span id="__span-32-19"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-32-20"><span class="n">OLD_PRESENTATIONS</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;old_presentations&quot;</span>
</span><span id="__span-32-21"><span class="n">OLD_LOGO</span> <span class="o">=</span> <span class="n">OLD_PRESENTATIONS</span> <span class="o">/</span> <span class="s2">&quot;oldlogo.png&quot;</span>
</span><span id="__span-32-22"><span class="n">NEW_LOGO</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;newlogo.png&quot;</span>
</span><span id="__span-32-23">
</span><span id="__span-32-24">
</span><span id="__span-32-25"><span class="k">def</span><span class="w"> </span><span class="nf">save_modified</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">):</span>
</span><span id="__span-32-26">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-32-27">    <span class="n">name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-32-28">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-32-29">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-32-30">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-32-31">
</span><span id="__span-32-32">
</span><span id="__span-32-33"><span class="k">def</span><span class="w"> </span><span class="nf">footprint</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-32-34">    <span class="k">return</span> <span class="n">sha256</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span><span id="__span-32-35">
</span><span id="__span-32-36">
</span><span id="__span-32-37"><span class="k">def</span><span class="w"> </span><span class="nf">update_document</span><span class="p">(</span>
</span><span id="__span-32-38">    <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
</span><span id="__span-32-39">    <span class="n">old_hash</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-32-40">    <span class="n">new_content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
</span><span id="__span-32-41">    <span class="n">stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="__span-32-42"><span class="p">):</span>
</span><span id="__span-32-43">    <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-32-44">    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.od&quot;</span><span class="p">):</span>
</span><span id="__span-32-45">        <span class="k">return</span>
</span><span id="__span-32-46">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-32-47">        <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-32-48">    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-32-49">        <span class="k">return</span>
</span><span id="__span-32-50">
</span><span id="__span-32-51">    <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;odf_files&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-32-52">    <span class="n">document_changed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-32-53">    <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
</span><span id="__span-32-54">        <span class="n">image_url</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">url</span>
</span><span id="__span-32-55">        <span class="k">if</span> <span class="ow">not</span> <span class="n">image_url</span><span class="p">:</span>
</span><span id="__span-32-56">            <span class="k">continue</span>
</span><span id="__span-32-57">        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-32-58">            <span class="n">image_content</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_part</span><span class="p">(</span><span class="n">image_url</span><span class="p">)</span>
</span><span id="__span-32-59">        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="__span-32-60">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- not found inside document:&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="__span-32-61">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  image URL:&quot;</span><span class="p">,</span> <span class="n">image_url</span><span class="p">)</span>
</span><span id="__span-32-62">            <span class="k">continue</span>
</span><span id="__span-32-63">        <span class="k">if</span> <span class="n">footprint</span><span class="p">(</span><span class="n">image_content</span><span class="p">)</span> <span class="o">==</span> <span class="n">old_hash</span><span class="p">:</span>
</span><span id="__span-32-64">            <span class="n">document</span><span class="o">.</span><span class="n">set_part</span><span class="p">(</span><span class="n">image_url</span><span class="p">,</span> <span class="n">new_content</span><span class="p">)</span>
</span><span id="__span-32-65">            <span class="n">document_changed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-32-66">    <span class="k">if</span> <span class="n">document_changed</span><span class="p">:</span>
</span><span id="__span-32-67">        <span class="n">save_modified</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-32-68">        <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;updated_files&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-32-69">
</span><span id="__span-32-70">
</span><span id="__span-32-71"><span class="k">def</span><span class="w"> </span><span class="nf">update_logos</span><span class="p">():</span>
</span><span id="__span-32-72">    <span class="n">old_hash</span> <span class="o">=</span> <span class="n">footprint</span><span class="p">(</span><span class="n">OLD_LOGO</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">())</span>
</span><span id="__span-32-73">
</span><span id="__span-32-74">    <span class="c1"># making the new image content :</span>
</span><span id="__span-32-75">    <span class="n">buffer</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-32-76">    <span class="n">url</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">NEW_LOGO</span><span class="p">))</span>
</span><span id="__span-32-77">    <span class="n">new_content</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">get_part</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-32-78">
</span><span id="__span-32-79">    <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-32-80">        <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-32-81">        <span class="s2">&quot;odf_files&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-32-82">        <span class="s2">&quot;updated_files&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-32-83">    <span class="p">}</span>
</span><span id="__span-32-84">    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">OLD_PRESENTATIONS</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;**/*&quot;</span><span class="p">):</span>
</span><span id="__span-32-85">        <span class="n">update_document</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">old_hash</span><span class="p">,</span> <span class="n">new_content</span><span class="p">,</span> <span class="n">stats</span><span class="p">)</span>
</span><span id="__span-32-86">    <span class="k">return</span> <span class="n">stats</span>
</span><span id="__span-32-87">
</span><span id="__span-32-88">
</span><span id="__span-32-89"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-32-90">    <span class="n">stats</span> <span class="o">=</span> <span class="n">update_logos</span><span class="p">()</span>
</span><span id="__span-32-91">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;files&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-32-92">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ODF files: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;odf_files&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-32-93">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated files: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;updated_files&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-32-94">
</span><span id="__span-32-95">
</span><span id="__span-32-96"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-32-97">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="concatenate-presentations">Concatenate presentations</h3>
<p>Concatenate several presentations (including presentations found in sub
directories), possibly merge styles and images. Result for style may vary.</p>
<details class="code">
<summary>recipes/concatenate_presentations.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-33-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-33-2"><span class="sd">&quot;&quot;&quot;Concatenate several presentations (including presentations found in sub</span>
</span><span id="__span-33-3"><span class="sd">directories), possibly merge styles and images. Result for style may vary.</span>
</span><span id="__span-33-4"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-33-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-33-6">
</span><span id="__span-33-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-33-8">
</span><span id="__span-33-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">280</span>
</span><span id="__span-33-10"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-33-11"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;concatenate&quot;</span>
</span><span id="__span-33-12"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;presentation.odp&quot;</span>
</span><span id="__span-33-13">
</span><span id="__span-33-14">
</span><span id="__span-33-15"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-33-16">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-33-17">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-33-18">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-33-19">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-33-20">
</span><span id="__span-33-21">
</span><span id="__span-33-22"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-33-23">    <span class="n">document</span> <span class="o">=</span> <span class="n">concatenate_presentations</span><span class="p">()</span>
</span><span id="__span-33-24">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-33-25">
</span><span id="__span-33-26">
</span><span id="__span-33-27"><span class="k">def</span><span class="w"> </span><span class="nf">concatenate_presentations</span><span class="p">():</span>
</span><span id="__span-33-28">    <span class="n">concat_presentation</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;presentation&quot;</span><span class="p">)</span>
</span><span id="__span-33-29">    <span class="n">concat_presentation</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-33-30">    <span class="n">concat_presentation</span><span class="o">.</span><span class="n">delete_styles</span><span class="p">()</span>
</span><span id="__span-33-31">
</span><span id="__span-33-32">    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-33-33">    <span class="k">for</span> <span class="n">presentation_path</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;**/*.odp&quot;</span><span class="p">):</span>
</span><span id="__span-33-34">        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-33-35">        <span class="n">add_presentation</span><span class="p">(</span><span class="n">concat_presentation</span><span class="p">,</span> <span class="n">presentation_path</span><span class="p">)</span>
</span><span id="__span-33-36">
</span><span id="__span-33-37">    <span class="n">nb_slides</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">concat_presentation</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_draw_pages</span><span class="p">())</span>
</span><span id="__span-33-38">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> presentations concatenated, </span><span class="si">{</span><span class="n">nb_slides</span><span class="si">}</span><span class="s2"> slides.&quot;</span><span class="p">)</span>
</span><span id="__span-33-39">
</span><span id="__span-33-40">    <span class="k">return</span> <span class="n">concat_presentation</span>
</span><span id="__span-33-41">
</span><span id="__span-33-42">
</span><span id="__span-33-43"><span class="k">def</span><span class="w"> </span><span class="nf">add_presentation</span><span class="p">(</span><span class="n">concat_presentation</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
</span><span id="__span-33-44"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Using odfdo for:</span>
</span><span id="__span-33-45"><span class="sd">    - open .odp document</span>
</span><span id="__span-33-46"><span class="sd">    - copy content and merge styles</span>
</span><span id="__span-33-47"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-33-48">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-33-49">        <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-33-50">    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-33-51">        <span class="k">return</span>
</span><span id="__span-33-52">    <span class="n">concat_presentation</span><span class="o">.</span><span class="n">merge_styles_from</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-33-53">    <span class="c1"># add all slides</span>
</span><span id="__span-33-54">    <span class="n">dest_body</span> <span class="o">=</span> <span class="n">concat_presentation</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-33-55">    <span class="n">dest_manifest</span> <span class="o">=</span> <span class="n">concat_presentation</span><span class="o">.</span><span class="n">manifest</span>
</span><span id="__span-33-56">    <span class="n">manifest</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">manifest</span>
</span><span id="__span-33-57">    <span class="n">slides</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_draw_pages</span><span class="p">()</span>
</span><span id="__span-33-58">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">slides</span><span class="p">)</span><span class="si">}</span><span class="s2"> slides&quot;</span><span class="p">)</span>
</span><span id="__span-33-59">    <span class="k">for</span> <span class="n">slide</span> <span class="ow">in</span> <span class="n">slides</span><span class="p">:</span>
</span><span id="__span-33-60">        <span class="n">slide</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">clone</span>
</span><span id="__span-33-61">        <span class="c1"># dont forget images:</span>
</span><span id="__span-33-62">        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">slide</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
</span><span id="__span-33-63">            <span class="n">uri</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">url</span>
</span><span id="__span-33-64">            <span class="n">media_type</span> <span class="o">=</span> <span class="n">manifest</span><span class="o">.</span><span class="n">get_media_type</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
</span><span id="__span-33-65">            <span class="n">dest_manifest</span><span class="o">.</span><span class="n">add_full_path</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">media_type</span><span class="p">)</span>
</span><span id="__span-33-66">            <span class="n">concat_presentation</span><span class="o">.</span><span class="n">set_part</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">document</span><span class="o">.</span><span class="n">get_part</span><span class="p">(</span><span class="n">uri</span><span class="p">))</span>
</span><span id="__span-33-67">        <span class="c1"># append slide, expecting nothing good about its final style</span>
</span><span id="__span-33-68">        <span class="n">dest_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slide</span><span class="p">)</span>
</span><span id="__span-33-69">
</span><span id="__span-33-70">
</span><span id="__span-33-71"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-33-72">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="make-a-presentation-from-pictures-of-a-text-document">Make a presentation from pictures of a text document</h3>
<p>Open a .odt file with pictures in it, find and analyse all the images,
create a new .odp presentation, display all the pictures in the presentation,
one image per frame.</p>
<details class="code">
<summary>recipes/make_a_presentation_from_pictures_of_a_text_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-34-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-34-2"><span class="sd">&quot;&quot;&quot;Open a .odt file with pictures in it, find and analyse all the images,</span>
</span><span id="__span-34-3"><span class="sd">create a new .odp presentation, display all the pictures in the presentation,</span>
</span><span id="__span-34-4"><span class="sd">one image per frame.</span>
</span><span id="__span-34-5"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-34-6"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-34-7"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-34-8"><span class="kn">from</span><span class="w"> </span><span class="nn">tempfile</span><span class="w"> </span><span class="kn">import</span> <span class="n">mkstemp</span>
</span><span id="__span-34-9">
</span><span id="__span-34-10"><span class="c1"># analyzing embedded image need Pillow library</span>
</span><span id="__span-34-11"><span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
</span><span id="__span-34-12">
</span><span id="__span-34-13"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">DrawPage</span><span class="p">,</span> <span class="n">Frame</span>
</span><span id="__span-34-14">
</span><span id="__span-34-15"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">285</span>
</span><span id="__span-34-16"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;presentation_images_in_odt&quot;</span>
</span><span id="__span-34-17"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;presentation.odp&quot;</span>
</span><span id="__span-34-18"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-34-19"><span class="n">SOURCE</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;collection.odt&quot;</span>
</span><span id="__span-34-20">
</span><span id="__span-34-21">
</span><span id="__span-34-22"><span class="k">def</span><span class="w"> </span><span class="nf">embedded_image_ratio</span><span class="p">(</span><span class="n">href</span><span class="p">,</span> <span class="n">part</span><span class="p">):</span>
</span><span id="__span-34-23">    <span class="n">image_suffix</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">href</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-34-24">    <span class="n">fd</span><span class="p">,</span> <span class="n">tmp_file</span> <span class="o">=</span> <span class="n">mkstemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="n">image_suffix</span><span class="p">)</span>
</span><span id="__span-34-25">    <span class="n">tmp_file_handler</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
</span><span id="__span-34-26">    <span class="n">tmp_file_handler</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
</span><span id="__span-34-27">    <span class="n">tmp_file_handler</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-34-28">    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
</span><span id="__span-34-29">    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">)</span>
</span><span id="__span-34-30">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;image </span><span class="si">{</span><span class="n">href</span><span class="si">}</span><span class="s2"> , size : </span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-34-31">    <span class="n">ratio</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">width</span> <span class="o">/</span> <span class="n">height</span>
</span><span id="__span-34-32">    <span class="k">return</span> <span class="n">ratio</span>
</span><span id="__span-34-33">
</span><span id="__span-34-34">
</span><span id="__span-34-35"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-34-36">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-34-37">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-34-38">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-34-39">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-34-40">
</span><span id="__span-34-41">
</span><span id="__span-34-42"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-34-43">    <span class="n">document</span> <span class="o">=</span> <span class="n">generate_document</span><span class="p">()</span>
</span><span id="__span-34-44">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-34-45">
</span><span id="__span-34-46">    <span class="n">_expected_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-34-47"><span class="s2">    image Pictures/12918371211855030272.jpe , size : 333x386</span>
</span><span id="__span-34-48"><span class="s2">    image Pictures/12918371212102410240.jpe , size : 200x350</span>
</span><span id="__span-34-49"><span class="s2">    image Pictures/12918371212184750080.jpe , size : 384x552</span>
</span><span id="__span-34-50"><span class="s2">    image Pictures/12918371212196450304.jpe , size : 373x576</span>
</span><span id="__span-34-51"><span class="s2">    image Pictures/12918371212450449408.jpe , size : 400x596</span>
</span><span id="__span-34-52"><span class="s2">    image Pictures/12918371212536940544.jpe , size : 800x1195</span>
</span><span id="__span-34-53"><span class="s2">    image Pictures/12918371212580190208.jpe , size : 561x282</span>
</span><span id="__span-34-54"><span class="s2">    image Pictures/12918371212597118976.jpe , size : 660x515</span>
</span><span id="__span-34-55"><span class="s2">    image Pictures/12918371212741570560.jpe , size : 328x504</span>
</span><span id="__span-34-56"><span class="s2">    &quot;&quot;&quot;</span>
</span><span id="__span-34-57">
</span><span id="__span-34-58">
</span><span id="__span-34-59"><span class="k">def</span><span class="w"> </span><span class="nf">generate_document</span><span class="p">():</span>
</span><span id="__span-34-60">    <span class="c1"># Open the input document</span>
</span><span id="__span-34-61">    <span class="c1"># doc_source = Document_extend(filename)</span>
</span><span id="__span-34-62">    <span class="n">doc_source</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">SOURCE</span><span class="p">)</span>
</span><span id="__span-34-63">
</span><span id="__span-34-64">    <span class="c1"># Making of the output Presentation document :</span>
</span><span id="__span-34-65">    <span class="n">presentation</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;presentation&quot;</span><span class="p">)</span>
</span><span id="__span-34-66">
</span><span id="__span-34-67">    <span class="c1"># Presentation got a body in which elements are stored</span>
</span><span id="__span-34-68">    <span class="n">presentation_body</span> <span class="o">=</span> <span class="n">presentation</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-34-69">    <span class="n">presentation_body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-34-70">    <span class="n">presentation_manifest</span> <span class="o">=</span> <span class="n">presentation</span><span class="o">.</span><span class="n">manifest</span>
</span><span id="__span-34-71">
</span><span id="__span-34-72">    <span class="c1"># For each image, we create a page in the presentation and display the image</span>
</span><span id="__span-34-73">    <span class="c1"># and some text on this frame</span>
</span><span id="__span-34-74">    <span class="c1"># First, get all image elements available in document:</span>
</span><span id="__span-34-75">    <span class="n">images_source</span> <span class="o">=</span> <span class="n">doc_source</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">images</span>
</span><span id="__span-34-76">    <span class="n">manifest_source</span> <span class="o">=</span> <span class="n">doc_source</span><span class="o">.</span><span class="n">manifest</span>
</span><span id="__span-34-77">
</span><span id="__span-34-78">    <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images_source</span><span class="p">:</span>
</span><span id="__span-34-79">        <span class="c1"># we use the get_part function from odfdo to get the actual content</span>
</span><span id="__span-34-80">        <span class="c1"># of the images, with the URI link to the image as argument</span>
</span><span id="__span-34-81">        <span class="n">uri</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">url</span>
</span><span id="__span-34-82">        <span class="c1"># weight = len(doc_source.get_part(uri))  # only for info</span>
</span><span id="__span-34-83">        <span class="c1"># print &quot;image %s , size in bytes: %s&quot; % (uri, weight)</span>
</span><span id="__span-34-84">        <span class="n">part</span> <span class="o">=</span> <span class="n">doc_source</span><span class="o">.</span><span class="n">get_part</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>  <span class="c1"># actual image content</span>
</span><span id="__span-34-85">        <span class="n">name</span> <span class="o">=</span> <span class="n">uri</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># lets make a file name for image</span>
</span><span id="__span-34-86">
</span><span id="__span-34-87">        <span class="c1"># Compute the display size of the image on the final page</span>
</span><span id="__span-34-88">        <span class="n">ratio</span> <span class="o">=</span> <span class="n">embedded_image_ratio</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">part</span><span class="p">)</span>
</span><span id="__span-34-89">        <span class="n">max_border</span> <span class="o">=</span> <span class="mf">16.0</span>  <span class="c1"># max size of the greatest border, in cm</span>
</span><span id="__span-34-90">        <span class="n">a</span> <span class="o">=</span> <span class="n">max_border</span> <span class="o">*</span> <span class="n">ratio</span>
</span><span id="__span-34-91">        <span class="n">b</span> <span class="o">=</span> <span class="n">max_border</span>
</span><span id="__span-34-92">        <span class="k">if</span> <span class="n">ratio</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="__span-34-93">            <span class="n">a</span> <span class="o">/=</span> <span class="n">ratio</span>
</span><span id="__span-34-94">            <span class="n">b</span> <span class="o">/=</span> <span class="n">ratio</span>
</span><span id="__span-34-95">
</span><span id="__span-34-96">        <span class="c1"># Create an underlying page for the image and the text</span>
</span><span id="__span-34-97">        <span class="n">page</span> <span class="o">=</span> <span class="n">DrawPage</span><span class="p">(</span><span class="s2">&quot;page &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
</span><span id="__span-34-98">
</span><span id="__span-34-99">        <span class="c1"># Create a frame for the image</span>
</span><span id="__span-34-100">        <span class="n">image_frame</span> <span class="o">=</span> <span class="n">Frame</span><span class="o">.</span><span class="n">image_frame</span><span class="p">(</span>
</span><span id="__span-34-101">            <span class="n">image</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span>
</span><span id="__span-34-102">            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Text over the image object</span>
</span><span id="__span-34-103">            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">cm&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">cm&quot;</span><span class="p">),</span>  <span class="c1"># Display size of image</span>
</span><span id="__span-34-104">            <span class="n">anchor_type</span><span class="o">=</span><span class="s2">&quot;page&quot;</span><span class="p">,</span>
</span><span id="__span-34-105">            <span class="n">page_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-34-106">            <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;3.5cm&quot;</span><span class="p">,</span> <span class="s2">&quot;3.5 cm&quot;</span><span class="p">),</span>
</span><span id="__span-34-107">            <span class="n">style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-34-108">        <span class="p">)</span>
</span><span id="__span-34-109">
</span><span id="__span-34-110">        <span class="c1"># Add some text object somehere on the frame, with a text frame</span>
</span><span id="__span-34-111">        <span class="n">legend</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Image </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> from Wikipedia document / </span><span class="si">{</span><span class="n">SOURCE</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-34-112">        <span class="n">text_frame</span> <span class="o">=</span> <span class="n">Frame</span><span class="o">.</span><span class="n">text_frame</span><span class="p">(</span>
</span><span id="__span-34-113">            <span class="n">legend</span><span class="p">,</span>
</span><span id="__span-34-114">            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;26cm&quot;</span><span class="p">,</span> <span class="s2">&quot;2cm&quot;</span><span class="p">),</span>
</span><span id="__span-34-115">            <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;0.5cm&quot;</span><span class="p">,</span> <span class="s2">&quot;0.5cm&quot;</span><span class="p">),</span>
</span><span id="__span-34-116">            <span class="n">style</span><span class="o">=</span><span class="s2">&quot;Standard&quot;</span><span class="p">,</span>
</span><span id="__span-34-117">            <span class="n">text_style</span><span class="o">=</span><span class="s2">&quot;Standard&quot;</span><span class="p">,</span>
</span><span id="__span-34-118">        <span class="p">)</span>
</span><span id="__span-34-119">
</span><span id="__span-34-120">        <span class="c1"># Append all the component, do not forget to add the actuel image file</span>
</span><span id="__span-34-121">        <span class="c1"># into the Picture global directory of the presentation file with set_part</span>
</span><span id="__span-34-122">        <span class="n">page</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text_frame</span><span class="p">)</span>
</span><span id="__span-34-123">        <span class="n">page</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_frame</span><span class="p">)</span>
</span><span id="__span-34-124">        <span class="n">presentation_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</span><span id="__span-34-125">        <span class="c1"># for the same operation from a local filesystem image, just use:</span>
</span><span id="__span-34-126">        <span class="c1"># presentation_output.add_file(uri)</span>
</span><span id="__span-34-127">        <span class="n">media_type</span> <span class="o">=</span> <span class="n">manifest_source</span><span class="o">.</span><span class="n">get_media_type</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
</span><span id="__span-34-128">        <span class="n">presentation_manifest</span><span class="o">.</span><span class="n">add_full_path</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">media_type</span><span class="p">)</span>
</span><span id="__span-34-129">        <span class="n">presentation</span><span class="o">.</span><span class="n">set_part</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">doc_source</span><span class="o">.</span><span class="n">get_part</span><span class="p">(</span><span class="n">uri</span><span class="p">))</span>
</span><span id="__span-34-130">
</span><span id="__span-34-131">    <span class="k">return</span> <span class="n">presentation</span>
</span><span id="__span-34-132">
</span><span id="__span-34-133">
</span><span id="__span-34-134"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-34-135">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="make-presentation-from-images">Make presentation from images</h3>
<p>Create a presentation from a some images in a given directory,
where each image is put on the center of its own page scaled to either
the maximum available size, prefered maximum size, or cover the full
page and lose some info.</p>
<details class="code">
<summary>recipes/make_presentation_from_images.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-35-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-35-2"><span class="sd">&quot;&quot;&quot;Create a presentation from a some images in a given directory,</span>
</span><span id="__span-35-3"><span class="sd">where each image is put on the center of its own page scaled to either</span>
</span><span id="__span-35-4"><span class="sd">the maximum available size, prefered maximum size, or cover the full</span>
</span><span id="__span-35-5"><span class="sd">page and lose some info.</span>
</span><span id="__span-35-6"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-35-7"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-35-8">
</span><span id="__span-35-9"><span class="c1"># analyzing embedded image need Pillow library</span>
</span><span id="__span-35-10"><span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
</span><span id="__span-35-11">
</span><span id="__span-35-12"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">DrawPage</span><span class="p">,</span> <span class="n">Frame</span>
</span><span id="__span-35-13">
</span><span id="__span-35-14"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">286</span>
</span><span id="__span-35-15"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;presentation_from_images&quot;</span>
</span><span id="__span-35-16"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;presentation.odp&quot;</span>
</span><span id="__span-35-17"><span class="n">IMAGES</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="s2">&quot;images&quot;</span>
</span><span id="__span-35-18"><span class="n">MAX_SIZE</span> <span class="o">=</span> <span class="mf">15.0</span>  <span class="c1"># feel free to customize</span>
</span><span id="__span-35-19"><span class="n">CROP_SIZE</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># feel free to customize</span>
</span><span id="__span-35-20">
</span><span id="__span-35-21"><span class="c1"># Size (in cm) of a slide : (default page-layout)</span>
</span><span id="__span-35-22"><span class="n">SLIDE_W</span><span class="p">,</span> <span class="n">SLIDE_H</span> <span class="o">=</span> <span class="mf">28.0</span><span class="p">,</span> <span class="mf">21.0</span>  <span class="c1"># 4/3 screen</span>
</span><span id="__span-35-23"><span class="c1"># FIXME: this is the default page-layout.</span>
</span><span id="__span-35-24"><span class="c1"># - Changing the style of the page-layout by program is not done in this script</span>
</span><span id="__span-35-25"><span class="c1"># - an other way, merging with external page-layout/master-page requires</span>
</span><span id="__span-35-26"><span class="c1">#   extra files, out of the scope for this script.</span>
</span><span id="__span-35-27">
</span><span id="__span-35-28">
</span><span id="__span-35-29"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-35-30">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-35-31">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-35-32">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-35-33">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-35-34">
</span><span id="__span-35-35">
</span><span id="__span-35-36"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-35-37">    <span class="n">presentation</span> <span class="o">=</span> <span class="n">make_presentation</span><span class="p">()</span>
</span><span id="__span-35-38">    <span class="k">if</span> <span class="n">presentation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-35-39">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Something went wrong.&quot;</span><span class="p">)</span>
</span><span id="__span-35-40">        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-35-41">    <span class="n">save_new</span><span class="p">(</span><span class="n">presentation</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-35-42">
</span><span id="__span-35-43">
</span><span id="__span-35-44"><span class="k">def</span><span class="w"> </span><span class="nf">make_presentation</span><span class="p">():</span>
</span><span id="__span-35-45">    <span class="c1"># Collecting images</span>
</span><span id="__span-35-46">    <span class="n">images_pool</span> <span class="o">=</span> <span class="n">collect_images</span><span class="p">()</span>
</span><span id="__span-35-47">    <span class="k">if</span> <span class="ow">not</span> <span class="n">images_pool</span><span class="p">:</span>  <span class="c1"># unable to find images</span>
</span><span id="__span-35-48">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No image found !&quot;</span><span class="p">)</span>
</span><span id="__span-35-49">        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-35-50">
</span><span id="__span-35-51">    <span class="c1"># Creation of the output Presentation document :</span>
</span><span id="__span-35-52">    <span class="c1"># presentation = Document_from_type(&#39;presentation&#39;)  # 092</span>
</span><span id="__span-35-53">    <span class="n">presentation</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;presentation&quot;</span><span class="p">)</span>
</span><span id="__span-35-54">
</span><span id="__span-35-55">    <span class="c1"># Presentation got a body in which content is stored</span>
</span><span id="__span-35-56">    <span class="n">presentation_body</span> <span class="o">=</span> <span class="n">presentation</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-35-57">    <span class="n">presentation_body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-35-58">
</span><span id="__span-35-59">    <span class="c1"># For each image, we create a page in the presentation and display the image</span>
</span><span id="__span-35-60">    <span class="c1"># and some text on this frame</span>
</span><span id="__span-35-61">    <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images_pool</span><span class="p">:</span>
</span><span id="__span-35-62">        <span class="c1"># add the file to the document</span>
</span><span id="__span-35-63">        <span class="n">uri</span> <span class="o">=</span> <span class="n">presentation</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
</span><span id="__span-35-64">
</span><span id="__span-35-65">        <span class="c1"># Create an underlying page for the image and the text</span>
</span><span id="__span-35-66">        <span class="n">page</span> <span class="o">=</span> <span class="n">DrawPage</span><span class="p">(</span><span class="s2">&quot;Page &quot;</span> <span class="o">+</span> <span class="n">image</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-35-67">
</span><span id="__span-35-68">        <span class="c1"># Create a frame for the image</span>
</span><span id="__span-35-69">        <span class="n">image_frame</span> <span class="o">=</span> <span class="n">Frame</span><span class="o">.</span><span class="n">image_frame</span><span class="p">(</span>
</span><span id="__span-35-70">            <span class="n">image</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span>
</span><span id="__span-35-71">            <span class="n">name</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-35-72">            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Text over the image object</span>
</span><span id="__span-35-73">            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">disp_w</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">disp_h</span><span class="p">),</span>  <span class="c1"># Display size of image</span>
</span><span id="__span-35-74">            <span class="n">anchor_type</span><span class="o">=</span><span class="s2">&quot;page&quot;</span><span class="p">,</span>
</span><span id="__span-35-75">            <span class="n">page_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-35-76">            <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">pos_x</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">pos_y</span><span class="p">),</span>
</span><span id="__span-35-77">            <span class="n">style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="__span-35-78">        <span class="p">)</span>
</span><span id="__span-35-79">
</span><span id="__span-35-80">        <span class="c1"># Append all the component</span>
</span><span id="__span-35-81">        <span class="n">page</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_frame</span><span class="p">)</span>
</span><span id="__span-35-82">        <span class="n">presentation_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</span><span id="__span-35-83">
</span><span id="__span-35-84">    <span class="k">return</span> <span class="n">presentation</span>
</span><span id="__span-35-85">
</span><span id="__span-35-86">
</span><span id="__span-35-87"><span class="c1"># Principle :</span>
</span><span id="__span-35-88"><span class="c1"># - original image are left unmodified by the script</span>
</span><span id="__span-35-89"><span class="c1"># - only the size they should appear is computed</span>
</span><span id="__span-35-90"><span class="c1"># - later, the display engine (say LibreOffice) will merge this display</span>
</span><span id="__span-35-91"><span class="c1">#   information with other informations, like the size of the page</span>
</span><span id="__span-35-92"><span class="c1">#   (page-layout) and should act like a mask against the &quot;big&quot; croped image.</span>
</span><span id="__span-35-93"><span class="k">class</span><span class="w"> </span><span class="nc">ImageInfo</span><span class="p">:</span>
</span><span id="__span-35-94">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
</span><span id="__span-35-95">        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
</span><span id="__span-35-96">        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-35-97">        <span class="bp">self</span><span class="o">.</span><span class="n">disp_w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_h</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-35-98">        <span class="bp">self</span><span class="o">.</span><span class="n">pos_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_y</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-35-99">
</span><span id="__span-35-100">    <span class="k">def</span><span class="w"> </span><span class="nf">adjust</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-35-101">        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-35-102">            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
</span><span id="__span-35-103">        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
</span><span id="__span-35-104">            <span class="c1"># Not an image ?</span>
</span><span id="__span-35-105">            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-35-106">            <span class="k">return</span>
</span><span id="__span-35-107">        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
</span><span id="__span-35-108">        <span class="k">if</span> <span class="n">MAX_SIZE</span><span class="p">:</span>
</span><span id="__span-35-109">            <span class="n">ratio</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="n">MAX_SIZE</span><span class="p">,</span> <span class="n">height</span> <span class="o">/</span> <span class="n">MAX_SIZE</span><span class="p">)</span>
</span><span id="__span-35-110">            <span class="n">display_w</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="n">ratio</span>
</span><span id="__span-35-111">            <span class="n">display_h</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">ratio</span>
</span><span id="__span-35-112">        <span class="k">elif</span> <span class="n">CROP_SIZE</span><span class="p">:</span>
</span><span id="__span-35-113">            <span class="n">ratio</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="n">SLIDE_W</span><span class="p">,</span> <span class="n">height</span> <span class="o">/</span> <span class="n">SLIDE_H</span><span class="p">)</span>
</span><span id="__span-35-114">            <span class="n">display_w</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="n">ratio</span>
</span><span id="__span-35-115">            <span class="n">display_h</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">ratio</span>
</span><span id="__span-35-116">        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-35-117">            <span class="n">ratio</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="n">SLIDE_W</span><span class="p">,</span> <span class="n">height</span> <span class="o">/</span> <span class="n">SLIDE_H</span><span class="p">)</span>
</span><span id="__span-35-118">            <span class="n">display_w</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="n">ratio</span>
</span><span id="__span-35-119">            <span class="n">display_h</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">ratio</span>
</span><span id="__span-35-120">        <span class="bp">self</span><span class="o">.</span><span class="n">disp_w</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">display_w</span><span class="si">:</span><span class="s2">2f</span><span class="si">}</span><span class="s2">cm&quot;</span>
</span><span id="__span-35-121">        <span class="bp">self</span><span class="o">.</span><span class="n">disp_h</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">display_h</span><span class="si">:</span><span class="s2">2f</span><span class="si">}</span><span class="s2">cm&quot;</span>
</span><span id="__span-35-122">        <span class="bp">self</span><span class="o">.</span><span class="n">pos_x</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">SLIDE_W</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">display_w</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="si">:</span><span class="s2">2f</span><span class="si">}</span><span class="s2">cm&quot;</span>
</span><span id="__span-35-123">        <span class="bp">self</span><span class="o">.</span><span class="n">pos_y</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">SLIDE_H</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">display_h</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="si">:</span><span class="s2">2f</span><span class="si">}</span><span class="s2">cm&quot;</span>
</span><span id="__span-35-124">        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_h</span><span class="p">)</span>
</span><span id="__span-35-125">
</span><span id="__span-35-126">
</span><span id="__span-35-127"><span class="k">def</span><span class="w"> </span><span class="nf">collect_images</span><span class="p">():</span>
</span><span id="__span-35-128">    <span class="n">pool</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-35-129">    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">IMAGES</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;**/*&quot;</span><span class="p">):</span>
</span><span id="__span-35-130">        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
</span><span id="__span-35-131">            <span class="k">continue</span>
</span><span id="__span-35-132">        <span class="n">image_info</span> <span class="o">=</span> <span class="n">ImageInfo</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-35-133">        <span class="n">image_info</span><span class="o">.</span><span class="n">adjust</span><span class="p">()</span>
</span><span id="__span-35-134">        <span class="k">if</span> <span class="n">image_info</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
</span><span id="__span-35-135">            <span class="n">pool</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_info</span><span class="p">)</span>
</span><span id="__span-35-136">    <span class="k">return</span> <span class="n">pool</span>
</span><span id="__span-35-137">
</span><span id="__span-35-138">
</span><span id="__span-35-139"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-35-140">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="make-a-presentation-from-text-with-different-styles">Make a presentation from text with different styles</h3>
<p>Each line of the text becomes a slide of the presentation, we change of style
depending on the length of text line.</p>
<details class="code">
<summary>recipes/make_a_presentation_from_text_with_different_styles.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-36-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-36-2"><span class="sd">&quot;&quot;&quot;Each line of the text becomes a slide of the presentation, we change of style</span>
</span><span id="__span-36-3"><span class="sd">depending on the length of text line.</span>
</span><span id="__span-36-4"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-36-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-36-6">
</span><span id="__span-36-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">DrawPage</span><span class="p">,</span> <span class="n">Frame</span><span class="p">,</span> <span class="n">Style</span>
</span><span id="__span-36-8">
</span><span id="__span-36-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">287</span>
</span><span id="__span-36-10"><span class="c1"># lst = open(sys.argv[1]).readlines()</span>
</span><span id="__span-36-11"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;styled_prez&quot;</span>
</span><span id="__span-36-12"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;presentation.odp&quot;</span>
</span><span id="__span-36-13"><span class="n">CONTENT</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;123</span>
</span><span id="__span-36-14"><span class="s2">azertyuiop</span>
</span><span id="__span-36-15"><span class="s2">azertyuiop azertyuiop</span>
</span><span id="__span-36-16"><span class="s2">azertyuiop azertyuiop azertyuiop</span>
</span><span id="__span-36-17"><span class="s2">azertyuiop azertyuiop azertyuiop azertyuiop</span>
</span><span id="__span-36-18"><span class="s2">azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop</span>
</span><span id="__span-36-19"><span class="s2">azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop</span>
</span><span id="__span-36-20"><span class="s2">azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop</span>
</span><span id="__span-36-21"><span class="s2">azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop</span>
</span><span id="__span-36-22"><span class="s2">azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop azertyuiop</span>
</span><span id="__span-36-23"><span class="s2">end.</span>
</span><span id="__span-36-24"><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
</span><span id="__span-36-25">
</span><span id="__span-36-26">
</span><span id="__span-36-27"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-36-28">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-36-29">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-36-30">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-36-31">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-36-32">
</span><span id="__span-36-33">
</span><span id="__span-36-34"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-36-35">    <span class="n">document</span> <span class="o">=</span> <span class="n">generate_document</span><span class="p">()</span>
</span><span id="__span-36-36">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-36-37">
</span><span id="__span-36-38">
</span><span id="__span-36-39"><span class="k">def</span><span class="w"> </span><span class="nf">generate_document</span><span class="p">():</span>
</span><span id="__span-36-40">    <span class="n">presentation</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;presentation&quot;</span><span class="p">)</span>
</span><span id="__span-36-41">    <span class="n">body</span> <span class="o">=</span> <span class="n">presentation</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-36-42">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-36-43">
</span><span id="__span-36-44">    <span class="c1"># Creating a smooth style for the graphic item</span>
</span><span id="__span-36-45">    <span class="n">base_style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-36-46">        <span class="s2">&quot;graphic&quot;</span><span class="p">,</span>
</span><span id="__span-36-47">        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Gloup48&quot;</span><span class="p">,</span>
</span><span id="__span-36-48">        <span class="n">parent</span><span class="o">=</span><span class="s2">&quot;standard&quot;</span><span class="p">,</span>
</span><span id="__span-36-49">        <span class="n">stroke</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
</span><span id="__span-36-50">        <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;#b3b3b3&quot;</span><span class="p">,</span>
</span><span id="__span-36-51">        <span class="n">textarea_vertical_align</span><span class="o">=</span><span class="s2">&quot;middle&quot;</span><span class="p">,</span>
</span><span id="__span-36-52">        <span class="n">padding_top</span><span class="o">=</span><span class="s2">&quot;1cm&quot;</span><span class="p">,</span>
</span><span id="__span-36-53">        <span class="n">padding_bottom</span><span class="o">=</span><span class="s2">&quot;1cm&quot;</span><span class="p">,</span>
</span><span id="__span-36-54">        <span class="n">padding_left</span><span class="o">=</span><span class="s2">&quot;1cm&quot;</span><span class="p">,</span>
</span><span id="__span-36-55">        <span class="n">padding_right</span><span class="o">=</span><span class="s2">&quot;1cm&quot;</span><span class="p">,</span>
</span><span id="__span-36-56">        <span class="n">line_distance</span><span class="o">=</span><span class="s2">&quot;0cm&quot;</span><span class="p">,</span>
</span><span id="__span-36-57">        <span class="n">guide_overhang</span><span class="o">=</span><span class="s2">&quot;0cm&quot;</span><span class="p">,</span>
</span><span id="__span-36-58">        <span class="n">guide_distance</span><span class="o">=</span><span class="s2">&quot;0cm&quot;</span><span class="p">,</span>
</span><span id="__span-36-59">    <span class="p">)</span>
</span><span id="__span-36-60">    <span class="n">base_style</span><span class="o">.</span><span class="n">set_properties</span><span class="p">(</span><span class="n">area</span><span class="o">=</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="__span-36-61">    <span class="n">base_style</span><span class="o">.</span><span class="n">set_properties</span><span class="p">(</span>
</span><span id="__span-36-62">        <span class="n">area</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-36-63">        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#dd0000&quot;</span><span class="p">,</span>
</span><span id="__span-36-64">        <span class="n">text_outline</span><span class="o">=</span><span class="s2">&quot;false&quot;</span><span class="p">,</span>
</span><span id="__span-36-65">        <span class="n">font</span><span class="o">=</span><span class="s2">&quot;Liberation Sans&quot;</span><span class="p">,</span>
</span><span id="__span-36-66">        <span class="n">font_family</span><span class="o">=</span><span class="s2">&quot;Liberation Sans&quot;</span><span class="p">,</span>  <span class="c1"># compatibility</span>
</span><span id="__span-36-67">        <span class="n">font_style_name</span><span class="o">=</span><span class="s2">&quot;Bold&quot;</span><span class="p">,</span>
</span><span id="__span-36-68">        <span class="n">family_generic</span><span class="o">=</span><span class="s2">&quot;swiss&quot;</span><span class="p">,</span>
</span><span id="__span-36-69">        <span class="n">size</span><span class="o">=</span><span class="s2">&quot;48pt&quot;</span><span class="p">,</span>
</span><span id="__span-36-70">        <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
</span><span id="__span-36-71">    <span class="p">)</span>
</span><span id="__span-36-72">
</span><span id="__span-36-73">    <span class="n">presentation</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">base_style</span><span class="p">)</span>
</span><span id="__span-36-74">
</span><span id="__span-36-75">    <span class="c1"># Making o lot of variations</span>
</span><span id="__span-36-76">    <span class="n">variants</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">44</span><span class="p">]</span>
</span><span id="__span-36-77">    <span class="n">text_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">95</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</span><span id="__span-36-78">    <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">variants</span><span class="p">:</span>
</span><span id="__span-36-79">        <span class="n">variant_style</span> <span class="o">=</span> <span class="n">base_style</span><span class="o">.</span><span class="n">clone</span>
</span><span id="__span-36-80">        <span class="n">variant_style</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s2">&quot;style:name&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Gloup</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-36-81">        <span class="n">variant_style</span><span class="o">.</span><span class="n">set_properties</span><span class="p">(</span><span class="n">area</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">pt&quot;</span><span class="p">)</span>
</span><span id="__span-36-82">        <span class="n">presentation</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">variant_style</span><span class="p">)</span>
</span><span id="__span-36-83">
</span><span id="__span-36-84">    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">blurb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">):</span>
</span><span id="__span-36-85">        <span class="n">text</span> <span class="o">=</span> <span class="n">blurb</span>
</span><span id="__span-36-86">        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="w"> </span><span class="n">text</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-36-87">        <span class="n">page</span> <span class="o">=</span> <span class="n">DrawPage</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-36-88">        <span class="c1"># choosing some style:</span>
</span><span id="__span-36-89">        <span class="n">size</span> <span class="o">=</span> <span class="mi">48</span>
</span><span id="__span-36-90">        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">max_size</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text_size</span><span class="p">):</span>
</span><span id="__span-36-91">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_size</span><span class="p">:</span>
</span><span id="__span-36-92">                <span class="n">size</span> <span class="o">=</span> <span class="n">variants</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="__span-36-93">                <span class="k">break</span>
</span><span id="__span-36-94">
</span><span id="__span-36-95">        <span class="n">text_frame</span> <span class="o">=</span> <span class="n">Frame</span><span class="o">.</span><span class="n">text_frame</span><span class="p">(</span>
</span><span id="__span-36-96">            <span class="n">text</span><span class="p">,</span>
</span><span id="__span-36-97">            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;24cm&quot;</span><span class="p">,</span> <span class="s2">&quot;2cm&quot;</span><span class="p">),</span>
</span><span id="__span-36-98">            <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;2cm&quot;</span><span class="p">,</span> <span class="s2">&quot;8cm&quot;</span><span class="p">),</span>
</span><span id="__span-36-99">            <span class="n">style</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Gloup</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-36-100">            <span class="n">text_style</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Gloup</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-36-101">        <span class="p">)</span>
</span><span id="__span-36-102">
</span><span id="__span-36-103">        <span class="n">page</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text_frame</span><span class="p">)</span>
</span><span id="__span-36-104">        <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</span><span id="__span-36-105">
</span><span id="__span-36-106">    <span class="k">return</span> <span class="n">presentation</span>
</span><span id="__span-36-107">
</span><span id="__span-36-108">
</span><span id="__span-36-109"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-36-110">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="extract-and-reorder-slides">Extract and reorder slides</h3>
<p>Create a new presentation from a previous one by extracting some slides,
in a different order.</p>
<details class="code">
<summary>recipes/extract_and_reorder_slides.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-37-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-37-2"><span class="sd">&quot;&quot;&quot;Create a new presentation from a previous one by extracting some slides,</span>
</span><span id="__span-37-3"><span class="sd">in a different order.</span>
</span><span id="__span-37-4"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-37-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-37-6">
</span><span id="__span-37-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-37-8">
</span><span id="__span-37-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">290</span>
</span><span id="__span-37-10"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;presentation_extracted&quot;</span>
</span><span id="__span-37-11"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;presentation.odp&quot;</span>
</span><span id="__span-37-12"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-37-13"><span class="n">SOURCE</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;presentation_base.odp&quot;</span>
</span><span id="__span-37-14">
</span><span id="__span-37-15">
</span><span id="__span-37-16"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-37-17">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-37-18">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-37-19">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-37-20">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-37-21">
</span><span id="__span-37-22">
</span><span id="__span-37-23"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-37-24">    <span class="n">new_order</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-37-25">    <span class="n">presentation_base</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">SOURCE</span><span class="p">)</span>
</span><span id="__span-37-26">    <span class="n">extracted</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;presentation&quot;</span><span class="p">)</span>
</span><span id="__span-37-27">
</span><span id="__span-37-28">    <span class="c1"># Important, copy styles too:</span>
</span><span id="__span-37-29">    <span class="n">extracted</span><span class="o">.</span><span class="n">delete_styles</span><span class="p">()</span>
</span><span id="__span-37-30">    <span class="n">extracted</span><span class="o">.</span><span class="n">merge_styles_from</span><span class="p">(</span><span class="n">presentation_base</span><span class="p">)</span>
</span><span id="__span-37-31">    <span class="n">extracted</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-37-32">
</span><span id="__span-37-33">    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">new_order</span><span class="p">:</span>
</span><span id="__span-37-34">        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-37-35">            <span class="n">slide_position</span> <span class="o">=</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="__span-37-36">            <span class="n">slide</span> <span class="o">=</span> <span class="n">presentation_base</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_draw_page</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">slide_position</span><span class="p">)</span>
</span><span id="__span-37-37">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># noqa: S112</span>
</span><span id="__span-37-38">            <span class="k">continue</span>
</span><span id="__span-37-39">        <span class="k">if</span> <span class="n">slide</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-37-40">            <span class="k">continue</span>
</span><span id="__span-37-41">
</span><span id="__span-37-42">        <span class="n">slide</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">clone</span>
</span><span id="__span-37-43">        <span class="n">extracted</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slide</span><span class="p">)</span>
</span><span id="__span-37-44">
</span><span id="__span-37-45">    <span class="n">save_new</span><span class="p">(</span><span class="n">extracted</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-37-46">
</span><span id="__span-37-47">
</span><span id="__span-37-48"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-37-49">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="change-values-of-a-chart-inside-a-document">Change values of a chart inside a document</h3>
<p>Open a text document with an embedded chart and change some values.</p>
<details class="code">
<summary>recipes/change_values_of_a_chart_inside_a_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-38-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-38-2"><span class="sd">&quot;&quot;&quot;Open a text document with an embedded chart and change some values.</span>
</span><span id="__span-38-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-38-4">
</span><span id="__span-38-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-38-6">
</span><span id="__span-38-7"><span class="c1"># for cell style</span>
</span><span id="__span-38-8"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-38-9">
</span><span id="__span-38-10"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">295</span>
</span><span id="__span-38-11"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-38-12"><span class="n">SOURCE</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;chart.odt&quot;</span>
</span><span id="__span-38-13"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;modified_chart&quot;</span>
</span><span id="__span-38-14"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;modified_chart.odt&quot;</span>
</span><span id="__span-38-15">
</span><span id="__span-38-16">
</span><span id="__span-38-17"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-38-18">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-38-19">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-38-20">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-38-21">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-38-22">
</span><span id="__span-38-23">
</span><span id="__span-38-24"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-38-25">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">SOURCE</span><span class="p">)</span>
</span><span id="__span-38-26">    <span class="n">change</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-38-27">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-38-28">
</span><span id="__span-38-29">
</span><span id="__span-38-30"><span class="k">def</span><span class="w"> </span><span class="nf">change</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-38-31">    <span class="c1"># list the parts if needed</span>
</span><span id="__span-38-32">    <span class="nb">print</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span>
</span><span id="__span-38-33">    <span class="c1"># -&gt; [&#39;mimetype&#39;, &#39;ObjectReplacements/Object 1&#39;, &#39;Object 1/meta.xml&#39;, &#39;Object 1/styles.xml&#39;, &#39;Object 1/content.xml&#39;, ...</span>
</span><span id="__span-38-34">
</span><span id="__span-38-35">    <span class="n">part</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_part</span><span class="p">(</span><span class="s2">&quot;Object 1/content.xml&quot;</span><span class="p">)</span>
</span><span id="__span-38-36">    <span class="n">body</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-38-37">    <span class="n">table</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-38-38">
</span><span id="__span-38-39">    <span class="c1"># if needed, get the values:</span>
</span><span id="__span-38-40">    <span class="n">values</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
</span><span id="__span-38-41">    <span class="nb">print</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="__span-38-42">    <span class="c1"># -&gt; [</span>
</span><span id="__span-38-43">    <span class="c1">#     [None, &quot;&quot;, &quot;Column 2&quot;, &quot;Column 3&quot;],</span>
</span><span id="__span-38-44">    <span class="c1">#     [&quot;Row 1&quot;, Decimal(&quot;NaN&quot;), 10, 20],</span>
</span><span id="__span-38-45">    <span class="c1">#     [&quot;Row 2&quot;, Decimal(&quot;NaN&quot;), 30, 40],</span>
</span><span id="__span-38-46">    <span class="c1">#     [&quot;Row 3&quot;, Decimal(&quot;NaN&quot;), 50, 360],</span>
</span><span id="__span-38-47">    <span class="c1">#     [&quot;Row 4&quot;, Decimal(&quot;NaN&quot;), Decimal(&quot;9.02&quot;), Decimal(&quot;6.2&quot;)],</span>
</span><span id="__span-38-48">    <span class="c1"># ]</span>
</span><span id="__span-38-49">
</span><span id="__span-38-50">    <span class="c1"># change some values</span>
</span><span id="__span-38-51">    <span class="n">table</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;A2&quot;</span><span class="p">,</span> <span class="s2">&quot;label changed&quot;</span><span class="p">)</span>
</span><span id="__span-38-52">    <span class="n">table</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;D3&quot;</span><span class="p">,</span> <span class="mi">4000</span><span class="p">)</span>
</span><span id="__span-38-53">    <span class="n">table</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;D4&quot;</span><span class="p">,</span> <span class="mi">4321</span><span class="p">)</span>
</span><span id="__span-38-54">
</span><span id="__span-38-55">
</span><span id="__span-38-56"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-38-57">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="add-text-span-styles">Add text span styles</h3>
<p>Transform a not styled document into a multi styled document,
by changing size and color of each parts of words.</p>
<details class="code">
<summary>recipes/add_text_span_styles.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-39-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-39-2"><span class="sd">&quot;&quot;&quot;Transform a not styled document into a multi styled document,</span>
</span><span id="__span-39-3"><span class="sd">by changing size and color of each parts of words.</span>
</span><span id="__span-39-4"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-39-5"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-39-6"><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">chain</span>
</span><span id="__span-39-7"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-39-8">
</span><span id="__span-39-9"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Style</span>
</span><span id="__span-39-10">
</span><span id="__span-39-11"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">300</span>
</span><span id="__span-39-12"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-39-13"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;styled3&quot;</span>
</span><span id="__span-39-14"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;dormeur_styled.odt&quot;</span>
</span><span id="__span-39-15"><span class="n">SOURCE</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;dormeur_notstyled.odt&quot;</span>
</span><span id="__span-39-16"><span class="n">RANDOM_SEED</span> <span class="o">=</span> <span class="mi">1234</span>
</span><span id="__span-39-17">
</span><span id="__span-39-18">
</span><span id="__span-39-19"><span class="k">class</span><span class="w"> </span><span class="nc">SimpleRandom</span><span class="p">:</span>
</span><span id="__span-39-20"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Q&amp;D reproductible random generator for tests.&quot;&quot;&quot;</span>
</span><span id="__span-39-21">
</span><span id="__span-39-22">    <span class="n">MODULUS</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="__span-39-23">    <span class="n">MAXI</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="__span-39-24">
</span><span id="__span-39-25">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-39-26">        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="mi">16807</span>
</span><span id="__span-39-27">
</span><span id="__span-39-28">    <span class="k">def</span><span class="w"> </span><span class="nf">_next_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-39-29">        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16807</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODULUS</span>
</span><span id="__span-39-30">
</span><span id="__span-39-31">    <span class="k">def</span><span class="w"> </span><span class="nf">set_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">16807</span><span class="p">):</span>
</span><span id="__span-39-32">        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">seed</span>
</span><span id="__span-39-33">
</span><span id="__span-39-34">    <span class="k">def</span><span class="w"> </span><span class="nf">randint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_value</span><span class="p">):</span>
</span><span id="__span-39-35">        <span class="bp">self</span><span class="o">.</span><span class="n">_next_number</span><span class="p">()</span>
</span><span id="__span-39-36">        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">*</span> <span class="n">max_value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAXI</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-39-37">
</span><span id="__span-39-38">
</span><span id="__span-39-39"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-39-40">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-39-41">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-39-42">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-39-43">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-39-44">
</span><span id="__span-39-45">
</span><span id="__span-39-46"><span class="k">def</span><span class="w"> </span><span class="nf">color_hex</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="__span-39-47">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">r</span><span class="si">:</span><span class="s2">02X</span><span class="si">}{</span><span class="n">g</span><span class="si">:</span><span class="s2">02X</span><span class="si">}{</span><span class="n">b</span><span class="si">:</span><span class="s2">02X</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-39-48">
</span><span id="__span-39-49">
</span><span id="__span-39-50"><span class="k">def</span><span class="w"> </span><span class="nf">style_name_index</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
</span><span id="__span-39-51">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;rnd_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-39-52">
</span><span id="__span-39-53">
</span><span id="__span-39-54"><span class="k">def</span><span class="w"> </span><span class="nf">generate_random_styles</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">rnd</span><span class="p">):</span>
</span><span id="__span-39-55"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate 64 random styles.&quot;&quot;&quot;</span>
</span><span id="__span-39-56">    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">):</span>
</span><span id="__span-39-57">        <span class="n">style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-39-58">            <span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-39-59">            <span class="n">name</span><span class="o">=</span><span class="n">style_name_index</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
</span><span id="__span-39-60">            <span class="n">color</span><span class="o">=</span><span class="n">color_hex</span><span class="p">(</span><span class="n">rnd</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">rnd</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">rnd</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">256</span><span class="p">)),</span>
</span><span id="__span-39-61">            <span class="n">size</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">8</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">5</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-39-62">        <span class="p">)</span>
</span><span id="__span-39-63">        <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="__span-39-64">
</span><span id="__span-39-65">
</span><span id="__span-39-66"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-39-67">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">SOURCE</span><span class="p">)</span>
</span><span id="__span-39-68">    <span class="n">add_styles</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-39-69">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-39-70">
</span><span id="__span-39-71">
</span><span id="__span-39-72"><span class="k">def</span><span class="w"> </span><span class="nf">add_styles</span><span class="p">(</span><span class="n">document</span><span class="p">):</span>
</span><span id="__span-39-73">    <span class="n">rnd</span> <span class="o">=</span> <span class="n">SimpleRandom</span><span class="p">()</span>
</span><span id="__span-39-74">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-39-75">
</span><span id="__span-39-76">    <span class="n">generate_random_styles</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">rnd</span><span class="p">)</span>
</span><span id="__span-39-77">
</span><span id="__span-39-78">    <span class="n">words</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
</span><span id="__span-39-79">    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
</span><span id="__span-39-80">        <span class="n">style_name</span> <span class="o">=</span> <span class="n">style_name_index</span><span class="p">(</span><span class="n">rnd</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>
</span><span id="__span-39-81">        <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">headers</span><span class="p">):</span>
</span><span id="__span-39-82">            <span class="c1"># apply style to each text matching with the regex of some word</span>
</span><span id="__span-39-83">            <span class="n">paragraph</span><span class="o">.</span><span class="n">set_span</span><span class="p">(</span><span class="n">style_name</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="n">word</span><span class="p">)</span>
</span><span id="__span-39-84">
</span><span id="__span-39-85">    <span class="c1"># only for test suite:</span>
</span><span id="__span-39-86">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-39-87">        <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">spans</span><span class="p">))</span>
</span><span id="__span-39-88">        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">spans</span><span class="p">)</span> <span class="o">==</span> <span class="mi">157</span>
</span><span id="__span-39-89">
</span><span id="__span-39-90">
</span><span id="__span-39-91"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-39-92">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="how-to-copy-some-style-from-another-document">How to copy some style from another document</h3>
<p>Minimal example of copy of a style from another document.</p>
<details class="code">
<summary>recipes/how_to_copy_some_style_from_another_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-40-1"><span class="sd">&quot;&quot;&quot;Minimal example of copy of a style from another document.</span>
</span><span id="__span-40-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-40-3">
</span><span id="__span-40-4"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Style</span>
</span><span id="__span-40-5">
</span><span id="__span-40-6"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">310</span>
</span><span id="__span-40-7">
</span><span id="__span-40-8">
</span><span id="__span-40-9"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-40-10">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-40-11">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-40-12">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-40-13">
</span><span id="__span-40-14">    <span class="c1"># Let&#39;s imagine the sample_styles.odt document contains an interesting style.</span>
</span><span id="__span-40-15">    <span class="c1">#</span>
</span><span id="__span-40-16">    <span class="c1"># So let&#39;s first fetch the style:</span>
</span><span id="__span-40-17">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-40-18">        <span class="n">odfdo_styles</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;sample_styles.odt&quot;</span><span class="p">)</span>
</span><span id="__span-40-19">        <span class="n">highlight</span> <span class="o">=</span> <span class="n">odfdo_styles</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;Yellow Highlight&quot;</span><span class="p">)</span>
</span><span id="__span-40-20">    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-40-21">        <span class="c1"># let&#39;s create some *very simple* text style.</span>
</span><span id="__span-40-22">        <span class="n">highlight</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-40-23">            <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;Yellow Highlight&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">italic</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-40-24">        <span class="p">)</span>
</span><span id="__span-40-25">
</span><span id="__span-40-26">    <span class="c1"># We made some assumptions here:</span>
</span><span id="__span-40-27">    <span class="c1">#</span>
</span><span id="__span-40-28">    <span class="c1"># &#39;text&#39;              : The family of the style, text styles apply on</span>
</span><span id="__span-40-29">    <span class="c1">#                       individual characters.</span>
</span><span id="__span-40-30">    <span class="c1"># Yellow Highlight  : The name of the style as we see it in a desktop</span>
</span><span id="__span-40-31">    <span class="c1">#                       application.</span>
</span><span id="__span-40-32">    <span class="c1"># display_name        : Styles have an internal name (Yellow_20_Highlight</span>
</span><span id="__span-40-33">    <span class="c1">#                       in this example) but we gave the display_name</span>
</span><span id="__span-40-34">    <span class="c1">#                       instead.</span>
</span><span id="__span-40-35">    <span class="c1">#</span>
</span><span id="__span-40-36">    <span class="c1"># We hopefully have a style object that we add to our own collection:</span>
</span><span id="__span-40-37">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">highlight</span><span class="p">,</span> <span class="n">automatic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-40-38">
</span><span id="__span-40-39">
</span><span id="__span-40-40"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-40-41">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="copy-style-from-another-document">Copy style from another document</h3>
<p>Copy the styles from an existing document.</p>
<p>For more advanced version, see the odfdo-style script.</p>
<details class="code">
<summary>recipes/copy_style_from_another_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-41-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-41-2"><span class="sd">&quot;&quot;&quot;Copy the styles from an existing document.</span>
</span><span id="__span-41-3">
</span><span id="__span-41-4"><span class="sd">For more advanced version, see the odfdo-style script.</span>
</span><span id="__span-41-5"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-41-6"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-41-7"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-41-8">
</span><span id="__span-41-9"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-41-10">
</span><span id="__span-41-11"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">320</span>
</span><span id="__span-41-12"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-41-13"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;collection2.odt&quot;</span>
</span><span id="__span-41-14"><span class="c1"># copied here from the odfdo package:</span>
</span><span id="__span-41-15"><span class="n">STYLE_SOURCE</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;lpod_styles.odt&quot;</span>
</span><span id="__span-41-16"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;styled1&quot;</span>
</span><span id="__span-41-17"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-41-18">
</span><span id="__span-41-19">
</span><span id="__span-41-20"><span class="k">def</span><span class="w"> </span><span class="nf">read_source_document</span><span class="p">():</span>
</span><span id="__span-41-21">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-41-22">        <span class="n">source</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-41-23">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="__span-41-24">        <span class="n">source</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span>
</span><span id="__span-41-25">    <span class="k">return</span> <span class="n">Document</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span id="__span-41-26">
</span><span id="__span-41-27">
</span><span id="__span-41-28"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-41-29">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-41-30">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-41-31">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-41-32">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-41-33">
</span><span id="__span-41-34">
</span><span id="__span-41-35"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-41-36">    <span class="c1"># We want to change the styles of collection2.odt,</span>
</span><span id="__span-41-37">    <span class="c1"># we know the odfdo_styles.odt document contains an interesting style,</span>
</span><span id="__span-41-38">    <span class="c1"># So let&#39;s first fetch the style:</span>
</span><span id="__span-41-39">    <span class="n">style_document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">STYLE_SOURCE</span><span class="p">)</span>
</span><span id="__span-41-40">
</span><span id="__span-41-41">    <span class="c1"># Open our document:</span>
</span><span id="__span-41-42">    <span class="n">document</span> <span class="o">=</span> <span class="n">read_source_document</span><span class="p">()</span>
</span><span id="__span-41-43">
</span><span id="__span-41-44">    <span class="c1"># We could change only some styles, but here we want a clean basis:</span>
</span><span id="__span-41-45">    <span class="n">document</span><span class="o">.</span><span class="n">delete_styles</span><span class="p">()</span>
</span><span id="__span-41-46">
</span><span id="__span-41-47">    <span class="c1"># And now the actual style change:</span>
</span><span id="__span-41-48">    <span class="n">document</span><span class="o">.</span><span class="n">merge_styles_from</span><span class="p">(</span><span class="n">style_document</span><span class="p">)</span>
</span><span id="__span-41-49">
</span><span id="__span-41-50">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-41-51">
</span><span id="__span-41-52">
</span><span id="__span-41-53"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-41-54">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="create-basic-text-styles">Create basic text styles</h3>
<p>Create basic text styles.</p>
<details class="code">
<summary>recipes/create_basic_text_styles.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-42-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-42-2"><span class="sd">&quot;&quot;&quot;Create basic text styles.</span>
</span><span id="__span-42-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-42-4"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-42-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-42-6">
</span><span id="__span-42-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Paragraph</span><span class="p">,</span> <span class="n">Style</span>
</span><span id="__span-42-8">
</span><span id="__span-42-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">330</span>
</span><span id="__span-42-10"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;basic_styles&quot;</span>
</span><span id="__span-42-11"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-42-12">
</span><span id="__span-42-13">
</span><span id="__span-42-14"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-42-15">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-42-16">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-42-17">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-42-18">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-42-19">
</span><span id="__span-42-20">
</span><span id="__span-42-21"><span class="k">def</span><span class="w"> </span><span class="nf">_create_style_header_blue</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-42-22">    <span class="n">style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-42-23">        <span class="n">family</span><span class="o">=</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span>
</span><span id="__span-42-24">        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;header_blue&quot;</span><span class="p">,</span>
</span><span id="__span-42-25">        <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;header_blue&quot;</span><span class="p">,</span>
</span><span id="__span-42-26">        <span class="n">parent_style</span><span class="o">=</span><span class="s2">&quot;Heading&quot;</span><span class="p">,</span>
</span><span id="__span-42-27">        <span class="n">area</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-42-28">        <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-42-29">        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="__span-42-30">        <span class="n">size</span><span class="o">=</span><span class="s2">&quot;160%&quot;</span><span class="p">,</span>
</span><span id="__span-42-31">    <span class="p">)</span>
</span><span id="__span-42-32">    <span class="n">style</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s2">&quot;style:default-outline-level&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
</span><span id="__span-42-33">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="__span-42-34">
</span><span id="__span-42-35">
</span><span id="__span-42-36"><span class="k">def</span><span class="w"> </span><span class="nf">_create_style_header_navy</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-42-37">    <span class="n">style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-42-38">        <span class="n">family</span><span class="o">=</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span>
</span><span id="__span-42-39">        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;header_navy&quot;</span><span class="p">,</span>
</span><span id="__span-42-40">        <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;header_navy&quot;</span><span class="p">,</span>
</span><span id="__span-42-41">        <span class="n">parent_style</span><span class="o">=</span><span class="s2">&quot;Heading&quot;</span><span class="p">,</span>
</span><span id="__span-42-42">        <span class="n">area</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-42-43">        <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-42-44">        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;navy&quot;</span><span class="p">,</span>
</span><span id="__span-42-45">        <span class="n">size</span><span class="o">=</span><span class="s2">&quot;120%&quot;</span><span class="p">,</span>
</span><span id="__span-42-46">    <span class="p">)</span>
</span><span id="__span-42-47">    <span class="n">style</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s2">&quot;style:default-outline-level&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>
</span><span id="__span-42-48">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="__span-42-49">
</span><span id="__span-42-50">
</span><span id="__span-42-51"><span class="k">def</span><span class="w"> </span><span class="nf">_create_style_steel</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-42-52">    <span class="n">style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-42-53">        <span class="n">family</span><span class="o">=</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span>
</span><span id="__span-42-54">        <span class="n">area</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-42-55">        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;steel&quot;</span><span class="p">,</span>
</span><span id="__span-42-56">        <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;steel&quot;</span><span class="p">,</span>
</span><span id="__span-42-57">        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
</span><span id="__span-42-58">        <span class="n">background_color</span><span class="o">=</span><span class="s2">&quot;darkblue&quot;</span><span class="p">,</span>
</span><span id="__span-42-59">    <span class="p">)</span>
</span><span id="__span-42-60">    <span class="n">style</span><span class="o">.</span><span class="n">set_properties</span><span class="p">(</span>
</span><span id="__span-42-61">        <span class="n">area</span><span class="o">=</span><span class="s2">&quot;graphic&quot;</span><span class="p">,</span>
</span><span id="__span-42-62">        <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-42-63">            <span class="s2">&quot;draw:fill&quot;</span><span class="p">:</span> <span class="s2">&quot;solid&quot;</span><span class="p">,</span>
</span><span id="__span-42-64">            <span class="s2">&quot;draw:fill-color&quot;</span><span class="p">:</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">,</span>
</span><span id="__span-42-65">        <span class="p">},</span>
</span><span id="__span-42-66">    <span class="p">)</span>
</span><span id="__span-42-67">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="__span-42-68">
</span><span id="__span-42-69">
</span><span id="__span-42-70"><span class="k">def</span><span class="w"> </span><span class="nf">_create_style_special</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-42-71">    <span class="n">style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-42-72">        <span class="n">family</span><span class="o">=</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span>
</span><span id="__span-42-73">        <span class="n">area</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-42-74">        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;special&quot;</span><span class="p">,</span>
</span><span id="__span-42-75">        <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;special&quot;</span><span class="p">,</span>
</span><span id="__span-42-76">        <span class="n">font</span><span class="o">=</span><span class="s2">&quot;Courier New&quot;</span><span class="p">,</span>
</span><span id="__span-42-77">        <span class="n">font_family</span><span class="o">=</span><span class="s2">&quot;Courier New&quot;</span><span class="p">,</span>
</span><span id="__span-42-78">        <span class="n">font_style_name</span><span class="o">=</span><span class="s2">&quot;Regular&quot;</span><span class="p">,</span>
</span><span id="__span-42-79">        <span class="n">font_pitch</span><span class="o">=</span><span class="s2">&quot;fixed&quot;</span><span class="p">,</span>
</span><span id="__span-42-80">        <span class="n">background_color</span><span class="o">=</span><span class="s2">&quot;AntiqueWhite&quot;</span><span class="p">,</span>
</span><span id="__span-42-81">    <span class="p">)</span>
</span><span id="__span-42-82">    <span class="n">style</span><span class="o">.</span><span class="n">set_properties</span><span class="p">(</span>
</span><span id="__span-42-83">        <span class="n">area</span><span class="o">=</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span>
</span><span id="__span-42-84">        <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-42-85">            <span class="s2">&quot;fo:margin-left&quot;</span><span class="p">:</span> <span class="s2">&quot;2cm&quot;</span><span class="p">,</span>
</span><span id="__span-42-86">            <span class="s2">&quot;fo:margin-right&quot;</span><span class="p">:</span> <span class="s2">&quot;2cm&quot;</span><span class="p">,</span>
</span><span id="__span-42-87">            <span class="s2">&quot;fo:line-height&quot;</span><span class="p">:</span> <span class="s2">&quot;150%&quot;</span><span class="p">,</span>
</span><span id="__span-42-88">            <span class="s2">&quot;fo:text-align&quot;</span><span class="p">:</span> <span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span id="__span-42-89">        <span class="p">},</span>
</span><span id="__span-42-90">    <span class="p">)</span>
</span><span id="__span-42-91">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="__span-42-92">
</span><span id="__span-42-93">
</span><span id="__span-42-94"><span class="k">def</span><span class="w"> </span><span class="nf">_create_style_bold_gold</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-42-95">    <span class="n">style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-42-96">        <span class="n">family</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-42-97">        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bold_gold&quot;</span><span class="p">,</span>
</span><span id="__span-42-98">        <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;bold_gold&quot;</span><span class="p">,</span>
</span><span id="__span-42-99">        <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-42-100">        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgoldenrod&quot;</span><span class="p">,</span>
</span><span id="__span-42-101">    <span class="p">)</span>
</span><span id="__span-42-102">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="__span-42-103">
</span><span id="__span-42-104">
</span><span id="__span-42-105"><span class="k">def</span><span class="w"> </span><span class="nf">_create_style_italic_lime</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-42-106">    <span class="n">style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-42-107">        <span class="n">family</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-42-108">        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;italic_lime&quot;</span><span class="p">,</span>
</span><span id="__span-42-109">        <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;italic_lime&quot;</span><span class="p">,</span>
</span><span id="__span-42-110">        <span class="n">italic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-42-111">        <span class="n">size</span><span class="o">=</span><span class="s2">&quot;120%&quot;</span><span class="p">,</span>
</span><span id="__span-42-112">        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lime&quot;</span><span class="p">,</span>
</span><span id="__span-42-113">    <span class="p">)</span>
</span><span id="__span-42-114">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
</span><span id="__span-42-115">
</span><span id="__span-42-116">
</span><span id="__span-42-117"><span class="k">def</span><span class="w"> </span><span class="nf">add_styles</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-42-118">    <span class="n">_create_style_header_blue</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-42-119">    <span class="n">_create_style_header_navy</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-42-120">    <span class="n">_create_style_steel</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-42-121">    <span class="n">_create_style_special</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-42-122">    <span class="n">_create_style_bold_gold</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-42-123">    <span class="n">_create_style_italic_lime</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-42-124">
</span><span id="__span-42-125">
</span><span id="__span-42-126"><span class="k">def</span><span class="w"> </span><span class="nf">add_content</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-42-127">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-42-128">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;First level header&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header_blue&quot;</span><span class="p">))</span>
</span><span id="__span-42-129">
</span><span id="__span-42-130">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;First sub header&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header_navy&quot;</span><span class="p">))</span>
</span><span id="__span-42-131">    <span class="n">para</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-42-132">        <span class="s2">&quot;Lorem ipsum dolor sit amet, consectetuer &quot;</span>
</span><span id="__span-42-133">        <span class="s2">&quot;adipiscing elit. Sed non risus. &quot;</span>
</span><span id="__span-42-134">        <span class="s2">&quot;Suspendisse lectus tortor, dignissim sit amet, &quot;</span>
</span><span id="__span-42-135">        <span class="s2">&quot;adipiscing nec, ultricies sed, dolor.&quot;</span>
</span><span id="__span-42-136">    <span class="p">)</span>
</span><span id="__span-42-137">    <span class="n">para</span><span class="o">.</span><span class="n">set_span</span><span class="p">(</span><span class="s2">&quot;bold_gold&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="s2">&quot;dolor&quot;</span><span class="p">)</span>
</span><span id="__span-42-138">    <span class="n">para</span><span class="o">.</span><span class="n">set_span</span><span class="p">(</span><span class="s2">&quot;italic_lime&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\w+ing&quot;</span><span class="p">)</span>
</span><span id="__span-42-139">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para</span><span class="p">)</span>
</span><span id="__span-42-140">
</span><span id="__span-42-141">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Second sub header&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header_navy&quot;</span><span class="p">))</span>
</span><span id="__span-42-142">    <span class="n">para</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-42-143">        <span class="s2">&quot;Cras elementum ultrices diam. Maecenas ligula massa, &quot;</span>
</span><span id="__span-42-144">        <span class="s2">&quot;varius a, semper congue, euismod non, mi. Proin porttitor, &quot;</span>
</span><span id="__span-42-145">        <span class="s2">&quot;orci nec nonummy molestie, enim est eleifend mi, non &quot;</span>
</span><span id="__span-42-146">        <span class="s2">&quot;fermentum diam nisl sit amet erat. Duis semper.&quot;</span><span class="p">,</span>
</span><span id="__span-42-147">        <span class="n">style</span><span class="o">=</span><span class="s2">&quot;steel&quot;</span><span class="p">,</span>
</span><span id="__span-42-148">    <span class="p">)</span>
</span><span id="__span-42-149">    <span class="n">para</span><span class="o">.</span><span class="n">set_span</span><span class="p">(</span><span class="s2">&quot;italic_lime&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="s2">&quot;semper&quot;</span><span class="p">)</span>
</span><span id="__span-42-150">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para</span><span class="p">)</span>
</span><span id="__span-42-151">
</span><span id="__span-42-152">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Third sub header&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header_navy&quot;</span><span class="p">))</span>
</span><span id="__span-42-153">    <span class="n">para</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-42-154">        <span class="s2">&quot;Duis arcu massa, scelerisque vitae, consequat in, pretium a, &quot;</span>
</span><span id="__span-42-155">        <span class="s2">&quot;enim. Pellentesque congue. Ut in risus volutpat libero &quot;</span>
</span><span id="__span-42-156">        <span class="s2">&quot;pharetra tempor. Cras vestibulum bibendum augue. Praesent &quot;</span>
</span><span id="__span-42-157">        <span class="s2">&quot;egestas leo in pede. Praesent blandit odio eu enim. &quot;</span>
</span><span id="__span-42-158">        <span class="s2">&quot;Pellentesque sed dui ut augue blandit sodales.&quot;</span><span class="p">,</span>
</span><span id="__span-42-159">        <span class="n">style</span><span class="o">=</span><span class="s2">&quot;special&quot;</span><span class="p">,</span>
</span><span id="__span-42-160">    <span class="p">)</span>
</span><span id="__span-42-161">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">para</span><span class="p">)</span>
</span><span id="__span-42-162">
</span><span id="__span-42-163">
</span><span id="__span-42-164"><span class="k">def</span><span class="w"> </span><span class="nf">create_document</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="__span-42-165">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">()</span>
</span><span id="__span-42-166">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-42-167">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-42-168">    <span class="n">add_styles</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-42-169">    <span class="n">add_content</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-42-170">    <span class="k">return</span> <span class="n">document</span>
</span><span id="__span-42-171">
</span><span id="__span-42-172">
</span><span id="__span-42-173"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-42-174">    <span class="n">document</span> <span class="o">=</span> <span class="n">create_document</span><span class="p">()</span>
</span><span id="__span-42-175">    <span class="n">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-42-176">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-42-177">
</span><span id="__span-42-178">
</span><span id="__span-42-179"><span class="k">def</span><span class="w"> </span><span class="nf">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-42-180">    <span class="c1"># only for test suite:</span>
</span><span id="__span-42-181">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-42-182">        <span class="k">return</span>
</span><span id="__span-42-183">    <span class="n">style1</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span> <span class="s2">&quot;header_blue&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</span><span id="__span-42-184">    <span class="k">assert</span> <span class="s1">&#39;name=&quot;header_blue&quot;&#39;</span> <span class="ow">in</span> <span class="n">style1</span>
</span><span id="__span-42-185">    <span class="k">assert</span> <span class="s1">&#39;color=&quot;#0000FF&quot;&#39;</span> <span class="ow">in</span> <span class="n">style1</span>
</span><span id="__span-42-186">    <span class="k">assert</span> <span class="s1">&#39;font-weight=&quot;bold&quot;&#39;</span> <span class="ow">in</span> <span class="n">style1</span>
</span><span id="__span-42-187">    <span class="k">assert</span> <span class="s1">&#39;font-size=&quot;160%&quot;&#39;</span> <span class="ow">in</span> <span class="n">style1</span>
</span><span id="__span-42-188">
</span><span id="__span-42-189">    <span class="n">style2</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span> <span class="s2">&quot;header_navy&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</span><span id="__span-42-190">    <span class="k">assert</span> <span class="s1">&#39;name=&quot;header_navy&quot;&#39;</span> <span class="ow">in</span> <span class="n">style2</span>
</span><span id="__span-42-191">    <span class="k">assert</span> <span class="s1">&#39;color=&quot;#000080&quot;&#39;</span> <span class="ow">in</span> <span class="n">style2</span>
</span><span id="__span-42-192">    <span class="k">assert</span> <span class="s1">&#39;font-weight=&quot;bold&quot;&#39;</span> <span class="ow">in</span> <span class="n">style2</span>
</span><span id="__span-42-193">    <span class="k">assert</span> <span class="s1">&#39;font-size=&quot;120%&quot;&#39;</span> <span class="ow">in</span> <span class="n">style2</span>
</span><span id="__span-42-194">
</span><span id="__span-42-195">    <span class="n">style3</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span> <span class="s2">&quot;steel&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</span><span id="__span-42-196">    <span class="k">assert</span> <span class="s1">&#39;name=&quot;steel&quot;&#39;</span> <span class="ow">in</span> <span class="n">style3</span>
</span><span id="__span-42-197">    <span class="k">assert</span> <span class="s1">&#39;color=&quot;#FFFF00&quot;&#39;</span> <span class="ow">in</span> <span class="n">style3</span>
</span><span id="__span-42-198">    <span class="k">assert</span> <span class="s2">&quot;graphic-properties&quot;</span> <span class="ow">in</span> <span class="n">style3</span>
</span><span id="__span-42-199">    <span class="k">assert</span> <span class="s1">&#39;draw:fill-color=&quot;#00008B&quot;&#39;</span> <span class="ow">in</span> <span class="n">style3</span>
</span><span id="__span-42-200">
</span><span id="__span-42-201">    <span class="n">style4</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span> <span class="s2">&quot;special&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</span><span id="__span-42-202">    <span class="k">assert</span> <span class="s1">&#39;name=&quot;special&quot;&#39;</span> <span class="ow">in</span> <span class="n">style4</span>
</span><span id="__span-42-203">    <span class="k">assert</span> <span class="s1">&#39;background-color=&quot;#FAEBD7&quot;&#39;</span> <span class="ow">in</span> <span class="n">style4</span>
</span><span id="__span-42-204">    <span class="k">assert</span> <span class="s2">&quot;Courier&quot;</span> <span class="ow">in</span> <span class="n">style4</span>
</span><span id="__span-42-205">    <span class="k">assert</span> <span class="s1">&#39;line-height=&quot;150%&quot;&#39;</span> <span class="ow">in</span> <span class="n">style4</span>
</span><span id="__span-42-206">    <span class="k">assert</span> <span class="s1">&#39;margin-left=&quot;2cm&quot;&#39;</span> <span class="ow">in</span> <span class="n">style4</span>
</span><span id="__span-42-207">    <span class="k">assert</span> <span class="s1">&#39;margin-right=&quot;2cm&quot;&#39;</span> <span class="ow">in</span> <span class="n">style4</span>
</span><span id="__span-42-208">    <span class="k">assert</span> <span class="s1">&#39;text-align=&quot;center&quot;&#39;</span> <span class="ow">in</span> <span class="n">style4</span>
</span><span id="__span-42-209">
</span><span id="__span-42-210">    <span class="n">style5</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;bold_gold&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</span><span id="__span-42-211">    <span class="k">assert</span> <span class="s1">&#39;name=&quot;bold_gold&quot;&#39;</span> <span class="ow">in</span> <span class="n">style5</span>
</span><span id="__span-42-212">    <span class="k">assert</span> <span class="s1">&#39;color=&quot;#B8860B&quot;&#39;</span> <span class="ow">in</span> <span class="n">style5</span>
</span><span id="__span-42-213">    <span class="k">assert</span> <span class="s1">&#39;font-weight=&quot;bold&quot;&#39;</span> <span class="ow">in</span> <span class="n">style5</span>
</span><span id="__span-42-214">
</span><span id="__span-42-215">    <span class="n">style6</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;italic_lime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</span><span id="__span-42-216">    <span class="k">assert</span> <span class="s1">&#39;name=&quot;italic_lime&quot;&#39;</span> <span class="ow">in</span> <span class="n">style6</span>
</span><span id="__span-42-217">    <span class="k">assert</span> <span class="s1">&#39;color=&quot;#00FF00&quot;&#39;</span> <span class="ow">in</span> <span class="n">style6</span>
</span><span id="__span-42-218">    <span class="k">assert</span> <span class="s1">&#39;font-style=&quot;italic&quot;&#39;</span> <span class="ow">in</span> <span class="n">style6</span>
</span><span id="__span-42-219">    <span class="k">assert</span> <span class="s1">&#39;font-size=&quot;120%&quot;&#39;</span> <span class="ow">in</span> <span class="n">style6</span>
</span><span id="__span-42-220">
</span><span id="__span-42-221">
</span><span id="__span-42-222"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-42-223">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="how-to-apply-a-style-to-a-paragraph">How to apply a style to a paragraph</h3>
<p>Minimal example of how to add a styled paragraph to a document.</p>
<details class="code">
<summary>recipes/how_to_apply_a_style_to_a_paragraph.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-43-1"><span class="sd">&quot;&quot;&quot;Minimal example of how to add a styled paragraph to a document.</span>
</span><span id="__span-43-2"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-43-3">
</span><span id="__span-43-4"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Paragraph</span>
</span><span id="__span-43-5">
</span><span id="__span-43-6"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">335</span>
</span><span id="__span-43-7">
</span><span id="__span-43-8">
</span><span id="__span-43-9"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-43-10">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-43-11">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-43-12">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-43-13">
</span><span id="__span-43-14">    <span class="c1"># we knwo we have a style of name &quot;highlight&quot; :</span>
</span><span id="__span-43-15">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Highlighting the word&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;highlight&quot;</span><span class="p">))</span>
</span><span id="__span-43-16">
</span><span id="__span-43-17">
</span><span id="__span-43-18"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-43-19">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="change-paragraph-styles-methods">Change paragraph styles methods</h3>
<p>Many examples of how to change paragraph (and in-paragraph) styles, either
by changing the paragraph style itself or by using Span to select parts
of the paragraph. Includes several ways to create or import styles.</p>
<details class="code">
<summary>recipes/change_paragraph_styles_methods.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-44-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-44-2"><span class="sd">&quot;&quot;&quot;Many examples of how to change paragraph (and in-paragraph) styles, either</span>
</span><span id="__span-44-3"><span class="sd">by changing the paragraph style itself or by using Span to select parts</span>
</span><span id="__span-44-4"><span class="sd">of the paragraph. Includes several ways to create or import styles.</span>
</span><span id="__span-44-5"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-44-6"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-44-7"><span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterator</span>
</span><span id="__span-44-8"><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">cycle</span>
</span><span id="__span-44-9"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-44-10">
</span><span id="__span-44-11"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Element</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Paragraph</span><span class="p">,</span> <span class="n">Style</span>
</span><span id="__span-44-12">
</span><span id="__span-44-13"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">340</span>
</span><span id="__span-44-14"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;change_styles&quot;</span>
</span><span id="__span-44-15"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-44-16"><span class="n">LOREM</span> <span class="o">=</span> <span class="p">(</span><span class="n">DATA</span> <span class="o">/</span> <span class="s2">&quot;lorem.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
</span><span id="__span-44-17"><span class="n">STYLED_SOURCE</span> <span class="o">=</span> <span class="s2">&quot;lpod_styles.odt&quot;</span>
</span><span id="__span-44-18"><span class="n">TARGET_BEFORE</span> <span class="o">=</span> <span class="s2">&quot;document_before.odt&quot;</span>
</span><span id="__span-44-19"><span class="n">TARGET_AFTER</span> <span class="o">=</span> <span class="s2">&quot;document_after.odt&quot;</span>
</span><span id="__span-44-20">
</span><span id="__span-44-21">
</span><span id="__span-44-22"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-44-23">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-44-24">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-44-25">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-44-26">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-44-27">
</span><span id="__span-44-28">
</span><span id="__span-44-29"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-44-30">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;odt&quot;</span><span class="p">)</span>
</span><span id="__span-44-31">    <span class="n">make_base_document</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-44-32">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET_BEFORE</span><span class="p">)</span>
</span><span id="__span-44-33">    <span class="n">add_some_styles</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-44-34">    <span class="n">add_style_from_xml</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-44-35">    <span class="n">import_style_from_other_doc</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-44-36">    <span class="n">apply_styles</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-44-37">    <span class="n">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-44-38">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET_AFTER</span><span class="p">)</span>
</span><span id="__span-44-39">
</span><span id="__span-44-40">
</span><span id="__span-44-41"><span class="k">def</span><span class="w"> </span><span class="nf">iter_lorem</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-44-42">    <span class="k">return</span> <span class="n">cycle</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="n">LOREM</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
</span><span id="__span-44-43">
</span><span id="__span-44-44">
</span><span id="__span-44-45"><span class="k">def</span><span class="w"> </span><span class="nf">make_base_document</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-44-46"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fill document from parts or lorem ipsum content.&quot;&quot;&quot;</span>
</span><span id="__span-44-47">    <span class="c1"># Create the document</span>
</span><span id="__span-44-48">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-44-49">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-44-50">    <span class="c1"># Add some content with headers</span>
</span><span id="__span-44-51">    <span class="n">lorem</span> <span class="o">=</span> <span class="n">iter_lorem</span><span class="p">()</span>
</span><span id="__span-44-52">    <span class="n">title1</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">lorem</span><span class="p">))</span>
</span><span id="__span-44-53">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title1</span><span class="p">)</span>
</span><span id="__span-44-54">    <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="__span-44-55">        <span class="n">title</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">lorem</span><span class="p">))</span>
</span><span id="__span-44-56">        <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="__span-44-57">        <span class="k">for</span> <span class="n">_j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span><span id="__span-44-58">            <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">lorem</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;. &quot;</span> <span class="o">+</span> <span class="nb">next</span><span class="p">(</span><span class="n">lorem</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span>
</span><span id="__span-44-59">
</span><span id="__span-44-60">
</span><span id="__span-44-61"><span class="k">def</span><span class="w"> </span><span class="nf">add_some_styles</span><span class="p">(</span><span class="n">document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-44-62">    <span class="c1"># Always simpler to copy styles from an actual .odt existing file, but:</span>
</span><span id="__span-44-63">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span>
</span><span id="__span-44-64">        <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-44-65">            <span class="n">family</span><span class="o">=</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span>
</span><span id="__span-44-66">            <span class="n">area</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-44-67">            <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;bold-blue&quot;</span><span class="p">,</span>
</span><span id="__span-44-68">            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="__span-44-69">            <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-44-70">        <span class="p">),</span>
</span><span id="__span-44-71">        <span class="n">automatic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-44-72">    <span class="p">)</span>
</span><span id="__span-44-73">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span>
</span><span id="__span-44-74">        <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-44-75">            <span class="n">family</span><span class="o">=</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span>
</span><span id="__span-44-76">            <span class="n">area</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-44-77">            <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;italic-red&quot;</span><span class="p">,</span>
</span><span id="__span-44-78">            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
</span><span id="__span-44-79">            <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-44-80">            <span class="n">italic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-44-81">        <span class="p">),</span>
</span><span id="__span-44-82">        <span class="n">automatic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-44-83">    <span class="p">)</span>
</span><span id="__span-44-84">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span>
</span><span id="__span-44-85">        <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-44-86">            <span class="n">family</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-44-87">            <span class="n">area</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-44-88">            <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="__span-44-89">            <span class="n">background_color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="__span-44-90">        <span class="p">),</span>
</span><span id="__span-44-91">        <span class="n">automatic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-44-92">    <span class="p">)</span>
</span><span id="__span-44-93">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span>
</span><span id="__span-44-94">        <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-44-95">            <span class="n">family</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-44-96">            <span class="n">area</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-44-97">            <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;bold-yellow-blue&quot;</span><span class="p">,</span>
</span><span id="__span-44-98">            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
</span><span id="__span-44-99">            <span class="n">background_color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="__span-44-100">            <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-44-101">        <span class="p">),</span>
</span><span id="__span-44-102">        <span class="n">automatic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-44-103">    <span class="p">)</span>
</span><span id="__span-44-104">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span>
</span><span id="__span-44-105">        <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-44-106">            <span class="n">family</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-44-107">            <span class="n">area</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-44-108">            <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;bold-white-black&quot;</span><span class="p">,</span>
</span><span id="__span-44-109">            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="__span-44-110">            <span class="n">background_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="__span-44-111">            <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-44-112">        <span class="p">),</span>
</span><span id="__span-44-113">        <span class="n">automatic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-44-114">    <span class="p">)</span>
</span><span id="__span-44-115">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span>
</span><span id="__span-44-116">        <span class="n">Style</span><span class="p">(</span>
</span><span id="__span-44-117">            <span class="n">family</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-44-118">            <span class="n">area</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-44-119">            <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;italic-red-yellow&quot;</span><span class="p">,</span>
</span><span id="__span-44-120">            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
</span><span id="__span-44-121">            <span class="n">background_color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
</span><span id="__span-44-122">            <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-44-123">            <span class="n">italic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-44-124">        <span class="p">),</span>
</span><span id="__span-44-125">        <span class="n">automatic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-44-126">    <span class="p">)</span>
</span><span id="__span-44-127">
</span><span id="__span-44-128">
</span><span id="__span-44-129"><span class="k">def</span><span class="w"> </span><span class="nf">add_style_from_xml</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-44-130">    <span class="c1"># Styles can be defined by WML definition</span>
</span><span id="__span-44-131">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span>
</span><span id="__span-44-132">        <span class="n">Element</span><span class="o">.</span><span class="n">from_tag</span><span class="p">(</span>
</span><span id="__span-44-133">            <span class="s1">&#39;&lt;style:style style:name=&quot;custom&quot; &#39;</span>
</span><span id="__span-44-134">            <span class="s1">&#39;style:display-name=&quot;custom&quot; &#39;</span>
</span><span id="__span-44-135">            <span class="s1">&#39;style:family=&quot;paragraph&quot; &#39;</span>
</span><span id="__span-44-136">            <span class="s1">&#39;style:parent-style-name=&quot;Text&quot;&gt;&#39;</span>
</span><span id="__span-44-137">            <span class="s1">&#39;&lt;style:paragraph-properties fo:margin-left=&quot;2cm&quot;/&gt;&#39;</span>
</span><span id="__span-44-138">            <span class="s1">&#39;&lt;style:text-properties fo:color=&quot;#808080&quot; loext:opacity=&quot;100%&quot; &#39;</span>
</span><span id="__span-44-139">            <span class="s1">&#39;fo:font-size=&quot;16pt&quot; fo:font-style=&quot;normal&quot; &#39;</span>
</span><span id="__span-44-140">            <span class="s1">&#39;style:text-underline-style=&quot;solid&quot; &#39;</span>
</span><span id="__span-44-141">            <span class="s1">&#39;style:text-underline-width=&quot;auto&quot; &#39;</span>
</span><span id="__span-44-142">            <span class="s1">&#39;style:text-underline-color=&quot;font-color&quot; &#39;</span>
</span><span id="__span-44-143">            <span class="s1">&#39;fo:font-weight=&quot;bold&quot;/&gt;&#39;</span>
</span><span id="__span-44-144">            <span class="s2">&quot;&lt;/style:style&gt;&quot;</span>
</span><span id="__span-44-145">        <span class="p">)</span>
</span><span id="__span-44-146">    <span class="p">)</span>
</span><span id="__span-44-147">
</span><span id="__span-44-148">
</span><span id="__span-44-149"><span class="k">def</span><span class="w"> </span><span class="nf">import_style_from_other_doc</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-44-150">    <span class="n">styled_doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">DATA</span> <span class="o">/</span> <span class="n">STYLED_SOURCE</span><span class="p">)</span>
</span><span id="__span-44-151">    <span class="n">highlight</span> <span class="o">=</span> <span class="n">styled_doc</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;Yellow Highlight&quot;</span><span class="p">)</span>
</span><span id="__span-44-152">    <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">highlight</span><span class="p">,</span> <span class="n">automatic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-44-153">
</span><span id="__span-44-154">
</span><span id="__span-44-155"><span class="k">def</span><span class="w"> </span><span class="nf">apply_styles</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-44-156"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply some style changes to document.&quot;&quot;&quot;</span>
</span><span id="__span-44-157">
</span><span id="__span-44-158">    <span class="k">def</span><span class="w"> </span><span class="nf">change_all_headers</span><span class="p">():</span>
</span><span id="__span-44-159">        <span class="n">style</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</span><span id="__span-44-160">        <span class="c1"># header styles should include some hints about he numeration level</span>
</span><span id="__span-44-161">        <span class="c1"># So, here we just prefer to apply style with a span</span>
</span><span id="__span-44-162">        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
</span><span id="__span-44-163">            <span class="n">header</span><span class="o">.</span><span class="n">set_span</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-44-164">
</span><span id="__span-44-165">    <span class="k">def</span><span class="w"> </span><span class="nf">change_all_paragraphs</span><span class="p">():</span>
</span><span id="__span-44-166">        <span class="n">style</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;bold-blue&quot;</span><span class="p">)</span>
</span><span id="__span-44-167">        <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
</span><span id="__span-44-168">            <span class="n">para</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-44-169">
</span><span id="__span-44-170">    <span class="k">def</span><span class="w"> </span><span class="nf">change_some_paragraph</span><span class="p">():</span>
</span><span id="__span-44-171">        <span class="n">style</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;italic-red&quot;</span><span class="p">)</span>
</span><span id="__span-44-172">        <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraph</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-44-173">        <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraph</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-44-174">        <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraph</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-44-175">
</span><span id="__span-44-176">    <span class="k">def</span><span class="w"> </span><span class="nf">apply_span_regex</span><span class="p">():</span>
</span><span id="__span-44-177">        <span class="n">yellow</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;bold-yellow-blue&quot;</span><span class="p">)</span>
</span><span id="__span-44-178">        <span class="n">white</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;bold-white-black&quot;</span><span class="p">)</span>
</span><span id="__span-44-179">        <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
</span><span id="__span-44-180">            <span class="n">para</span><span class="o">.</span><span class="n">set_span</span><span class="p">(</span><span class="n">yellow</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;tortor|ipsum&quot;</span><span class="p">)</span>
</span><span id="__span-44-181">            <span class="n">para</span><span class="o">.</span><span class="n">set_span</span><span class="p">(</span><span class="n">white</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;A\w+&quot;</span><span class="p">)</span>
</span><span id="__span-44-182">
</span><span id="__span-44-183">    <span class="k">def</span><span class="w"> </span><span class="nf">apply_span_offset</span><span class="p">():</span>
</span><span id="__span-44-184">        <span class="n">red</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;italic-red-yellow&quot;</span><span class="p">)</span>
</span><span id="__span-44-185">        <span class="n">para</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraph</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-44-186">        <span class="n">para</span><span class="o">.</span><span class="n">set_span</span><span class="p">(</span><span class="n">red</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
</span><span id="__span-44-187">
</span><span id="__span-44-188">    <span class="k">def</span><span class="w"> </span><span class="nf">apply_custom_style</span><span class="p">():</span>
</span><span id="__span-44-189">        <span class="n">para</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraph</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
</span><span id="__span-44-190">        <span class="n">para</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;custom&quot;</span>
</span><span id="__span-44-191">
</span><span id="__span-44-192">    <span class="k">def</span><span class="w"> </span><span class="nf">apply_imported_style</span><span class="p">():</span>
</span><span id="__span-44-193">        <span class="n">para</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraph</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
</span><span id="__span-44-194">        <span class="n">style</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;Yellow Highlight&quot;</span><span class="p">)</span>
</span><span id="__span-44-195">        <span class="c1"># feature: to not highlight spaces, make as many Spans as required:</span>
</span><span id="__span-44-196">        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">para</span><span class="o">.</span><span class="n">search_all</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\w+&quot;</span><span class="p">):</span>
</span><span id="__span-44-197">            <span class="n">length</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
</span><span id="__span-44-198">            <span class="n">para</span><span class="o">.</span><span class="n">set_span</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">)</span>
</span><span id="__span-44-199">
</span><span id="__span-44-200">    <span class="n">change_all_headers</span><span class="p">()</span>
</span><span id="__span-44-201">    <span class="n">change_all_paragraphs</span><span class="p">()</span>
</span><span id="__span-44-202">    <span class="n">change_some_paragraph</span><span class="p">()</span>
</span><span id="__span-44-203">    <span class="n">apply_span_regex</span><span class="p">()</span>
</span><span id="__span-44-204">    <span class="n">apply_span_offset</span><span class="p">()</span>
</span><span id="__span-44-205">    <span class="n">apply_custom_style</span><span class="p">()</span>
</span><span id="__span-44-206">    <span class="n">apply_imported_style</span><span class="p">()</span>
</span><span id="__span-44-207">
</span><span id="__span-44-208">
</span><span id="__span-44-209"><span class="k">def</span><span class="w"> </span><span class="nf">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-44-210">    <span class="c1"># only for test suite:</span>
</span><span id="__span-44-211">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-44-212">        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">))</span> <span class="o">==</span> <span class="mi">15</span>
</span><span id="__span-44-213">        <span class="k">for</span> <span class="n">display_name</span> <span class="ow">in</span> <span class="p">(</span>
</span><span id="__span-44-214">            <span class="s2">&quot;bold-blue&quot;</span><span class="p">,</span>
</span><span id="__span-44-215">            <span class="s2">&quot;italic-red&quot;</span><span class="p">,</span>
</span><span id="__span-44-216">            <span class="s2">&quot;custom&quot;</span><span class="p">,</span>
</span><span id="__span-44-217">        <span class="p">):</span>
</span><span id="__span-44-218">            <span class="n">style</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;paragraph&quot;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="n">display_name</span><span class="p">)</span>
</span><span id="__span-44-219">            <span class="k">assert</span> <span class="n">document</span><span class="o">.</span><span class="n">get_styled_elements</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-44-220">        <span class="k">for</span> <span class="n">display_name</span> <span class="ow">in</span> <span class="p">(</span>
</span><span id="__span-44-221">            <span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="__span-44-222">            <span class="s2">&quot;bold-yellow-blue&quot;</span><span class="p">,</span>
</span><span id="__span-44-223">            <span class="s2">&quot;bold-white-black&quot;</span><span class="p">,</span>
</span><span id="__span-44-224">            <span class="s2">&quot;Yellow Highlight&quot;</span><span class="p">,</span>
</span><span id="__span-44-225">        <span class="p">):</span>
</span><span id="__span-44-226">            <span class="n">style</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="n">display_name</span><span class="p">)</span>
</span><span id="__span-44-227">            <span class="k">assert</span> <span class="n">document</span><span class="o">.</span><span class="n">get_styled_elements</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-44-228">        <span class="n">style</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_style</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="s2">&quot;Yellow Highlight&quot;</span><span class="p">)</span>
</span><span id="__span-44-229">        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">get_styled_elements</span><span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">name</span><span class="p">))</span> <span class="o">==</span> <span class="mi">21</span>
</span><span id="__span-44-230">
</span><span id="__span-44-231">
</span><span id="__span-44-232"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-44-233">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="delete-parts-of-a-text-document">Delete parts of a text document</h3>
<p>Idea comming from issue #49:
Deleting content from one point to another in a .odt document.</p>
<details class="code">
<summary>recipes/delete_parts_of_a_text_document.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-45-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-45-2"><span class="sd">&quot;&quot;&quot;Idea comming from issue #49:</span>
</span><span id="__span-45-3"><span class="sd">Deleting content from one point to another in a .odt document.</span>
</span><span id="__span-45-4"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-45-5">
</span><span id="__span-45-6"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-45-7"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-45-8">
</span><span id="__span-45-9"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Element</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Paragraph</span>
</span><span id="__span-45-10">
</span><span id="__span-45-11"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">400</span>
</span><span id="__span-45-12"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;delete_content&quot;</span>
</span><span id="__span-45-13"><span class="n">TARGET_INITIAL</span> <span class="o">=</span> <span class="s2">&quot;document_initial.odt&quot;</span>
</span><span id="__span-45-14"><span class="n">TARGET_FINAL</span> <span class="o">=</span> <span class="s2">&quot;document_final.odt&quot;</span>
</span><span id="__span-45-15">
</span><span id="__span-45-16">
</span><span id="__span-45-17"><span class="k">class</span><span class="w"> </span><span class="nc">KeepingState</span><span class="p">:</span>
</span><span id="__span-45-18">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-45-19">        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">initial</span>
</span><span id="__span-45-20">
</span><span id="__span-45-21">
</span><span id="__span-45-22"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-45-23">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-45-24">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-45-25">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-45-26">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-45-27">
</span><span id="__span-45-28">
</span><span id="__span-45-29"><span class="k">def</span><span class="w"> </span><span class="nf">create_base_document</span><span class="p">():</span>
</span><span id="__span-45-30">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-45-31">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-45-32">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-45-33">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Some title&quot;</span><span class="p">))</span>
</span><span id="__span-45-34">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;part A&quot;</span><span class="p">))</span>
</span><span id="__span-45-35">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-45-36">        <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-45-37">            <span class="s2">&quot;Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Sed non risus.&quot;</span>
</span><span id="__span-45-38">        <span class="p">)</span>
</span><span id="__span-45-39">    <span class="p">)</span>
</span><span id="__span-45-40">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-45-41">        <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-45-42">            <span class="s2">&quot;Suspendisse lectus tortor, dignissim sit amet, adipiscing &quot;</span>
</span><span id="__span-45-43">            <span class="s2">&quot;nec, ultricies sed, dolor. Cras elementum ultrices diam. &quot;</span>
</span><span id="__span-45-44">            <span class="s2">&quot;Maecenas ligula massa, varius a, semper congue, euismod non, mi.&quot;</span>
</span><span id="__span-45-45">        <span class="p">)</span>
</span><span id="__span-45-46">    <span class="p">)</span>
</span><span id="__span-45-47">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;part B&quot;</span><span class="p">))</span>
</span><span id="__span-45-48">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-45-49">        <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-45-50">            <span class="s2">&quot;Proin porttitor, orci nec nonummy molestie, enim est eleifend &quot;</span>
</span><span id="__span-45-51">            <span class="s2">&quot;mi, non fermentum diam nisl sit amet erat. Duis semper. &quot;</span>
</span><span id="__span-45-52">            <span class="s2">&quot;Duis arcu massa, scelerisque vitae, consequat in, pretium a, &quot;</span>
</span><span id="__span-45-53">            <span class="s2">&quot;enim. Pellentesque congue. Ut in risus volutpat libero pharetra tempor.&quot;</span>
</span><span id="__span-45-54">        <span class="p">)</span>
</span><span id="__span-45-55">    <span class="p">)</span>
</span><span id="__span-45-56">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-45-57">        <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-45-58">            <span class="s2">&quot;Cras vestibulum bibendum augue. Praesent egestas leo in pede. &quot;</span>
</span><span id="__span-45-59">            <span class="s2">&quot;Praesent blandit odio eu enim. Pellentesque sed dui ut augue &quot;</span>
</span><span id="__span-45-60">            <span class="s2">&quot;blandit sodales. Vestibulum ante ipsum primis in faucibus orci &quot;</span>
</span><span id="__span-45-61">            <span class="s2">&quot;luctus et ultrices posuere cubilia Curae; Aliquam nibh.&quot;</span>
</span><span id="__span-45-62">        <span class="p">)</span>
</span><span id="__span-45-63">    <span class="p">)</span>
</span><span id="__span-45-64">
</span><span id="__span-45-65">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;part C&quot;</span><span class="p">))</span>
</span><span id="__span-45-66">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-45-67">        <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-45-68">            <span class="s2">&quot;Mauris ac mauris sed pede pellentesque fermentum. &quot;</span>
</span><span id="__span-45-69">            <span class="s2">&quot;Maecenas adipiscing ante non diam sodales hendrerit. Ut &quot;</span>
</span><span id="__span-45-70">            <span class="s2">&quot;velit mauris, egestas sed, gravida nec, ornare ut, mi.&quot;</span>
</span><span id="__span-45-71">        <span class="p">)</span>
</span><span id="__span-45-72">    <span class="p">)</span>
</span><span id="__span-45-73">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-45-74">        <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-45-75">            <span class="s2">&quot;Aenean ut orci vel massa suscipit pulvinar. Nulla sollicitudin. &quot;</span>
</span><span id="__span-45-76">            <span class="s2">&quot;Fusce varius, ligula non tempus aliquam, nunc turpis &quot;</span>
</span><span id="__span-45-77">            <span class="s2">&quot;ullamcorper nibh, in tempus sapien eros vitae ligula. &quot;</span>
</span><span id="__span-45-78">            <span class="s2">&quot;Pellentesque rhoncus nunc et augue. Integer id felis. Curabitur &quot;</span>
</span><span id="__span-45-79">            <span class="s2">&quot;aliquet pellentesque diam. Integer quis metus vitae elit &quot;</span>
</span><span id="__span-45-80">            <span class="s2">&quot;lobortis egestas.&quot;</span>
</span><span id="__span-45-81">        <span class="p">)</span>
</span><span id="__span-45-82">    <span class="p">)</span>
</span><span id="__span-45-83">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Header</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;part D&quot;</span><span class="p">))</span>
</span><span id="__span-45-84">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-45-85">        <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-45-86">            <span class="s2">&quot;Morbi vel erat non mauris convallis vehicula. Nulla et sapien. &quot;</span>
</span><span id="__span-45-87">            <span class="s2">&quot;Integer tortor tellus, aliquam faucibus, convallis id, congue &quot;</span>
</span><span id="__span-45-88">            <span class="s2">&quot;eu, quam. Mauris ullamcorper felis vitae erat.&quot;</span>
</span><span id="__span-45-89">            <span class="s2">&quot;Proin feugiat, augue non elementum posuere, metus purus &quot;</span>
</span><span id="__span-45-90">            <span class="s2">&quot;iaculis lectus, et tristique ligula justo vitae magna. Aliquam &quot;</span>
</span><span id="__span-45-91">            <span class="s2">&quot;convallis sollicitudin purus.&quot;</span>
</span><span id="__span-45-92">        <span class="p">)</span>
</span><span id="__span-45-93">    <span class="p">)</span>
</span><span id="__span-45-94">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-45-95">        <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-45-96">            <span class="s2">&quot;Praesent aliquam, enim at fermentum mollis, ligula massa &quot;</span>
</span><span id="__span-45-97">            <span class="s2">&quot;adipiscing nisl, ac euismod nibh nisl eu lectus. Fusce &quot;</span>
</span><span id="__span-45-98">            <span class="s2">&quot;vulputate sem at sapien. Vivamus leo. Aliquam euismod &quot;</span>
</span><span id="__span-45-99">            <span class="s2">&quot;libero eu enim. Nulla nec felis sed leo placerat imperdiet.&quot;</span>
</span><span id="__span-45-100">        <span class="p">)</span>
</span><span id="__span-45-101">    <span class="p">)</span>
</span><span id="__span-45-102">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-45-103">        <span class="n">Paragraph</span><span class="p">(</span>
</span><span id="__span-45-104">            <span class="s2">&quot;Aenean suscipit nulla in justo. Suspendisse cursus rutrum augue. &quot;</span>
</span><span id="__span-45-105">            <span class="s2">&quot;Nulla tincidunt tincidunt mi. Curabitur iaculis, lorem vel &quot;</span>
</span><span id="__span-45-106">            <span class="s2">&quot;rhoncus faucibus, felis magna fermentum augue, et ultricies &quot;</span>
</span><span id="__span-45-107">            <span class="s2">&quot;lacus lorem varius purus. Curabitur eu amet.&quot;</span>
</span><span id="__span-45-108">        <span class="p">)</span>
</span><span id="__span-45-109">    <span class="p">)</span>
</span><span id="__span-45-110">    <span class="k">return</span> <span class="n">document</span>
</span><span id="__span-45-111">
</span><span id="__span-45-112">
</span><span id="__span-45-113"><span class="k">def</span><span class="w"> </span><span class="nf">keep_element</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">KeepingState</span><span class="p">,</span> <span class="n">elem</span><span class="p">:</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-45-114">    <span class="c1"># keep everythin until &quot;part B&quot;</span>
</span><span id="__span-45-115">    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">step</span> <span class="o">==</span> <span class="s2">&quot;before&quot;</span><span class="p">:</span>
</span><span id="__span-45-116">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">Header</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;part B&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span>
</span><span id="__span-45-117">            <span class="n">state</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="s2">&quot;deleting&quot;</span>
</span><span id="__span-45-118">    <span class="c1"># delete everythin until paragraph strating with &quot;Aenean&quot;</span>
</span><span id="__span-45-119">    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">step</span> <span class="o">==</span> <span class="s2">&quot;deleting&quot;</span><span class="p">:</span>
</span><span id="__span-45-120">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">Paragraph</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Aenean&quot;</span><span class="p">):</span>
</span><span id="__span-45-121">            <span class="n">state</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="s2">&quot;after&quot;</span>
</span><span id="__span-45-122">    <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">step</span> <span class="o">!=</span> <span class="s2">&quot;deleting&quot;</span>
</span><span id="__span-45-123">
</span><span id="__span-45-124">
</span><span id="__span-45-125"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-45-126">    <span class="n">document</span> <span class="o">=</span> <span class="n">create_base_document</span><span class="p">()</span>
</span><span id="__span-45-127">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET_INITIAL</span><span class="p">)</span>
</span><span id="__span-45-128">    <span class="c1"># Removing part B and half the part C</span>
</span><span id="__span-45-129">    <span class="n">state</span> <span class="o">=</span> <span class="n">KeepingState</span><span class="p">(</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
</span><span id="__span-45-130">    <span class="n">keep_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-45-131">    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="__span-45-132">        <span class="k">if</span> <span class="n">keep_element</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
</span><span id="__span-45-133">            <span class="n">keep_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
</span><span id="__span-45-134">    <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-45-135">    <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">keep_list</span><span class="p">)</span>
</span><span id="__span-45-136">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET_FINAL</span><span class="p">)</span>
</span><span id="__span-45-137">    <span class="n">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-45-138">
</span><span id="__span-45-139">
</span><span id="__span-45-140"><span class="k">def</span><span class="w"> </span><span class="nf">test_unit</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-45-141">    <span class="c1"># only for test suite:</span>
</span><span id="__span-45-142">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-45-143">        <span class="k">return</span>
</span><span id="__span-45-144">    <span class="n">text0</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraph</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="__span-45-145">    <span class="nb">print</span><span class="p">(</span><span class="n">text0</span><span class="p">)</span>
</span><span id="__span-45-146">    <span class="k">assert</span> <span class="n">text0</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Lorem&quot;</span><span class="p">)</span>
</span><span id="__span-45-147">    <span class="n">text1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">get_paragraph</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
</span><span id="__span-45-148">    <span class="nb">print</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
</span><span id="__span-45-149">    <span class="k">assert</span> <span class="n">text1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Morbi&quot;</span><span class="p">)</span>
</span><span id="__span-45-150">
</span><span id="__span-45-151">
</span><span id="__span-45-152"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-45-153">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="create-color-chart-in-spreadsheet">Create color chart in spreadsheet</h3>
<p>Create some color chart in a spreadsheet using cells styles.
(adapted from the odfdo library test cases)</p>
<details class="code">
<summary>recipes/create_color_chart_in_spreadsheet.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-46-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-46-2"><span class="sd">&quot;&quot;&quot;Create some color chart in a spreadsheet using cells styles.</span>
</span><span id="__span-46-3"><span class="sd">(adapted from the odfdo library test cases)</span>
</span><span id="__span-46-4"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-46-5">
</span><span id="__span-46-6"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-46-7">
</span><span id="__span-46-8"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-46-9">    <span class="n">Cell</span><span class="p">,</span>
</span><span id="__span-46-10">    <span class="n">Document</span><span class="p">,</span>
</span><span id="__span-46-11">    <span class="n">Row</span><span class="p">,</span>
</span><span id="__span-46-12">    <span class="n">Style</span><span class="p">,</span>
</span><span id="__span-46-13">    <span class="n">Table</span><span class="p">,</span>
</span><span id="__span-46-14">    <span class="n">__version__</span><span class="p">,</span>
</span><span id="__span-46-15">    <span class="n">create_table_cell_style</span><span class="p">,</span>
</span><span id="__span-46-16">    <span class="n">make_table_cell_border_string</span><span class="p">,</span>
</span><span id="__span-46-17">    <span class="n">rgb2hex</span><span class="p">,</span>
</span><span id="__span-46-18"><span class="p">)</span>
</span><span id="__span-46-19">
</span><span id="__span-46-20"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">420</span>
</span><span id="__span-46-21"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;chart&quot;</span>
</span><span id="__span-46-22"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;color_chart.ods&quot;</span>
</span><span id="__span-46-23">
</span><span id="__span-46-24">
</span><span id="__span-46-25"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-46-26">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-46-27">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-46-28">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-46-29">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-46-30">
</span><span id="__span-46-31">
</span><span id="__span-46-32"><span class="k">def</span><span class="w"> </span><span class="nf">hello_messages</span><span class="p">():</span>
</span><span id="__span-46-33">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;odfdo installation test&quot;</span><span class="p">)</span>
</span><span id="__span-46-34">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Version           : </span><span class="si">{</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-46-35">    <span class="nb">print</span><span class="p">()</span>
</span><span id="__span-46-36">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating color chart in </span><span class="si">{</span><span class="n">TARGET</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-46-37">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
</span><span id="__span-46-38">
</span><span id="__span-46-39">
</span><span id="__span-46-40"><span class="k">def</span><span class="w"> </span><span class="nf">generate_chart</span><span class="p">():</span>
</span><span id="__span-46-41">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;spreadsheet&quot;</span><span class="p">)</span>
</span><span id="__span-46-42">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-46-43">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-46-44">    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;chart&quot;</span><span class="p">)</span>
</span><span id="__span-46-45">
</span><span id="__span-46-46">    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
</span><span id="__span-46-47">        <span class="n">row</span> <span class="o">=</span> <span class="n">Row</span><span class="p">()</span>
</span><span id="__span-46-48">        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">32</span><span class="p">):</span>
</span><span id="__span-46-49">            <span class="n">cell_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">%</span> <span class="mi">256</span><span class="p">)</span>
</span><span id="__span-46-50">            <span class="n">border_rl</span> <span class="o">=</span> <span class="n">make_table_cell_border_string</span><span class="p">(</span><span class="n">thick</span><span class="o">=</span><span class="s2">&quot;0.20cm&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
</span><span id="__span-46-51">            <span class="n">border_bt</span> <span class="o">=</span> <span class="n">make_table_cell_border_string</span><span class="p">(</span>
</span><span id="__span-46-52">                <span class="n">thick</span><span class="o">=</span><span class="s2">&quot;0.80cm&quot;</span><span class="p">,</span>
</span><span id="__span-46-53">                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span id="__span-46-54">            <span class="p">)</span>
</span><span id="__span-46-55">            <span class="n">style</span> <span class="o">=</span> <span class="n">create_table_cell_style</span><span class="p">(</span>
</span><span id="__span-46-56">                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span>
</span><span id="__span-46-57">                <span class="n">background_color</span><span class="o">=</span><span class="n">cell_value</span><span class="p">,</span>
</span><span id="__span-46-58">                <span class="n">border_right</span><span class="o">=</span><span class="n">border_rl</span><span class="p">,</span>
</span><span id="__span-46-59">                <span class="n">border_left</span><span class="o">=</span><span class="n">border_rl</span><span class="p">,</span>
</span><span id="__span-46-60">                <span class="n">border_bottom</span><span class="o">=</span><span class="n">border_bt</span><span class="p">,</span>
</span><span id="__span-46-61">                <span class="n">border_top</span><span class="o">=</span><span class="n">border_bt</span><span class="p">,</span>
</span><span id="__span-46-62">            <span class="p">)</span>
</span><span id="__span-46-63">            <span class="n">name</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="n">automatic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-46-64">            <span class="n">cell</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">rgb2hex</span><span class="p">(</span><span class="n">cell_value</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-46-65">            <span class="n">row</span><span class="o">.</span><span class="n">append_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
</span><span id="__span-46-66">        <span class="n">table</span><span class="o">.</span><span class="n">append_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="__span-46-67">
</span><span id="__span-46-68">        <span class="n">row_style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span><span class="s2">&quot;table-row&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;1.80cm&quot;</span><span class="p">)</span>
</span><span id="__span-46-69">        <span class="n">name_style_row</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">row_style</span><span class="p">,</span> <span class="n">automatic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-46-70">        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
</span><span id="__span-46-71">            <span class="n">row</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">name_style_row</span>
</span><span id="__span-46-72">            <span class="n">table</span><span class="o">.</span><span class="n">set_row</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</span><span id="__span-46-73">
</span><span id="__span-46-74">        <span class="n">col_style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span><span class="s2">&quot;table-column&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;3.6cm&quot;</span><span class="p">)</span>
</span><span id="__span-46-75">        <span class="n">name</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">insert_style</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">col_style</span><span class="p">,</span> <span class="n">automatic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-46-76">        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="__span-46-77">            <span class="n">column</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">col_style</span>
</span><span id="__span-46-78">            <span class="n">table</span><span class="o">.</span><span class="n">set_column</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
</span><span id="__span-46-79">
</span><span id="__span-46-80">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="__span-46-81">
</span><span id="__span-46-82">    <span class="k">return</span> <span class="n">document</span>
</span><span id="__span-46-83">
</span><span id="__span-46-84">
</span><span id="__span-46-85"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-46-86">    <span class="n">hello_messages</span><span class="p">()</span>
</span><span id="__span-46-87">    <span class="n">document</span> <span class="o">=</span> <span class="n">generate_chart</span><span class="p">()</span>
</span><span id="__span-46-88">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-46-89">
</span><span id="__span-46-90">
</span><span id="__span-46-91"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-46-92">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="get-cell-background-color">Get cell background color</h3>
<p>Read the background color of a table cell.</p>
<details class="code">
<summary>recipes/get_cell_background_color.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-47-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-47-2"><span class="sd">&quot;&quot;&quot;Read the background color of a table cell.</span>
</span><span id="__span-47-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-47-4"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-47-5"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-47-6"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-47-7">
</span><span id="__span-47-8"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-47-9">
</span><span id="__span-47-10"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">440</span>
</span><span id="__span-47-11"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-47-12"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;cell_color.ods&quot;</span>
</span><span id="__span-47-13">
</span><span id="__span-47-14">
</span><span id="__span-47-15"><span class="k">def</span><span class="w"> </span><span class="nf">read_source_document</span><span class="p">():</span>
</span><span id="__span-47-16">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-47-17">        <span class="n">source</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-47-18">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="__span-47-19">        <span class="n">source</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span>
</span><span id="__span-47-20">    <span class="k">return</span> <span class="n">Document</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span id="__span-47-21">
</span><span id="__span-47-22">
</span><span id="__span-47-23"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-47-24">    <span class="n">doc</span> <span class="o">=</span> <span class="n">read_source_document</span><span class="p">()</span>
</span><span id="__span-47-25">
</span><span id="__span-47-26">    <span class="c1"># reading color from the table 0 (first sheet)</span>
</span><span id="__span-47-27">    <span class="n">color_b2</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get_cell_background_color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;b2&quot;</span><span class="p">)</span>
</span><span id="__span-47-28">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Color for B2&quot;</span><span class="p">,</span> <span class="n">color_b2</span><span class="p">)</span>
</span><span id="__span-47-29">
</span><span id="__span-47-30">    <span class="n">color_b3</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get_cell_background_color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;b3&quot;</span><span class="p">)</span>
</span><span id="__span-47-31">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Color for B3&quot;</span><span class="p">,</span> <span class="n">color_b3</span><span class="p">)</span>
</span><span id="__span-47-32">
</span><span id="__span-47-33">    <span class="n">color_c3</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get_cell_background_color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;c3&quot;</span><span class="p">)</span>
</span><span id="__span-47-34">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Color for C3&quot;</span><span class="p">,</span> <span class="n">color_c3</span><span class="p">)</span>
</span><span id="__span-47-35">
</span><span id="__span-47-36">    <span class="c1"># default is &quot;#ffffff&quot;</span>
</span><span id="__span-47-37">    <span class="n">color_d3</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get_cell_background_color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;d3&quot;</span><span class="p">)</span>
</span><span id="__span-47-38">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Color for D3&quot;</span><span class="p">,</span> <span class="n">color_d3</span><span class="p">)</span>
</span><span id="__span-47-39">
</span><span id="__span-47-40">    <span class="c1"># set another default</span>
</span><span id="__span-47-41">    <span class="n">color_e3</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get_cell_background_color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;e3&quot;</span><span class="p">,</span> <span class="s2">&quot;#123456&quot;</span><span class="p">)</span>
</span><span id="__span-47-42">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Color for e3&quot;</span><span class="p">,</span> <span class="n">color_e3</span><span class="p">)</span>
</span><span id="__span-47-43">
</span><span id="__span-47-44">    <span class="c1"># read very far cell</span>
</span><span id="__span-47-45">    <span class="n">color_far</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get_cell_background_color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">))</span>
</span><span id="__span-47-46">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Color for far&quot;</span><span class="p">,</span> <span class="n">color_far</span><span class="p">)</span>
</span><span id="__span-47-47">
</span><span id="__span-47-48">    <span class="c1"># only for test suite:</span>
</span><span id="__span-47-49">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-47-50">        <span class="k">return</span>
</span><span id="__span-47-51">    <span class="k">assert</span> <span class="n">color_b2</span> <span class="o">==</span> <span class="s2">&quot;#2a6099&quot;</span>
</span><span id="__span-47-52">    <span class="k">assert</span> <span class="n">color_b3</span> <span class="o">==</span> <span class="s2">&quot;#ff4000&quot;</span>
</span><span id="__span-47-53">    <span class="k">assert</span> <span class="n">color_c3</span> <span class="o">==</span> <span class="s2">&quot;#ffff00&quot;</span>
</span><span id="__span-47-54">    <span class="k">assert</span> <span class="n">color_d3</span> <span class="o">==</span> <span class="s2">&quot;#ffffff&quot;</span>
</span><span id="__span-47-55">    <span class="k">assert</span> <span class="n">color_e3</span> <span class="o">==</span> <span class="s2">&quot;#123456&quot;</span>
</span><span id="__span-47-56">    <span class="k">assert</span> <span class="n">color_far</span> <span class="o">==</span> <span class="s2">&quot;#ffffff&quot;</span>
</span><span id="__span-47-57">
</span><span id="__span-47-58">
</span><span id="__span-47-59"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-47-60">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="extract-a-sub-table-from-some-big-table">Extract a sub table from some big table</h3>
<p>Create a table of 1000 lines and 100 columns, extract a sub table
of 100 lines 26 columns, save the result in a spreadsheet document.</p>
<details class="code">
<summary>recipes/extract_a_sub_table_from_some_big_table.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-48-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-48-2"><span class="sd">&quot;&quot;&quot;Create a table of 1000 lines and 100 columns, extract a sub table</span>
</span><span id="__span-48-3"><span class="sd">of 100 lines 26 columns, save the result in a spreadsheet document.</span>
</span><span id="__span-48-4"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-48-5"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-48-6"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-48-7">
</span><span id="__span-48-8"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Row</span><span class="p">,</span> <span class="n">Table</span>
</span><span id="__span-48-9">
</span><span id="__span-48-10"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">450</span>
</span><span id="__span-48-11"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;extract_table&quot;</span>
</span><span id="__span-48-12"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.ods&quot;</span>
</span><span id="__span-48-13">
</span><span id="__span-48-14">
</span><span id="__span-48-15"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-48-16">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-48-17">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-48-18">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-48-19">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-48-20">
</span><span id="__span-48-21">
</span><span id="__span-48-22"><span class="k">def</span><span class="w"> </span><span class="nf">syracuse</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-48-23">    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-48-24">        <span class="k">return</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="__span-48-25">    <span class="k">return</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-48-26">
</span><span id="__span-48-27">
</span><span id="__span-48-28"><span class="k">def</span><span class="w"> </span><span class="nf">generate_big_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Document</span><span class="p">:</span>
</span><span id="__span-48-29">    <span class="n">spreadsheet</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;spreadsheet&quot;</span><span class="p">)</span>
</span><span id="__span-48-30">    <span class="n">body</span> <span class="o">=</span> <span class="n">spreadsheet</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-48-31">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-48-32">    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
</span><span id="__span-48-33">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="__span-48-34">
</span><span id="__span-48-35">    <span class="n">lines</span> <span class="o">=</span> <span class="mi">1000</span>
</span><span id="__span-48-36">    <span class="n">cols</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="__span-48-37">
</span><span id="__span-48-38">    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span><span id="__span-48-39">        <span class="n">row</span> <span class="o">=</span> <span class="n">Row</span><span class="p">()</span>
</span><span id="__span-48-40">        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-48-41">        <span class="n">n</span> <span class="o">=</span> <span class="n">line</span>
</span><span id="__span-48-42">        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
</span><span id="__span-48-43">            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="__span-48-44">            <span class="n">n</span> <span class="o">=</span> <span class="n">syracuse</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="__span-48-45">        <span class="n">row</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="__span-48-46">        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="__span-48-47">
</span><span id="__span-48-48">    <span class="k">return</span> <span class="n">spreadsheet</span>
</span><span id="__span-48-49">
</span><span id="__span-48-50">
</span><span id="__span-48-51"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-48-52">    <span class="n">table_name</span> <span class="o">=</span> <span class="s2">&quot;Big Table&quot;</span>
</span><span id="__span-48-53">    <span class="n">spreadsheet</span> <span class="o">=</span> <span class="n">generate_big_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
</span><span id="__span-48-54">    <span class="n">body</span> <span class="o">=</span> <span class="n">spreadsheet</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-48-55">    <span class="n">big_table</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">table_name</span><span class="p">)</span>
</span><span id="__span-48-56">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size of Big Table :&quot;</span><span class="p">,</span> <span class="n">big_table</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="__span-48-57">
</span><span id="__span-48-58">    <span class="c1"># now extract 100 rows of 26 columns :</span>
</span><span id="__span-48-59">    <span class="n">table1</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;Extract 1&quot;</span><span class="p">)</span>
</span><span id="__span-48-60">    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">900</span><span class="p">):</span>
</span><span id="__span-48-61">        <span class="n">row</span> <span class="o">=</span> <span class="n">big_table</span><span class="o">.</span><span class="n">get_row</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="__span-48-62">        <span class="n">extracted_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">76</span><span class="p">)]</span>
</span><span id="__span-48-63">        <span class="n">new_row</span> <span class="o">=</span> <span class="n">Row</span><span class="p">()</span>
</span><span id="__span-48-64">        <span class="n">new_row</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">extracted_values</span><span class="p">)</span>
</span><span id="__span-48-65">        <span class="n">table1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
</span><span id="__span-48-66">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table1</span><span class="p">)</span>
</span><span id="__span-48-67">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size of extracted table 1 :&quot;</span><span class="p">,</span> <span class="n">table1</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="__span-48-68">
</span><span id="__span-48-69">    <span class="c1"># other method</span>
</span><span id="__span-48-70">    <span class="n">table2</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;Extract 2&quot;</span><span class="p">)</span>
</span><span id="__span-48-71">    <span class="n">cells</span> <span class="o">=</span> <span class="n">big_table</span><span class="o">.</span><span class="n">get_cells</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">899</span><span class="p">))</span>
</span><span id="__span-48-72">    <span class="n">table2</span><span class="o">.</span><span class="n">set_cells</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cells</span><span class="o">=</span><span class="n">cells</span><span class="p">)</span>
</span><span id="__span-48-73">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table2</span><span class="p">)</span>
</span><span id="__span-48-74">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size of extracted table 2 :&quot;</span><span class="p">,</span> <span class="n">table2</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="__span-48-75">
</span><span id="__span-48-76">    <span class="n">test_unit</span><span class="p">(</span><span class="n">spreadsheet</span><span class="p">)</span>
</span><span id="__span-48-77">
</span><span id="__span-48-78">    <span class="n">save_new</span><span class="p">(</span><span class="n">spreadsheet</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-48-79">
</span><span id="__span-48-80">    <span class="n">_expected_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-48-81"><span class="s2">Size of Big Table : (100, 1000)</span>
</span><span id="__span-48-82"><span class="s2">Size of extracted table 1 : (26, 100)</span>
</span><span id="__span-48-83"><span class="s2">Size of extracted table 2 : (26, 100)</span>
</span><span id="__span-48-84"><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-48-85">
</span><span id="__span-48-86">
</span><span id="__span-48-87"><span class="k">def</span><span class="w"> </span><span class="nf">test_unit</span><span class="p">(</span><span class="n">spreadsheet</span><span class="p">:</span> <span class="n">Document</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-48-88">    <span class="c1"># only for test suite:</span>
</span><span id="__span-48-89">    <span class="k">if</span> <span class="s2">&quot;ODFDO_TESTING&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
</span><span id="__span-48-90">        <span class="k">return</span>
</span><span id="__span-48-91">    <span class="n">body</span> <span class="o">=</span> <span class="n">spreadsheet</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-48-92">    <span class="n">table1</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-48-93">    <span class="k">assert</span> <span class="n">table1</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</span><span id="__span-48-94">    <span class="n">table2</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-48-95">    <span class="k">assert</span> <span class="n">table2</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="__span-48-96">
</span><span id="__span-48-97">
</span><span id="__span-48-98"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-48-99">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="make-a-basic-spreadsheet">Make a basic spreadsheet</h3>
<p>Create a spreadsheet with one table and a few data, strip the table
and compute the table size.</p>
<details class="code">
<summary>recipes/make_a_basic_spreadsheet.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-49-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-49-2"><span class="sd">&quot;&quot;&quot;Create a spreadsheet with one table and a few data, strip the table</span>
</span><span id="__span-49-3"><span class="sd">and compute the table size.</span>
</span><span id="__span-49-4"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-49-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-49-6">
</span><span id="__span-49-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Table</span>
</span><span id="__span-49-8">
</span><span id="__span-49-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">460</span>
</span><span id="__span-49-10"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;basic_ods&quot;</span>
</span><span id="__span-49-11"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;spreadsheet.ods&quot;</span>
</span><span id="__span-49-12">
</span><span id="__span-49-13">
</span><span id="__span-49-14"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-49-15">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-49-16">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-49-17">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-49-18">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-49-19">
</span><span id="__span-49-20">
</span><span id="__span-49-21"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-49-22">    <span class="n">document</span> <span class="o">=</span> <span class="n">generate_document</span><span class="p">()</span>
</span><span id="__span-49-23">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-49-24">
</span><span id="__span-49-25">
</span><span id="__span-49-26"><span class="k">def</span><span class="w"> </span><span class="nf">generate_document</span><span class="p">():</span>
</span><span id="__span-49-27">    <span class="c1"># creating an empty spreadsheet document:</span>
</span><span id="__span-49-28">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;spreadsheet&quot;</span><span class="p">)</span>
</span><span id="__span-49-29">
</span><span id="__span-49-30">    <span class="c1"># Each sheet of a spreadsheet is a table:</span>
</span><span id="__span-49-31">    <span class="c1"># setting drom the beginning width (columns) and height (rows)</span>
</span><span id="__span-49-32">    <span class="c1"># is not mandatory, but a good practice, since odfdo don&#39;t check</span>
</span><span id="__span-49-33">    <span class="c1"># actual existence of cells</span>
</span><span id="__span-49-34">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-49-35">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-49-36">    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;First Table&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-49-37">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="__span-49-38">
</span><span id="__span-49-39">    <span class="c1"># A table contains rows, we can append some more.</span>
</span><span id="__span-49-40">    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-49-41">        <span class="n">table</span><span class="o">.</span><span class="n">append_row</span><span class="p">()</span>
</span><span id="__span-49-42">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rows in the table (3+2):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
</span><span id="__span-49-43">
</span><span id="__span-49-44">    <span class="c1">#  A row contains cells</span>
</span><span id="__span-49-45">    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
</span><span id="__span-49-46">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;row, nb of cells &quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">cells</span><span class="p">))</span>
</span><span id="__span-49-47">
</span><span id="__span-49-48">    <span class="n">last_row</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_row</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-49-49">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nb of cells of the last row:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">last_row</span><span class="o">.</span><span class="n">cells</span><span class="p">))</span>
</span><span id="__span-49-50">
</span><span id="__span-49-51">    <span class="c1"># cell can have different kind of values</span>
</span><span id="__span-49-52">    <span class="k">for</span> <span class="n">row_nb</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="__span-49-53">        <span class="k">for</span> <span class="n">col_nb</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="__span-49-54">            <span class="n">table</span><span class="o">.</span><span class="n">set_value</span><span class="p">((</span><span class="n">col_nb</span><span class="p">,</span> <span class="n">row_nb</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;cell </span><span class="si">{</span><span class="n">col_nb</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">row_nb</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-49-55">    <span class="k">for</span> <span class="n">row_nb</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
</span><span id="__span-49-56">        <span class="k">for</span> <span class="n">col_nb</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="__span-49-57">            <span class="n">table</span><span class="o">.</span><span class="n">set_value</span><span class="p">((</span><span class="n">col_nb</span><span class="p">,</span> <span class="n">row_nb</span><span class="p">),</span> <span class="n">col_nb</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">row_nb</span><span class="p">)</span>
</span><span id="__span-49-58">
</span><span id="__span-49-59">    <span class="c1"># Before saving the document,  we can strip the unused colums:</span>
</span><span id="__span-49-60">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;table size:&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="__span-49-61">    <span class="n">table</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span><span id="__span-49-62">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;table size after strip:&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="__span-49-63">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nb of cells of the last row:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">get_row</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cells</span><span class="p">))</span>
</span><span id="__span-49-64">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Content of the table:&quot;</span><span class="p">)</span>
</span><span id="__span-49-65">    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">())</span>
</span><span id="__span-49-66">
</span><span id="__span-49-67">    <span class="k">return</span> <span class="n">document</span>
</span><span id="__span-49-68">
</span><span id="__span-49-69">
</span><span id="__span-49-70"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-49-71">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="make-spreadsheet-with-named-ranges">Make spreadsheet with named ranges</h3>
<p>Create a spreadsheet with two tables, using some named ranges.</p>
<details class="code">
<summary>recipes/make_spreadsheet_with_named_ranges.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-50-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-50-2"><span class="sd">&quot;&quot;&quot;Create a spreadsheet with two tables, using some named ranges.</span>
</span><span id="__span-50-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-50-4"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-50-5">
</span><span id="__span-50-6"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Table</span>
</span><span id="__span-50-7">
</span><span id="__span-50-8"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">470</span>
</span><span id="__span-50-9"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;named_range&quot;</span>
</span><span id="__span-50-10"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;spreadsheet.ods&quot;</span>
</span><span id="__span-50-11">
</span><span id="__span-50-12">
</span><span id="__span-50-13"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-50-14">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-50-15">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-50-16">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-50-17">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-50-18">
</span><span id="__span-50-19">
</span><span id="__span-50-20"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-50-21">    <span class="n">document</span> <span class="o">=</span> <span class="n">generate_document</span><span class="p">()</span>
</span><span id="__span-50-22">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-50-23">
</span><span id="__span-50-24">
</span><span id="__span-50-25"><span class="k">def</span><span class="w"> </span><span class="nf">generate_document</span><span class="p">():</span>
</span><span id="__span-50-26">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;spreadsheet&quot;</span><span class="p">)</span>
</span><span id="__span-50-27">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-50-28">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-50-29">    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;First Table&quot;</span><span class="p">)</span>
</span><span id="__span-50-30">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="__span-50-31">    <span class="c1"># populate the table :</span>
</span><span id="__span-50-32">    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="__span-50-33">        <span class="n">table</span><span class="o">.</span><span class="n">set_value</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-50-34">    <span class="n">table</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;A11&quot;</span><span class="p">,</span> <span class="s2">&quot;Total:&quot;</span><span class="p">)</span>
</span><span id="__span-50-35">
</span><span id="__span-50-36">    <span class="c1"># lets define a named range for the 10 values :</span>
</span><span id="__span-50-37">    <span class="n">range_squares</span> <span class="o">=</span> <span class="s2">&quot;B1:B10&quot;</span>
</span><span id="__span-50-38">    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;squares_values&quot;</span>
</span><span id="__span-50-39">    <span class="n">table_name</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-50-40">    <span class="n">table</span><span class="o">.</span><span class="n">set_named_range</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">range_squares</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
</span><span id="__span-50-41">
</span><span id="__span-50-42">    <span class="c1"># we can define a single cell range, using notation &quot;B11&quot; or (1, 10) :</span>
</span><span id="__span-50-43">    <span class="n">table</span><span class="o">.</span><span class="n">set_named_range</span><span class="p">(</span><span class="s2">&quot;total&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">table_name</span><span class="p">)</span>
</span><span id="__span-50-44">
</span><span id="__span-50-45">    <span class="c1"># get named range values :</span>
</span><span id="__span-50-46">    <span class="n">values</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_named_range</span><span class="p">(</span><span class="s2">&quot;squares_values&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-50-47">
</span><span id="__span-50-48">    <span class="c1"># set named range value :</span>
</span><span id="__span-50-49">    <span class="n">result</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="__span-50-50">    <span class="n">table</span><span class="o">.</span><span class="n">get_named_range</span><span class="p">(</span><span class="s2">&quot;total&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="__span-50-51">
</span><span id="__span-50-52">    <span class="c1"># lets use the named ranges from a second table :</span>
</span><span id="__span-50-53">    <span class="n">table2</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;Second Table&quot;</span><span class="p">)</span>
</span><span id="__span-50-54">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table2</span><span class="p">)</span>
</span><span id="__span-50-55">
</span><span id="__span-50-56">    <span class="n">named_range1</span> <span class="o">=</span> <span class="n">table2</span><span class="o">.</span><span class="n">get_named_range</span><span class="p">(</span><span class="s2">&quot;total&quot;</span><span class="p">)</span>
</span><span id="__span-50-57">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="s2">&quot;name:&quot;</span><span class="p">)</span>
</span><span id="__span-50-58">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;B1&quot;</span><span class="p">,</span> <span class="n">named_range1</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-50-59">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;A2&quot;</span><span class="p">,</span> <span class="s2">&quot;range:&quot;</span><span class="p">)</span>
</span><span id="__span-50-60">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;B2&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">named_range1</span><span class="o">.</span><span class="n">crange</span><span class="p">))</span>
</span><span id="__span-50-61">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;A3&quot;</span><span class="p">,</span> <span class="s2">&quot;from table:&quot;</span><span class="p">)</span>
</span><span id="__span-50-62">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;B3&quot;</span><span class="p">,</span> <span class="n">named_range1</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
</span><span id="__span-50-63">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;A4&quot;</span><span class="p">,</span> <span class="s2">&quot;content:&quot;</span><span class="p">)</span>
</span><span id="__span-50-64">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;B4&quot;</span><span class="p">,</span> <span class="n">named_range1</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span>
</span><span id="__span-50-65">
</span><span id="__span-50-66">    <span class="n">named_range2</span> <span class="o">=</span> <span class="n">table2</span><span class="o">.</span><span class="n">get_named_range</span><span class="p">(</span><span class="s2">&quot;squares_values&quot;</span><span class="p">)</span>
</span><span id="__span-50-67">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;D1&quot;</span><span class="p">,</span> <span class="s2">&quot;name:&quot;</span><span class="p">)</span>
</span><span id="__span-50-68">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;E1&quot;</span><span class="p">,</span> <span class="n">named_range2</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-50-69">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;D2&quot;</span><span class="p">,</span> <span class="s2">&quot;range:&quot;</span><span class="p">)</span>
</span><span id="__span-50-70">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;E2&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">named_range2</span><span class="o">.</span><span class="n">crange</span><span class="p">))</span>
</span><span id="__span-50-71">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;D3&quot;</span><span class="p">,</span> <span class="s2">&quot;from table:&quot;</span><span class="p">)</span>
</span><span id="__span-50-72">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;E3&quot;</span><span class="p">,</span> <span class="n">named_range2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
</span><span id="__span-50-73">    <span class="n">table2</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;D4&quot;</span><span class="p">,</span> <span class="s2">&quot;content:&quot;</span><span class="p">)</span>
</span><span id="__span-50-74">    <span class="c1"># using &quot;E4:4&quot; notaion is a little hack for the area starting at E4 on row 4</span>
</span><span id="__span-50-75">    <span class="n">table2</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">named_range2</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span> <span class="n">coord</span><span class="o">=</span><span class="s2">&quot;E4:4&quot;</span><span class="p">)</span>
</span><span id="__span-50-76">
</span><span id="__span-50-77">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Content of the table1:&quot;</span><span class="p">)</span>
</span><span id="__span-50-78">    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-50-79">    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">())</span>
</span><span id="__span-50-80">    <span class="nb">print</span><span class="p">(</span><span class="n">table2</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-50-81">    <span class="nb">print</span><span class="p">(</span><span class="n">table2</span><span class="o">.</span><span class="n">to_csv</span><span class="p">())</span>
</span><span id="__span-50-82">
</span><span id="__span-50-83">    <span class="c1"># of course named ranges are stored in the document :</span>
</span><span id="__span-50-84">    <span class="k">return</span> <span class="n">document</span>
</span><span id="__span-50-85">
</span><span id="__span-50-86">
</span><span id="__span-50-87"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-50-88">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="introspecting-elements">Introspecting elements</h3>
<p>Demo of quick introspecting of a document&rsquo;s elements.</p>
<details class="code">
<summary>recipes/introspecting_elements.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-51-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-51-2"><span class="sd">&quot;&quot;&quot;Demo of quick introspecting of a document&#39;s elements.</span>
</span><span id="__span-51-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-51-4"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-51-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-51-6">
</span><span id="__span-51-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-51-8">
</span><span id="__span-51-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">480</span>
</span><span id="__span-51-10"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-51-11"><span class="c1"># ODF export of Wikipedia article Hitchhiker&#39;s Guide to the Galaxy (CC-By-SA) :</span>
</span><span id="__span-51-12"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;collection2.odt&quot;</span>
</span><span id="__span-51-13">
</span><span id="__span-51-14">
</span><span id="__span-51-15"><span class="k">def</span><span class="w"> </span><span class="nf">read_source_document</span><span class="p">():</span>
</span><span id="__span-51-16">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-51-17">        <span class="n">source</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-51-18">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="__span-51-19">        <span class="n">source</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span>
</span><span id="__span-51-20">    <span class="k">return</span> <span class="n">Document</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span id="__span-51-21">
</span><span id="__span-51-22">
</span><span id="__span-51-23"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-51-24">    <span class="n">document</span> <span class="o">=</span> <span class="n">read_source_document</span><span class="p">()</span>
</span><span id="__span-51-25">
</span><span id="__span-51-26">    <span class="c1"># The body object is an XML element from which we can access one or several</span>
</span><span id="__span-51-27">    <span class="c1"># other elements we are looking for.</span>
</span><span id="__span-51-28">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-51-29">
</span><span id="__span-51-30">    <span class="c1"># Should you be lost, remember elements are part of an XML tree:</span>
</span><span id="__span-51-31">    <span class="n">para</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get_paragraph</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-51-32">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Children of the praragraph:</span><span class="se">\n</span><span class="s2">   &quot;</span><span class="p">,</span> <span class="n">para</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
</span><span id="__span-51-33">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Parent of the paragraph:</span><span class="se">\n</span><span class="s2">   &quot;</span><span class="p">,</span> <span class="n">para</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
</span><span id="__span-51-34">
</span><span id="__span-51-35">    <span class="c1"># And you can introspect any element as serialized XML:</span>
</span><span id="__span-51-36">    <span class="n">link0</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get_link</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-51-37">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Content of the serialization link:&quot;</span><span class="p">)</span>
</span><span id="__span-51-38">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   &quot;</span><span class="p">,</span> <span class="n">link0</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span>
</span><span id="__span-51-39">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Which is different from the text content of the link:&quot;</span><span class="p">)</span>
</span><span id="__span-51-40">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   &quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">link0</span><span class="p">))</span>
</span><span id="__span-51-41">
</span><span id="__span-51-42">
</span><span id="__span-51-43"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-51-44">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="show-meta-data">Show meta data</h3>
<p>Print the metadata informations of a ODF file.</p>
<details class="code">
<summary>recipes/show_meta_data.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-52-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-52-2"><span class="sd">&quot;&quot;&quot;Print the metadata informations of a ODF file.</span>
</span><span id="__span-52-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-52-4"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-52-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-52-6">
</span><span id="__span-52-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-52-8">
</span><span id="__span-52-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">490</span>
</span><span id="__span-52-10"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-52-11"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;collection2.odt&quot;</span>
</span><span id="__span-52-12">
</span><span id="__span-52-13">
</span><span id="__span-52-14"><span class="k">def</span><span class="w"> </span><span class="nf">read_source_document</span><span class="p">():</span>
</span><span id="__span-52-15">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-52-16">        <span class="n">source</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-52-17">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="__span-52-18">        <span class="n">source</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span>
</span><span id="__span-52-19">    <span class="k">return</span> <span class="n">Document</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span id="__span-52-20">
</span><span id="__span-52-21">
</span><span id="__span-52-22"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-52-23">    <span class="n">document</span> <span class="o">=</span> <span class="n">read_source_document</span><span class="p">()</span>
</span><span id="__span-52-24">
</span><span id="__span-52-25">    <span class="c1"># Metadata are accessible through the meta part:</span>
</span><span id="__span-52-26">    <span class="c1"># meta = document.get_part(&quot;meta.xml&quot;)</span>
</span><span id="__span-52-27">    <span class="c1"># or the shortcut:</span>
</span><span id="__span-52-28">    <span class="n">meta</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">meta</span>
</span><span id="__span-52-29">
</span><span id="__span-52-30">    <span class="c1"># You then get access to various getters and setters. The getters return</span>
</span><span id="__span-52-31">    <span class="c1"># Python types and the respective setters take the same Python type as</span>
</span><span id="__span-52-32">    <span class="c1"># a parameter.</span>
</span><span id="__span-52-33">    <span class="c1">#</span>
</span><span id="__span-52-34">    <span class="c1"># Here are the output of the get_xxx methods for metadata.</span>
</span><span id="__span-52-35">    <span class="c1"># (Notice that odfdo doesn&#39;t increment editing cycles nor statistics</span>
</span><span id="__span-52-36">    <span class="c1"># when saving the document.</span>
</span><span id="__span-52-37">    <span class="c1"># For the metadata using dates or durations, lpOD provides datatypes that</span>
</span><span id="__span-52-38">    <span class="c1"># decode from and serialize back to strings.</span>
</span><span id="__span-52-39">    <span class="c1"># Strings are always decoded as unicode, numeric values are always decoded</span>
</span><span id="__span-52-40">    <span class="c1"># as Decimal (as they offer the best precision).</span>
</span><span id="__span-52-41">
</span><span id="__span-52-42">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Meta data of </span><span class="si">{</span><span class="n">document</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-52-43">    <span class="c1"># print(&quot;Title                :&quot;, meta.get_title())</span>
</span><span id="__span-52-44">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Title                :&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
</span><span id="__span-52-45">    <span class="c1"># print(&quot;creator              :&quot;, meta.get_creator())</span>
</span><span id="__span-52-46">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;creator              :&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">creator</span><span class="p">)</span>
</span><span id="__span-52-47">    <span class="c1"># print(&quot;creation date        :&quot;, meta.get_creation_date())</span>
</span><span id="__span-52-48">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;creation date        :&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">creation_date</span><span class="p">)</span>
</span><span id="__span-52-49">    <span class="c1"># print(&quot;modification date    :&quot;, meta.get_modification_date())</span>
</span><span id="__span-52-50">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;modification date    :&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
</span><span id="__span-52-51">    <span class="c1"># print(&quot;initial creator      :&quot;, meta.get_initial_creator())</span>
</span><span id="__span-52-52">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;initial creator      :&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">initial_creator</span><span class="p">)</span>
</span><span id="__span-52-53">    <span class="c1"># print(&quot;subject              :&quot;, meta.get_subject())</span>
</span><span id="__span-52-54">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;subject              :&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span>
</span><span id="__span-52-55">    <span class="c1"># print(&quot;description          :&quot;, meta.get_description())</span>
</span><span id="__span-52-56">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;description          :&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
</span><span id="__span-52-57">    <span class="c1"># print(&quot;editing cycles       :&quot;, meta.get_editing_cycles())</span>
</span><span id="__span-52-58">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;editing cycles       :&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">editing_cycles</span><span class="p">)</span>
</span><span id="__span-52-59">    <span class="c1"># print(&quot;editing duration     :&quot;, meta.get_editing_duration())</span>
</span><span id="__span-52-60">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;editing duration     :&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">editing_duration</span><span class="p">)</span>
</span><span id="__span-52-61">    <span class="c1"># print(&quot;generator            :&quot;, meta.get_generator())</span>
</span><span id="__span-52-62">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;generator            :&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">generator</span><span class="p">)</span>
</span><span id="__span-52-63">    <span class="c1"># print(&quot;language             :&quot;, meta.get_language())</span>
</span><span id="__span-52-64">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;language             :&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
</span><span id="__span-52-65">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;keywords             :&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">keyword</span><span class="p">)</span>
</span><span id="__span-52-66">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;statistics    &quot;</span><span class="p">)</span>
</span><span id="__span-52-67">    <span class="k">if</span> <span class="n">meta</span><span class="o">.</span><span class="n">statistic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-52-68">        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">meta</span><span class="o">.</span><span class="n">statistic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-52-69">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="si">:</span><span class="s2">&lt;18</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-52-70">    <span class="n">user_defined</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">user_defined_metadata</span>
</span><span id="__span-52-71">    <span class="k">if</span> <span class="n">user_defined</span><span class="p">:</span>
</span><span id="__span-52-72">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;user defined metadata&quot;</span><span class="p">)</span>
</span><span id="__span-52-73">        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">user_defined</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-52-74">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="si">:</span><span class="s2">&lt;18</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-52-75">
</span><span id="__span-52-76">    <span class="c1"># A quick way to have all of those informations:</span>
</span><span id="__span-52-77">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
</span><span id="__span-52-78">    <span class="nb">print</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">get_formated_meta</span><span class="p">())</span>
</span><span id="__span-52-79">
</span><span id="__span-52-80">
</span><span id="__span-52-81"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-52-82">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="move-link-to-footnote">Move link to footnote</h3>
<p>Remove all links from a document, transforming each link information (URL,
text) into a footnote. Of course, removing links already inside notes, just
keeping plain text URL. (Side note: most office suite dislike notes in notes)</p>
<details class="code">
<summary>recipes/move_link_to_footnote.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-53-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-53-2"><span class="sd">&quot;&quot;&quot;Remove all links from a document, transforming each link information (URL,</span>
</span><span id="__span-53-3"><span class="sd">text) into a footnote. Of course, removing links already inside notes, just</span>
</span><span id="__span-53-4"><span class="sd">keeping plain text URL. (Side note: most office suite dislike notes in notes)</span>
</span><span id="__span-53-5"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-53-6">
</span><span id="__span-53-7"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-53-8"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-53-9">
</span><span id="__span-53-10"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-53-11">
</span><span id="__span-53-12"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">500</span>
</span><span id="__span-53-13"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-53-14"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;collection2.odt&quot;</span>
</span><span id="__span-53-15"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;footnote1&quot;</span>
</span><span id="__span-53-16"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-53-17">
</span><span id="__span-53-18">
</span><span id="__span-53-19"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-53-20">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-53-21">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-53-22">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-53-23">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-53-24">
</span><span id="__span-53-25">
</span><span id="__span-53-26"><span class="k">def</span><span class="w"> </span><span class="nf">remove_links</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
</span><span id="__span-53-27">    <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;text:a&quot;</span>
</span><span id="__span-53-28">    <span class="n">keep_inside_tag</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
</span><span id="__span-53-29">    <span class="n">context</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">keep_inside_tag</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="__span-53-30">    <span class="n">element</span><span class="p">,</span> <span class="n">_is_modified</span> <span class="o">=</span> <span class="n">_tree_remove_tag</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span><span id="__span-53-31">
</span><span id="__span-53-32">
</span><span id="__span-53-33"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-53-34">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-53-35">        <span class="n">source</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-53-36">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="__span-53-37">        <span class="n">source</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span>
</span><span id="__span-53-38">
</span><span id="__span-53-39">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
</span><span id="__span-53-40">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-53-41">
</span><span id="__span-53-42">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Moving links to footnotes from&quot;</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</span><span id="__span-53-43">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;links occurrences:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_links</span><span class="p">()))</span>
</span><span id="__span-53-44">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;footnotes occurences:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_notes</span><span class="p">()))</span>
</span><span id="__span-53-45">
</span><span id="__span-53-46">    <span class="n">counter_links_in_notes</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-53-47">    <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">get_notes</span><span class="p">():</span>
</span><span id="__span-53-48">        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">get_links</span><span class="p">():</span>
</span><span id="__span-53-49">            <span class="n">counter_links_in_notes</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-53-50">            <span class="n">url</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;xlink:href&quot;</span><span class="p">)</span>
</span><span id="__span-53-51">            <span class="n">tail</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">tail</span>
</span><span id="__span-53-52">            <span class="n">new_tail</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (link: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">tail</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-53-53">            <span class="n">link</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">new_tail</span>
</span><span id="__span-53-54">            <span class="n">remove_links</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="__span-53-55">
</span><span id="__span-53-56">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;links in notes:&quot;</span><span class="p">,</span> <span class="n">counter_links_in_notes</span><span class="p">)</span>
</span><span id="__span-53-57">
</span><span id="__span-53-58">    <span class="n">counter_added_note</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># added notes counter</span>
</span><span id="__span-53-59">    <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
</span><span id="__span-53-60">        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">get_links</span><span class="p">():</span>
</span><span id="__span-53-61">            <span class="n">url</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;xlink:href&quot;</span><span class="p">)</span>
</span><span id="__span-53-62">            <span class="n">text</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">inner_text</span>
</span><span id="__span-53-63">            <span class="n">counter_added_note</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-53-64">            <span class="n">paragraph</span><span class="o">.</span><span class="n">insert_note</span><span class="p">(</span>
</span><span id="__span-53-65">                <span class="n">after</span><span class="o">=</span><span class="n">link</span><span class="p">,</span>  <span class="c1"># citation is inserted after current link</span>
</span><span id="__span-53-66">                <span class="n">note_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;my_note_</span><span class="si">{</span><span class="n">counter_added_note</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-53-67">                <span class="n">citation</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>  <span class="c1"># The symbol the user sees to follow the footnote.</span>
</span><span id="__span-53-68">                <span class="c1"># The footnote itself, at the end of the page:</span>
</span><span id="__span-53-69">                <span class="n">body</span><span class="o">=</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;. </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">, link: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="__span-53-70">            <span class="p">)</span>
</span><span id="__span-53-71">        <span class="n">remove_links</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-53-72">
</span><span id="__span-53-73">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;links occurrences:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_links</span><span class="p">()))</span>
</span><span id="__span-53-74">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;footnotes occurences:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_notes</span><span class="p">()))</span>
</span><span id="__span-53-75">
</span><span id="__span-53-76">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-53-77">
</span><span id="__span-53-78">
</span><span id="__span-53-79"><span class="k">def</span><span class="w"> </span><span class="nf">_tree_remove_tag</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span id="__span-53-80"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove tag in the element, recursive.</span>
</span><span id="__span-53-81"><span class="sd">    - context: tuple (tag to remove, protection tag, protection flag)</span>
</span><span id="__span-53-82"><span class="sd">    where protection tag protect from change sub elements one sub</span>
</span><span id="__span-53-83"><span class="sd">    level depth&quot;&quot;&quot;</span>
</span><span id="__span-53-84">    <span class="n">buffer</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">clone</span>
</span><span id="__span-53-85">    <span class="n">modified</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-53-86">    <span class="n">sub_elements</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-53-87">    <span class="n">tag</span><span class="p">,</span> <span class="n">keep_inside_tag</span><span class="p">,</span> <span class="n">protected</span> <span class="o">=</span> <span class="n">context</span>
</span><span id="__span-53-88">    <span class="k">if</span> <span class="n">keep_inside_tag</span> <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">keep_inside_tag</span><span class="p">:</span>
</span><span id="__span-53-89">        <span class="n">protect_below</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-53-90">    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-53-91">        <span class="n">protect_below</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-53-92">    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">buffer</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="__span-53-93">        <span class="n">striped</span><span class="p">,</span> <span class="n">is_modified</span> <span class="o">=</span> <span class="n">_tree_remove_tag</span><span class="p">(</span>
</span><span id="__span-53-94">            <span class="n">child</span><span class="p">,</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">keep_inside_tag</span><span class="p">,</span> <span class="n">protect_below</span><span class="p">)</span>
</span><span id="__span-53-95">        <span class="p">)</span>
</span><span id="__span-53-96">        <span class="k">if</span> <span class="n">is_modified</span><span class="p">:</span>
</span><span id="__span-53-97">            <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-53-98">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">striped</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="__span-53-99">            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">striped</span><span class="p">:</span>
</span><span id="__span-53-100">                <span class="n">sub_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-53-101">        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-53-102">            <span class="n">sub_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">striped</span><span class="p">)</span>
</span><span id="__span-53-103">    <span class="k">if</span> <span class="ow">not</span> <span class="n">protected</span> <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">tag</span><span class="p">:</span>
</span><span id="__span-53-104">        <span class="n">element</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-53-105">        <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-53-106">    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-53-107">        <span class="k">if</span> <span class="ow">not</span> <span class="n">modified</span><span class="p">:</span>
</span><span id="__span-53-108">            <span class="c1"># no change in element sub tree, no change on element</span>
</span><span id="__span-53-109">            <span class="k">return</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="__span-53-110">        <span class="n">element</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-53-111">        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-53-112">            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">buffer</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-53-113">                <span class="n">element</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="__span-53-114">        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="__span-53-115">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Incorrect attribute in&quot;</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>
</span><span id="__span-53-116">    <span class="n">text</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">text</span>
</span><span id="__span-53-117">    <span class="n">tail</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">tail</span>
</span><span id="__span-53-118">    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-53-119">        <span class="n">element</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="__span-53-120">    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">sub_elements</span><span class="p">:</span>
</span><span id="__span-53-121">        <span class="n">element</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</span><span id="__span-53-122">    <span class="k">if</span> <span class="n">tail</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-53-123">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="__span-53-124">            <span class="n">element</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>
</span><span id="__span-53-125">        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-53-126">            <span class="n">element</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">tail</span>
</span><span id="__span-53-127">    <span class="k">return</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-53-128">
</span><span id="__span-53-129">
</span><span id="__span-53-130"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-53-131">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="remove-http-links">Remove http links</h3>
<p>Remove the links (the text:a tag), keeping the inner text.</p>
<details class="code">
<summary>recipes/remove_http_links.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-54-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-54-2"><span class="sd">&quot;&quot;&quot;Remove the links (the text:a tag), keeping the inner text.&quot;&quot;&quot;</span>
</span><span id="__span-54-3">
</span><span id="__span-54-4"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-54-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-54-6">
</span><span id="__span-54-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-54-8">
</span><span id="__span-54-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">510</span>
</span><span id="__span-54-10"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-54-11"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;collection2.odt&quot;</span>
</span><span id="__span-54-12"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;nolink&quot;</span>
</span><span id="__span-54-13"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-54-14">
</span><span id="__span-54-15">
</span><span id="__span-54-16"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-54-17">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-54-18">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-54-19">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-54-20">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-54-21">
</span><span id="__span-54-22">
</span><span id="__span-54-23"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-54-24">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-54-25">        <span class="n">source</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-54-26">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="__span-54-27">        <span class="n">source</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span>
</span><span id="__span-54-28">
</span><span id="__span-54-29">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
</span><span id="__span-54-30">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-54-31">
</span><span id="__span-54-32">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removing links from&quot;</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</span><span id="__span-54-33">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;text:a&#39; occurrences:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_links</span><span class="p">()))</span>
</span><span id="__span-54-34">
</span><span id="__span-54-35">    <span class="n">remove_links</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</span><span id="__span-54-36">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;text:a&#39; occurrences after removal:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">get_links</span><span class="p">()))</span>
</span><span id="__span-54-37">
</span><span id="__span-54-38">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-54-39">
</span><span id="__span-54-40">
</span><span id="__span-54-41"><span class="k">def</span><span class="w"> </span><span class="nf">remove_links</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
</span><span id="__span-54-42">    <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;text:a&quot;</span>
</span><span id="__span-54-43">    <span class="n">keep_inside_tag</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
</span><span id="__span-54-44">    <span class="n">context</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">keep_inside_tag</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="__span-54-45">    <span class="n">element</span><span class="p">,</span> <span class="n">_is_modified</span> <span class="o">=</span> <span class="n">_tree_remove_tag</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span><span id="__span-54-46">
</span><span id="__span-54-47">
</span><span id="__span-54-48"><span class="k">def</span><span class="w"> </span><span class="nf">_tree_remove_tag</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span id="__span-54-49"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove tag in the element, recursive.</span>
</span><span id="__span-54-50">
</span><span id="__span-54-51"><span class="sd">    - context: a tuple (tag to remove, protection tag, protection flag)</span>
</span><span id="__span-54-52"><span class="sd">    where protection tag protect from change sub elements one sub level depth</span>
</span><span id="__span-54-53"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-54-54">    <span class="n">buffer</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">clone</span>
</span><span id="__span-54-55">    <span class="n">modified</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-54-56">    <span class="n">sub_elements</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-54-57">    <span class="n">tag</span><span class="p">,</span> <span class="n">keep_inside_tag</span><span class="p">,</span> <span class="n">protected</span> <span class="o">=</span> <span class="n">context</span>
</span><span id="__span-54-58">    <span class="k">if</span> <span class="n">keep_inside_tag</span> <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">keep_inside_tag</span><span class="p">:</span>
</span><span id="__span-54-59">        <span class="n">protect_below</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-54-60">    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-54-61">        <span class="n">protect_below</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-54-62">    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">buffer</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="__span-54-63">        <span class="n">striped</span><span class="p">,</span> <span class="n">is_modified</span> <span class="o">=</span> <span class="n">_tree_remove_tag</span><span class="p">(</span>
</span><span id="__span-54-64">            <span class="n">child</span><span class="p">,</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">keep_inside_tag</span><span class="p">,</span> <span class="n">protect_below</span><span class="p">)</span>
</span><span id="__span-54-65">        <span class="p">)</span>
</span><span id="__span-54-66">        <span class="k">if</span> <span class="n">is_modified</span><span class="p">:</span>
</span><span id="__span-54-67">            <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-54-68">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">striped</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="__span-54-69">            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">striped</span><span class="p">:</span>
</span><span id="__span-54-70">                <span class="n">sub_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-54-71">        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-54-72">            <span class="n">sub_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">striped</span><span class="p">)</span>
</span><span id="__span-54-73">    <span class="k">if</span> <span class="ow">not</span> <span class="n">protected</span> <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">tag</span><span class="p">:</span>
</span><span id="__span-54-74">        <span class="n">element</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-54-75">        <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-54-76">    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-54-77">        <span class="k">if</span> <span class="ow">not</span> <span class="n">modified</span><span class="p">:</span>
</span><span id="__span-54-78">            <span class="c1"># no change in element sub tree, no change on element</span>
</span><span id="__span-54-79">            <span class="k">return</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="__span-54-80">        <span class="n">element</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-54-81">        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-54-82">            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">buffer</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-54-83">                <span class="n">element</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="__span-54-84">        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="__span-54-85">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bad attribute in&quot;</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>
</span><span id="__span-54-86">    <span class="n">text</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">text</span>
</span><span id="__span-54-87">    <span class="n">tail</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">tail</span>
</span><span id="__span-54-88">    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-54-89">        <span class="n">element</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="__span-54-90">    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">sub_elements</span><span class="p">:</span>
</span><span id="__span-54-91">        <span class="n">element</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</span><span id="__span-54-92">    <span class="k">if</span> <span class="n">tail</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-54-93">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="__span-54-94">            <span class="n">element</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>
</span><span id="__span-54-95">        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-54-96">            <span class="n">element</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">tail</span>
</span><span id="__span-54-97">    <span class="k">return</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-54-98">
</span><span id="__span-54-99">
</span><span id="__span-54-100"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-54-101">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="remove-span-styles">Remove span styles</h3>
<p>Remove span styles (like some words in bold in a paragraph),
except in titles.</p>
<details class="code">
<summary>recipes/remove_span_styles.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-55-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-55-2"><span class="sd">&quot;&quot;&quot;Remove span styles (like some words in bold in a paragraph),</span>
</span><span id="__span-55-3"><span class="sd">except in titles.</span>
</span><span id="__span-55-4"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-55-5">
</span><span id="__span-55-6"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-55-7"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-55-8">
</span><span id="__span-55-9"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-55-10">
</span><span id="__span-55-11"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">520</span>
</span><span id="__span-55-12"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-55-13"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;dormeur.odt&quot;</span>
</span><span id="__span-55-14"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;nostyle&quot;</span>
</span><span id="__span-55-15"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-55-16">
</span><span id="__span-55-17">
</span><span id="__span-55-18"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-55-19">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-55-20">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-55-21">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-55-22">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-55-23">
</span><span id="__span-55-24">
</span><span id="__span-55-25"><span class="k">def</span><span class="w"> </span><span class="nf">remove_text_span</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
</span><span id="__span-55-26">    <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;text:span&quot;</span>
</span><span id="__span-55-27">    <span class="n">keep_inside_tag</span> <span class="o">=</span> <span class="s2">&quot;text:h&quot;</span>
</span><span id="__span-55-28">    <span class="n">context</span> <span class="o">=</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">keep_inside_tag</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="__span-55-29">    <span class="n">element</span><span class="p">,</span> <span class="n">_is_modified</span> <span class="o">=</span> <span class="n">_tree_remove_tag</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span><span id="__span-55-30">
</span><span id="__span-55-31">
</span><span id="__span-55-32"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-55-33">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-55-34">        <span class="n">source</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-55-35">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="__span-55-36">        <span class="n">source</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span>
</span><span id="__span-55-37">
</span><span id="__span-55-38">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
</span><span id="__span-55-39">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-55-40">
</span><span id="__span-55-41">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removing span styles from&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-55-42">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;text:span&#39; occurrences:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">spans</span><span class="p">))</span>
</span><span id="__span-55-43">
</span><span id="__span-55-44">    <span class="n">remove_text_span</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</span><span id="__span-55-45">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;text:span&#39; occurrences after removal:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">spans</span><span class="p">))</span>
</span><span id="__span-55-46">
</span><span id="__span-55-47">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-55-48">
</span><span id="__span-55-49">
</span><span id="__span-55-50"><span class="k">def</span><span class="w"> </span><span class="nf">_tree_remove_tag</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span id="__span-55-51"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Send back a copy of the element, without span styles. Element should be</span>
</span><span id="__span-55-52"><span class="sd">    either paragraph or heading.</span>
</span><span id="__span-55-53">
</span><span id="__span-55-54"><span class="sd">    - context: a tuple (tag to remove, protection tag, protection flag)</span>
</span><span id="__span-55-55"><span class="sd">    where protection tag protects from change any sub elements one level depth</span>
</span><span id="__span-55-56"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-55-57">    <span class="n">buffer</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">clone</span>
</span><span id="__span-55-58">    <span class="n">modified</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-55-59">    <span class="n">sub_elements</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-55-60">    <span class="n">tag</span><span class="p">,</span> <span class="n">keep_inside_tag</span><span class="p">,</span> <span class="n">protected</span> <span class="o">=</span> <span class="n">context</span>
</span><span id="__span-55-61">    <span class="k">if</span> <span class="n">keep_inside_tag</span> <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">keep_inside_tag</span><span class="p">:</span>
</span><span id="__span-55-62">        <span class="n">protect_below</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-55-63">    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-55-64">        <span class="n">protect_below</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-55-65">    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">buffer</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="__span-55-66">        <span class="n">striped</span><span class="p">,</span> <span class="n">is_modified</span> <span class="o">=</span> <span class="n">_tree_remove_tag</span><span class="p">(</span>
</span><span id="__span-55-67">            <span class="n">child</span><span class="p">,</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">keep_inside_tag</span><span class="p">,</span> <span class="n">protect_below</span><span class="p">)</span>
</span><span id="__span-55-68">        <span class="p">)</span>
</span><span id="__span-55-69">        <span class="k">if</span> <span class="n">is_modified</span><span class="p">:</span>
</span><span id="__span-55-70">            <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-55-71">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">striped</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="__span-55-72">            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">striped</span><span class="p">:</span>
</span><span id="__span-55-73">                <span class="n">sub_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-55-74">        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-55-75">            <span class="n">sub_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">striped</span><span class="p">)</span>
</span><span id="__span-55-76">    <span class="k">if</span> <span class="ow">not</span> <span class="n">protected</span> <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">tag</span><span class="p">:</span>
</span><span id="__span-55-77">        <span class="n">element</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-55-78">        <span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-55-79">    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-55-80">        <span class="k">if</span> <span class="ow">not</span> <span class="n">modified</span><span class="p">:</span>
</span><span id="__span-55-81">            <span class="c1"># no change in element sub tree, no change on element</span>
</span><span id="__span-55-82">            <span class="k">return</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="__span-55-83">        <span class="n">element</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-55-84">        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-55-85">            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">buffer</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-55-86">                <span class="n">element</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="__span-55-87">        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="__span-55-88">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bad attribute in&quot;</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>
</span><span id="__span-55-89">    <span class="n">text</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">text</span>
</span><span id="__span-55-90">    <span class="n">tail</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="n">tail</span>
</span><span id="__span-55-91">    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-55-92">        <span class="n">element</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="__span-55-93">    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">sub_elements</span><span class="p">:</span>
</span><span id="__span-55-94">        <span class="n">element</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</span><span id="__span-55-95">    <span class="k">if</span> <span class="n">tail</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-55-96">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="__span-55-97">            <span class="n">element</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>
</span><span id="__span-55-98">        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-55-99">            <span class="n">element</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">tail</span>
</span><span id="__span-55-100">    <span class="k">return</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-55-101">
</span><span id="__span-55-102">
</span><span id="__span-55-103"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-55-104">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="retrieve-all-pictures-from-odf-files">Retrieve all pictures from odf files</h3>
<p>Analyse a list of files and directory (recurse), open all ODF documents
and copy pictures from documents in a directory.</p>
<details class="code">
<summary>recipes/retrieve_all_pictures_from_ODF_files.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-56-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-56-2"><span class="sd">&quot;&quot;&quot;Analyse a list of files and directory (recurse), open all ODF documents</span>
</span><span id="__span-56-3"><span class="sd">and copy pictures from documents in a directory.</span>
</span><span id="__span-56-4"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-56-5"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-56-6"><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="__span-56-7"><span class="kn">from</span><span class="w"> </span><span class="nn">hashlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">sha256</span>
</span><span id="__span-56-8"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-56-9">
</span><span id="__span-56-10"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-56-11">
</span><span id="__span-56-12"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">530</span>
</span><span id="__span-56-13"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;collected_pics&quot;</span>
</span><span id="__span-56-14"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-56-15">
</span><span id="__span-56-16"><span class="c1"># encoding = &quot;UTF8&quot;</span>
</span><span id="__span-56-17"><span class="n">known_images</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="__span-56-18"><span class="n">counter_image</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-56-19"><span class="n">counter_odf</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-56-20"><span class="n">counter_outside</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-56-21">
</span><span id="__span-56-22">
</span><span id="__span-56-23"><span class="k">def</span><span class="w"> </span><span class="nf">store_image</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
</span><span id="__span-56-24"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Image new name is &quot;odffile_imagename&quot;.&quot;&quot;&quot;</span>
</span><span id="__span-56-25">    <span class="k">global</span> <span class="n">counter_image</span>
</span><span id="__span-56-26">
</span><span id="__span-56-27">    <span class="n">base</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="__span-56-28">    <span class="n">cpt</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-56-29">    <span class="k">if</span> <span class="ow">not</span> <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span><span id="__span-56-30">        <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-56-31">    <span class="n">target</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cpt</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-56-32">    <span class="k">while</span> <span class="n">target</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-56-33">        <span class="n">cpt</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-56-34">        <span class="n">target</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cpt</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-56-35">    <span class="n">target</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="__span-56-36">    <span class="n">counter_image</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-56-37">
</span><span id="__span-56-38">
</span><span id="__span-56-39"><span class="k">def</span><span class="w"> </span><span class="nf">parse_odf_pics</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
</span><span id="__span-56-40"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Using odfdo for:</span>
</span><span id="__span-56-41"><span class="sd">    - open possible ODF document: Document (including URI)</span>
</span><span id="__span-56-42"><span class="sd">    - find images inside the document: get_image_list, get_attribute</span>
</span><span id="__span-56-43"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-56-44">    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.od&quot;</span><span class="p">):</span>
</span><span id="__span-56-45">        <span class="k">return</span>
</span><span id="__span-56-46">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-56-47">        <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-56-48">    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-56-49">        <span class="k">return</span>
</span><span id="__span-56-50">
</span><span id="__span-56-51">    <span class="k">global</span> <span class="n">counter_odf</span>
</span><span id="__span-56-52">    <span class="k">global</span> <span class="n">counter_outside</span>
</span><span id="__span-56-53">
</span><span id="__span-56-54">    <span class="n">counter_odf</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-56-55">    <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
</span><span id="__span-56-56">        <span class="n">image_url</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">url</span>
</span><span id="__span-56-57">        <span class="k">if</span> <span class="ow">not</span> <span class="n">image_url</span><span class="p">:</span>
</span><span id="__span-56-58">            <span class="k">continue</span>
</span><span id="__span-56-59">        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-56-60">            <span class="n">image_content</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get_part</span><span class="p">(</span><span class="n">image_url</span><span class="p">)</span>
</span><span id="__span-56-61">        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="__span-56-62">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- not found inside document:&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="__span-56-63">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  image URL:&quot;</span><span class="p">,</span> <span class="n">image_url</span><span class="p">)</span>
</span><span id="__span-56-64">            <span class="n">counter_outside</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-56-65">            <span class="k">continue</span>
</span><span id="__span-56-66">        <span class="n">image_name</span> <span class="o">=</span> <span class="n">image_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-56-67">        <span class="k">if</span> <span class="ow">not</span> <span class="n">known_pic</span><span class="p">(</span><span class="n">image_content</span><span class="p">):</span>
</span><span id="__span-56-68">            <span class="n">store_image</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">image_name</span><span class="p">,</span> <span class="n">image_content</span><span class="p">)</span>
</span><span id="__span-56-69">
</span><span id="__span-56-70">
</span><span id="__span-56-71"><span class="k">def</span><span class="w"> </span><span class="nf">known_pic</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-56-72"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remember already seen images by sha256 footprint.&quot;&quot;&quot;</span>
</span><span id="__span-56-73">    <span class="n">footprint</span> <span class="o">=</span> <span class="n">sha256</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span><span id="__span-56-74">    <span class="k">if</span> <span class="n">footprint</span> <span class="ow">in</span> <span class="n">known_images</span><span class="p">:</span>
</span><span id="__span-56-75">        <span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-56-76">    <span class="n">known_images</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">footprint</span><span class="p">)</span>
</span><span id="__span-56-77">    <span class="k">return</span> <span class="kc">False</span>
</span><span id="__span-56-78">
</span><span id="__span-56-79">
</span><span id="__span-56-80"><span class="k">def</span><span class="w"> </span><span class="nf">analyse_document</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
</span><span id="__span-56-81">    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;**/*&quot;</span><span class="p">):</span>
</span><span id="__span-56-82">        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
</span><span id="__span-56-83">            <span class="n">parse_odf_pics</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-56-84">
</span><span id="__span-56-85">
</span><span id="__span-56-86"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-56-87">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-56-88">        <span class="n">source</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-56-89">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="__span-56-90">        <span class="n">source</span> <span class="o">=</span> <span class="n">DATA</span>
</span><span id="__span-56-91">
</span><span id="__span-56-92">    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-56-93">    <span class="n">analyse_document</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
</span><span id="__span-56-94">    <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
</span><span id="__span-56-95">    <span class="nb">print</span><span class="p">(</span>
</span><span id="__span-56-96">        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">counter_image</span><span class="si">}</span><span class="s2"> images copied (</span><span class="si">{</span><span class="n">counter_outside</span><span class="si">}</span><span class="s2"> not found) from &quot;</span>
</span><span id="__span-56-97">        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">counter_odf</span><span class="si">}</span><span class="s2"> ODF files to </span><span class="si">{</span><span class="n">OUTPUT_DIR</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">elapsed</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">sec.&quot;</span>
</span><span id="__span-56-98">    <span class="p">)</span>
</span><span id="__span-56-99">
</span><span id="__span-56-100">
</span><span id="__span-56-101"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-56-102">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="read-document-from-bytesio">Read document from bytesio</h3>
<p>Read a document from BytesIO.</p>
<details class="code">
<summary>recipes/read_document_from_bytesio.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-57-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-57-2"><span class="sd">&quot;&quot;&quot;Read a document from BytesIO.</span>
</span><span id="__span-57-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-57-4"><span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
</span><span id="__span-57-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-57-6">
</span><span id="__span-57-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-57-8">
</span><span id="__span-57-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">600</span>
</span><span id="__span-57-10"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-57-11"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;lorem.odt&quot;</span>
</span><span id="__span-57-12">
</span><span id="__span-57-13">
</span><span id="__span-57-14"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-57-15">    <span class="n">file_path</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span>
</span><span id="__span-57-16">    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">bytes_content</span><span class="p">:</span>
</span><span id="__span-57-17">        <span class="c1"># read the file in the BytesIO (or read from some network)</span>
</span><span id="__span-57-18">        <span class="n">bytes_content</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file_path</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">())</span>
</span><span id="__span-57-19">        <span class="c1"># Create the odfdo.Document from the BytesIO</span>
</span><span id="__span-57-20">        <span class="n">bytes_content</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-57-21">        <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">bytes_content</span><span class="p">)</span>
</span><span id="__span-57-22">        <span class="c1"># check :</span>
</span><span id="__span-57-23">        <span class="k">if</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Lorem ipsum dolor sit amet&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-57-24">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;string not found&quot;</span><span class="p">)</span>
</span><span id="__span-57-25">
</span><span id="__span-57-26">
</span><span id="__span-57-27"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-57-28">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="save-document-as-bytesio">Save document as bytesio</h3>
<p>Save a document as BytesIO.</p>
<details class="code">
<summary>recipes/save_document_as_bytesio.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-58-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-58-2"><span class="sd">&quot;&quot;&quot;Save a document as BytesIO.</span>
</span><span id="__span-58-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-58-4"><span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
</span><span id="__span-58-5"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-58-6">
</span><span id="__span-58-7"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Paragraph</span>
</span><span id="__span-58-8">
</span><span id="__span-58-9"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">605</span>
</span><span id="__span-58-10"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;bytes&quot;</span>
</span><span id="__span-58-11"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;document.odt&quot;</span>
</span><span id="__span-58-12">
</span><span id="__span-58-13">
</span><span id="__span-58-14"><span class="k">def</span><span class="w"> </span><span class="nf">make_document</span><span class="p">():</span>
</span><span id="__span-58-15">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</span><span id="__span-58-16">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-58-17">    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
</span><span id="__span-58-18">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
</span><span id="__span-58-19">    <span class="k">return</span> <span class="n">document</span>
</span><span id="__span-58-20">
</span><span id="__span-58-21">
</span><span id="__span-58-22"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-58-23">    <span class="n">document</span> <span class="o">=</span> <span class="n">make_document</span><span class="p">()</span>
</span><span id="__span-58-24">    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">bytes_content</span><span class="p">:</span>
</span><span id="__span-58-25">        <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">bytes_content</span><span class="p">)</span>
</span><span id="__span-58-26">        <span class="c1"># Now use the BytesIO in some way:</span>
</span><span id="__span-58-27">        <span class="c1"># In a netwotk context, typically:</span>
</span><span id="__span-58-28">        <span class="c1">#    response.write(bytes_content.getvalue())</span>
</span><span id="__span-58-29">        <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-58-30">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">TARGET</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="__span-58-31">            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bytes_content</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
</span><span id="__span-58-32">
</span><span id="__span-58-33">
</span><span id="__span-58-34"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-58-35">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="search-and-replace-words">Search and replace words</h3>
<p>Search and replace words in a text document.</p>
<details class="code">
<summary>recipes/search_and_replace_words.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-59-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-59-2"><span class="sd">&quot;&quot;&quot;Search and replace words in a text document.</span>
</span><span id="__span-59-3"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-59-4"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-59-5">
</span><span id="__span-59-6"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span>
</span><span id="__span-59-7">
</span><span id="__span-59-8"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">700</span>
</span><span id="__span-59-9"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-59-10"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;lorem.odt&quot;</span>
</span><span id="__span-59-11"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;replaced_text&quot;</span>
</span><span id="__span-59-12"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;lorem_replaced.odt&quot;</span>
</span><span id="__span-59-13">
</span><span id="__span-59-14">
</span><span id="__span-59-15"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-59-16">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-59-17">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-59-18">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-59-19">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-59-20">
</span><span id="__span-59-21">
</span><span id="__span-59-22"><span class="k">def</span><span class="w"> </span><span class="nf">search_replace</span><span class="p">(</span><span class="n">document</span><span class="p">):</span>
</span><span id="__span-59-23">    <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-59-24">
</span><span id="__span-59-25">    <span class="c1"># replace a string in the full document</span>
</span><span id="__span-59-26">    <span class="n">body</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Lorem&quot;</span><span class="p">,</span> <span class="s2">&quot;(Lorem replaced)&quot;</span><span class="p">)</span>
</span><span id="__span-59-27">
</span><span id="__span-59-28">    <span class="c1"># replace in paragraphs only</span>
</span><span id="__span-59-29">    <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
</span><span id="__span-59-30">        <span class="n">paragraph</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;ipsum&quot;</span><span class="p">,</span> <span class="s2">&quot;(ipsum in paragraph)&quot;</span><span class="p">)</span>
</span><span id="__span-59-31">
</span><span id="__span-59-32">    <span class="c1"># replace in headers</span>
</span><span id="__span-59-33">    <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
</span><span id="__span-59-34">        <span class="n">header</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;ipsum&quot;</span><span class="p">,</span> <span class="s2">&quot;(ipsum in header)&quot;</span><span class="p">)</span>
</span><span id="__span-59-35">
</span><span id="__span-59-36">    <span class="c1"># pattern is a regular expression</span>
</span><span id="__span-59-37">    <span class="n">body</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\S+lit &quot;</span><span class="p">,</span> <span class="s2">&quot;(...lit) &quot;</span><span class="p">)</span>
</span><span id="__span-59-38">    <span class="n">body</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;pul[a-z]+&quot;</span><span class="p">,</span> <span class="s2">&quot;(pulvinar)&quot;</span><span class="p">)</span>
</span><span id="__span-59-39">
</span><span id="__span-59-40">
</span><span id="__span-59-41"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-59-42">    <span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span><span class="p">)</span>
</span><span id="__span-59-43">    <span class="n">search_replace</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-59-44">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-59-45">
</span><span id="__span-59-46">
</span><span id="__span-59-47"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-59-48">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="spreadsheet-with-words-frequency-from-a-text">Spreadsheet with words frequency from a text</h3>
<p>Load an ODF text, store the frequency of words in a spreadsheet,
make requests on the table, by regex or value.</p>
<details class="code">
<summary>recipes/spreadsheet_with_words_frequency_from_a_text.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-60-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-60-2"><span class="sd">&quot;&quot;&quot;Load an ODF text, store the frequency of words in a spreadsheet,</span>
</span><span id="__span-60-3"><span class="sd">make requests on the table, by regex or value.</span>
</span><span id="__span-60-4"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-60-5"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-60-6"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-60-7">
</span><span id="__span-60-8"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Table</span>
</span><span id="__span-60-9">
</span><span id="__span-60-10"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">710</span>
</span><span id="__span-60-11"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;freq&quot;</span>
</span><span id="__span-60-12"><span class="n">SOURCE</span> <span class="o">=</span> <span class="s2">&quot;collection2.odt&quot;</span>
</span><span id="__span-60-13"><span class="n">DATA</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>
</span><span id="__span-60-14"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;frequency.ods&quot;</span>
</span><span id="__span-60-15">
</span><span id="__span-60-16">
</span><span id="__span-60-17"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-60-18">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-60-19">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-60-20">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-60-21">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-60-22">
</span><span id="__span-60-23">
</span><span id="__span-60-24"><span class="k">def</span><span class="w"> </span><span class="nf">read_source_document</span><span class="p">():</span>
</span><span id="__span-60-25">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-60-26">        <span class="n">source</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-60-27">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="__span-60-28">        <span class="n">source</span> <span class="o">=</span> <span class="n">DATA</span> <span class="o">/</span> <span class="n">SOURCE</span>
</span><span id="__span-60-29">    <span class="k">return</span> <span class="n">Document</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span id="__span-60-30">
</span><span id="__span-60-31">
</span><span id="__span-60-32"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-60-33">    <span class="n">document</span> <span class="o">=</span> <span class="n">generate_document</span><span class="p">()</span>
</span><span id="__span-60-34">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-60-35">    <span class="n">_expected_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-60-36"><span class="s2">    Word frequency analysis of collection2.odt</span>
</span><span id="__span-60-37"><span class="s2">    Nb of words: 9128</span>
</span><span id="__span-60-38"><span class="s2">    Unique words found: 2337</span>
</span><span id="__span-60-39"><span class="s2">    Rows in the table : 2337</span>
</span><span id="__span-60-40"><span class="s2">    Words corresponding to the regex: ^the</span>
</span><span id="__span-60-41"><span class="s2">      word: the                   occurences: 644</span>
</span><span id="__span-60-42"><span class="s2">      word: they                  occurences: 15</span>
</span><span id="__span-60-43"><span class="s2">      word: their                 occurences: 11</span>
</span><span id="__span-60-44"><span class="s2">      word: then                  occurences: 10</span>
</span><span id="__span-60-45"><span class="s2">      word: there                 occurences: 7</span>
</span><span id="__span-60-46"><span class="s2">      word: these                 occurences: 4</span>
</span><span id="__span-60-47"><span class="s2">      word: them                  occurences: 4</span>
</span><span id="__span-60-48"><span class="s2">      word: themselves            occurences: 2</span>
</span><span id="__span-60-49"><span class="s2">      word: theme                 occurences: 2</span>
</span><span id="__span-60-50"><span class="s2">      word: themed                occurences: 1</span>
</span><span id="__span-60-51"><span class="s2">      word: theatrical            occurences: 1</span>
</span><span id="__span-60-52"><span class="s2">    List of words of frequency 15: two, they, release, one, its, his, film,</span>
</span><span id="__span-60-53"><span class="s2">    episodes, but, adaptation, UK, Radio, J, 0</span>
</span><span id="__span-60-54"><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-60-55">
</span><span id="__span-60-56">
</span><span id="__span-60-57"><span class="k">def</span><span class="w"> </span><span class="nf">frequence_count</span><span class="p">(</span><span class="n">document</span><span class="p">):</span>
</span><span id="__span-60-58">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Word frequency analysis of&quot;</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-60-59">    <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="__span-60-60">    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="s2">&quot;():;!.,[]</span><span class="si">{}</span><span class="s2">#@/</span><span class="se">\\</span><span class="s2">=-_+*#@`</span><span class="se">\&quot;</span><span class="s2">&#39;&quot;</span><span class="p">:</span>
</span><span id="__span-60-61">        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>  <span class="c1"># slow algorithm</span>
</span><span id="__span-60-62">    <span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="__span-60-63">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nb of words:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
</span><span id="__span-60-64">
</span><span id="__span-60-65">    <span class="n">frequences</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-60-66">
</span><span id="__span-60-67">    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
</span><span id="__span-60-68">        <span class="n">frequences</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">frequences</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-60-69">
</span><span id="__span-60-70">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unique words found:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequences</span><span class="p">))</span>
</span><span id="__span-60-71">    <span class="k">return</span> <span class="n">frequences</span>
</span><span id="__span-60-72">
</span><span id="__span-60-73">
</span><span id="__span-60-74"><span class="k">def</span><span class="w"> </span><span class="nf">generate_document</span><span class="p">():</span>
</span><span id="__span-60-75">    <span class="n">document_source</span> <span class="o">=</span> <span class="n">read_source_document</span><span class="p">()</span>
</span><span id="__span-60-76">    <span class="n">spreadsheet</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;spreadsheet&quot;</span><span class="p">)</span>
</span><span id="__span-60-77">
</span><span id="__span-60-78">    <span class="n">frequences</span> <span class="o">=</span> <span class="n">frequence_count</span><span class="p">(</span><span class="n">document_source</span><span class="p">)</span>
</span><span id="__span-60-79">
</span><span id="__span-60-80">    <span class="c1"># Populate the table in the spreadsheet</span>
</span><span id="__span-60-81">    <span class="n">body</span> <span class="o">=</span> <span class="n">spreadsheet</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-60-82">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-60-83">    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;Frequency Table&quot;</span><span class="p">)</span>
</span><span id="__span-60-84">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="__span-60-85">
</span><span id="__span-60-86">    <span class="n">sorted_keys</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">([(</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">frequences</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="__span-60-87">
</span><span id="__span-60-88">    <span class="c1"># one solution :</span>
</span><span id="__span-60-89">
</span><span id="__span-60-90">    <span class="c1"># for value, key in sorted:</span>
</span><span id="__span-60-91">    <span class="c1">#    row = Row()</span>
</span><span id="__span-60-92">    <span class="c1">#    row.set_value(0, key)</span>
</span><span id="__span-60-93">    <span class="c1">#    row.set_value(1, value) # Cell type is guessed.</span>
</span><span id="__span-60-94">    <span class="c1">#    table.append_row(row)</span>
</span><span id="__span-60-95">
</span><span id="__span-60-96">    <span class="c1"># another solution :</span>
</span><span id="__span-60-97">    <span class="n">sorted_keys</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">sorted_keys</span><span class="p">]</span>
</span><span id="__span-60-98">    <span class="n">table</span><span class="o">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">sorted_keys</span><span class="p">)</span>
</span><span id="__span-60-99">
</span><span id="__span-60-100">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rows in the table :&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
</span><span id="__span-60-101">
</span><span id="__span-60-102">    <span class="c1"># frequency of word:</span>
</span><span id="__span-60-103">    <span class="n">regex_query</span> <span class="o">=</span> <span class="s2">&quot;^the&quot;</span>
</span><span id="__span-60-104">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Words corresponding to the regex:&quot;</span><span class="p">,</span> <span class="n">regex_query</span><span class="p">)</span>
</span><span id="__span-60-105">    <span class="n">result</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_rows</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">regex_query</span><span class="p">)</span>
</span><span id="__span-60-106">    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span id="__span-60-107">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  word: </span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">:</span><span class="s2">&lt;20</span><span class="si">}</span><span class="s2">  occurences: </span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-60-108">
</span><span id="__span-60-109">    <span class="c1"># list of words of frequecy = 15</span>
</span><span id="__span-60-110">    <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-60-111">    <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">iter_values</span><span class="p">():</span>
</span><span id="__span-60-112">        <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>
</span><span id="__span-60-113">            <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span><span id="__span-60-114">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;List of words of frequency 15:&quot;</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">found</span><span class="p">))</span>
</span><span id="__span-60-115">    <span class="k">return</span> <span class="n">spreadsheet</span>
</span><span id="__span-60-116">
</span><span id="__span-60-117">
</span><span id="__span-60-118"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-60-119">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>
<h3 id="transpose-table">Transpose table</h3>
<p>Transpose a table. Create a spreadsheet table (example: 50 rows and 20
columns), and subsequently create a new table in a separate sheet where the
columns and rows are now swapped (e.g. 20 rows and 50 columns).</p>
<details class="code">
<summary>recipes/transpose_table.py</summary>
<div class="language-python highlight"><pre><span></span><code><span id="__span-61-1"><span class="ch">#!/usr/bin/env python</span>
</span><span id="__span-61-2"><span class="sd">&quot;&quot;&quot;Transpose a table. Create a spreadsheet table (example: 50 rows and 20</span>
</span><span id="__span-61-3"><span class="sd">columns), and subsequently create a new table in a separate sheet where the</span>
</span><span id="__span-61-4"><span class="sd">columns and rows are now swapped (e.g. 20 rows and 50 columns).</span>
</span><span id="__span-61-5"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-61-6"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-61-7">
</span><span id="__span-61-8"><span class="kn">from</span><span class="w"> </span><span class="nn">odfdo</span><span class="w"> </span><span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">Row</span><span class="p">,</span> <span class="n">Table</span>
</span><span id="__span-61-9">
</span><span id="__span-61-10"><span class="n">_DOC_SEQUENCE</span> <span class="o">=</span> <span class="mi">800</span>
</span><span id="__span-61-11"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;recipes_output&quot;</span> <span class="o">/</span> <span class="s2">&quot;transpose&quot;</span>
</span><span id="__span-61-12"><span class="n">TARGET</span> <span class="o">=</span> <span class="s2">&quot;transposed.ods&quot;</span>
</span><span id="__span-61-13">
</span><span id="__span-61-14">
</span><span id="__span-61-15"><span class="k">def</span><span class="w"> </span><span class="nf">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Document</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-61-16">    <span class="n">OUTPUT_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-61-17">    <span class="n">new_path</span> <span class="o">=</span> <span class="n">OUTPUT_DIR</span> <span class="o">/</span> <span class="n">name</span>
</span><span id="__span-61-18">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving:&quot;</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
</span><span id="__span-61-19">    <span class="n">document</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-61-20">
</span><span id="__span-61-21">
</span><span id="__span-61-22"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-61-23">    <span class="n">document</span> <span class="o">=</span> <span class="n">generate_document</span><span class="p">()</span>
</span><span id="__span-61-24">    <span class="n">save_new</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">TARGET</span><span class="p">)</span>
</span><span id="__span-61-25">
</span><span id="__span-61-26">
</span><span id="__span-61-27"><span class="k">def</span><span class="w"> </span><span class="nf">generate_document</span><span class="p">():</span>
</span><span id="__span-61-28">    <span class="n">spreadsheet</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;spreadsheet&quot;</span><span class="p">)</span>
</span><span id="__span-61-29">
</span><span id="__span-61-30">    <span class="c1"># Populate the table in the spreadsheet</span>
</span><span id="__span-61-31">    <span class="n">body</span> <span class="o">=</span> <span class="n">spreadsheet</span><span class="o">.</span><span class="n">body</span>
</span><span id="__span-61-32">    <span class="n">body</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="__span-61-33">    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;Table&quot;</span><span class="p">)</span>
</span><span id="__span-61-34">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="__span-61-35">
</span><span id="__span-61-36">    <span class="n">lines</span> <span class="o">=</span> <span class="mi">50</span>
</span><span id="__span-61-37">    <span class="n">cols</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="__span-61-38">
</span><span id="__span-61-39">    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span><span id="__span-61-40">        <span class="n">row</span> <span class="o">=</span> <span class="n">Row</span><span class="p">()</span>
</span><span id="__span-61-41">        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
</span><span id="__span-61-42">            <span class="n">row</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">chr</span><span class="p">(</span><span class="mi">65</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">column</span><span class="p">)</span><span class="si">}{</span><span class="n">line</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-61-43">        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="__span-61-44">
</span><span id="__span-61-45">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size of Table :&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="__span-61-46">
</span><span id="__span-61-47">    <span class="n">table2</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;Symetry&quot;</span><span class="p">)</span>
</span><span id="__span-61-48">
</span><span id="__span-61-49">    <span class="c1"># building the symetric table using classical method :</span>
</span><span id="__span-61-50">    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
</span><span id="__span-61-51">        <span class="n">values</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_column_values</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-61-52">        <span class="n">table2</span><span class="o">.</span><span class="n">set_row_values</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="__span-61-53">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table2</span><span class="p">)</span>
</span><span id="__span-61-54">
</span><span id="__span-61-55">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size of symetric table 2 :&quot;</span><span class="p">,</span> <span class="n">table2</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="__span-61-56">
</span><span id="__span-61-57">    <span class="c1"># a more simple solution with the table.transpose() method :</span>
</span><span id="__span-61-58">    <span class="n">table3</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">clone</span>
</span><span id="__span-61-59">    <span class="n">table3</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</span><span id="__span-61-60">    <span class="n">table3</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Transpose&quot;</span>
</span><span id="__span-61-61">    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table3</span><span class="p">)</span>
</span><span id="__span-61-62">
</span><span id="__span-61-63">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size of symetric table 3 :&quot;</span><span class="p">,</span> <span class="n">table3</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="__span-61-64">    <span class="k">return</span> <span class="n">spreadsheet</span>
</span><span id="__span-61-65">
</span><span id="__span-61-66">
</span><span id="__span-61-67"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-61-68">    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</details>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>